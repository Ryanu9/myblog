"use strict";(()=>{var t,e=Object.defineProperty,i=Object.getOwnPropertyNames,n=(t,e,i)=>{if(!e.has(t))throw TypeError("Cannot "+i)},s=(t,e,i)=>(n(t,e,"read from private field"),i?i.call(t):e.get(t)),o=(t,e,i)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,i)},r=(t,e,i,s)=>(n(t,e,"write to private field"),s?s.call(t,i):e.set(t,i),i),a=(t,e,i)=>(n(t,e,"access private method"),i),l={};((t,i)=>{for(var n in i)e(t,n,{get:i[n],enumerable:!0})})(l,{FootnoteHandler:()=>t});var c,h,d=(c={"src/frontend/main/footnotes.ts"(){t=class{constructor(){this.tooltip=null,this.activeTimeout=null,this.createTooltip()}static getInstance(){return t.instance||(t.instance=new t),t.instance}initializeFootnotes(t){t.querySelectorAll(".footnote-ref").forEach((t=>{const e=t.querySelector("a");e&&(e.addEventListener("click",(t=>{t.preventDefault(),t.stopImmediatePropagation();const i=e.getAttribute("href")?.substring(1);if(i){const t=document.getElementById(i);t&&(t.scrollIntoView({behavior:"smooth"}),t.classList.add("footnote-highlight"),setTimeout((()=>t.classList.remove("footnote-highlight")),2e3))}})),t.addEventListener("mouseenter",(()=>this.showTooltip(t,e))),t.addEventListener("mouseleave",(()=>this.hideTooltip())))})),t.querySelectorAll(".footnote-backref").forEach((t=>{t.addEventListener("click",(e=>{const i=t.getAttribute("href");if(i&&i.startsWith("#")){e.preventDefault(),e.stopImmediatePropagation();const t=i.substring(1),n=document.getElementById(t);n&&(n.scrollIntoView({behavior:"smooth"}),n.classList.add("footnote-highlight"),setTimeout((()=>n.classList.remove("footnote-highlight")),2e3))}}))}))}createTooltip(){this.tooltip||(this.tooltip=document.createElement("div"),this.tooltip.id="footnote-tooltip",this.tooltip.className="markdown-rendered obsidian-document",this.tooltip.style.display="none",document.body.appendChild(this.tooltip),this.tooltip.addEventListener("mouseenter",(()=>{this.activeTimeout&&(clearTimeout(this.activeTimeout),this.activeTimeout=null)})),this.tooltip.addEventListener("mouseleave",(()=>this.hideTooltip())))}showTooltip(t,e){this.activeTimeout&&(clearTimeout(this.activeTimeout),this.activeTimeout=null);const i=e.getAttribute("href")?.substring(1);if(!i)return;const n=document.getElementById(i);if(!n||!this.tooltip)return;const s=this.extractFootnoteContent(n);this.tooltip.innerHTML=s,this.tooltip.style.display="block",this.positionTooltip(t)}hideTooltip(){this.activeTimeout=window.setTimeout((()=>{this.tooltip&&(this.tooltip.style.display="none")}),300)}positionTooltip(t){if(!this.tooltip)return;const e=t.getBoundingClientRect(),i=this.tooltip.getBoundingClientRect();let n=e.left+window.scrollX,s=e.bottom+window.scrollY+5;n+i.width>window.innerWidth&&(n=window.innerWidth-i.width-20),n<10&&(n=10),this.tooltip.style.left=`${n}px`,this.tooltip.style.top=`${s}px`}extractFootnoteContent(t){const e=t.cloneNode(!0),i=e.querySelector(".footnote-backref");i&&i.remove();const n=e.querySelector("a.footnote-link");return n&&n.remove(),e.innerHTML}}}},function(){return c&&(h=(0,c[i(c)[0]])(c=0)),h});async function u(t){return new Promise((e=>setTimeout(e,t)))}async function p(t,e=100){for(;!t();)await u(e)}function m(t,e){const i=document.createElement("div");i.style.position="absolute",i.style.visibility="hidden",i.style.width=t,e.appendChild(i);const n=i.offsetWidth;return e.removeChild(i),n}var g=class{get width(){return this.right-this.left}set width(t){this.right=this.left+t}get height(){return this.bottom-this.top}set height(t){this.bottom=this.top+t}get center(){return new b(this.left+this.width/2,this.top+this.height/2)}get min(){return new b(this.left,this.top)}set min(t){this.left=t.x,this.top=t.y}set position(t){this.min=t}get max(){return new b(this.right,this.bottom)}set max(t){this.right=t.x,this.bottom=t.y}get size(){return new b(this.width,this.height)}set size(t){this.width=t.x,this.height=t.y}constructor(t,e,i,n){this.left=t,this.top=e,this.right=t+i,this.bottom=e+n}containsPoint(t){return t.x>=this.left&&t.x<=this.right&&t.y>=this.top&&t.y<=this.bottom}containsBounds(t){return t.left>=this.left&&t.right<=this.right&&t.top>=this.top&&t.bottom<=this.bottom}encapsulate(t){return this.left=Math.min(this.left,t.left),this.top=Math.min(this.top,t.top),this.right=Math.max(this.right,t.right),this.bottom=Math.max(this.bottom,t.bottom),this}encapsulatePoint(t){if(!t.isUndefined)return this.left=Math.min(this.left,t.x),this.top=Math.min(this.top,t.y),this.right=Math.max(this.right,t.x),this.bottom=Math.max(this.bottom,t.y),this}expand(t){return this.left-=t,this.right+=t,this.top-=t,this.bottom+=t,this}translate(t){return this.left+=t.x,this.right+=t.x,this.top+=t.y,this.bottom+=t.y,this}scale(t){let e=this.width,i=this.height;return this.left+=e*(1-t)/2,this.right-=e*(1-t)/2,this.top+=i*(1-t)/2,this.bottom-=i*(1-t)/2,this}overlaps(t){return this.left<t.right&&this.right>t.left&&this.top<t.bottom&&this.bottom>t.top}static fromElement(t){const e=t.getBoundingClientRect();return new g(e.x,e.y,e.width,e.height)}static get screenBounds(){return new g(0,0,window.innerWidth,window.innerHeight)}},f=class{constructor(t,e){this.x=t,this.y=e}add(t){return new f(this.x+t.x,this.y+t.y)}sub(t){return new f(this.x-t.x,this.y-t.y)}scale(t){return new f(this.x*t,this.y*t)}divide(t){return new f(this.x/t,this.y/t)}get isUndefined(){return isNaN(this.x)||isNaN(this.y)}get magnitude(){return Math.sqrt(this.sqrMagnitude)}get sqrMagnitude(){return this.x*this.x+this.y*this.y}get normalized(){const t=this.magnitude;return new f(this.x/t,this.y/t)}get inverse(){return new f(-this.x,-this.y)}static distance(t,e){return t.sub(e).magnitude}static dot(t,e){return t.x*e.x+t.y*e.y}},b=f;b.Undefined=new f(NaN,NaN);var y=class{constructor(t){this.callbacks=[],this.targetFPS=t,this.measuredFPS=t,this._lastTime=performance.now(),this._deltaTime=1/t,this._time=this._lastTime}get deltaTime(){return this._deltaTime/1e3}get time(){return this._time}async start(){for(;;){this._time=performance.now(),requestAnimationFrame((()=>{for(let t of this.callbacks)t(this.deltaTime)}));const t=this._time-this._lastTime;let e=t-1e3/this.targetFPS;this._lastTime=this._time+Math.max(e,0),await u(Math.max(0,e)),this._deltaTime=Math.min(t+Math.max(e,0),1e3/this.targetFPS*3),this.measuredFPS=1/this.deltaTime*.1+.9*this.measuredFPS}}add(t){this.callbacks.push(t)}};function v(t,e=500){"none"!==t.style.display&&(t.style.transitionProperty="height, margin, padding",t.style.transitionTimingFunction="ease-in-out",t.style.transitionDuration=e+"ms",t.style.boxSizing="border-box",t.style.height=t.offsetHeight+"px",t.offsetHeight,t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",window.setTimeout((async()=>{t.style.display="none",t.style.removeProperty("height"),t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e))}function w(t,e=500){if("none"!==window.getComputedStyle(t).display)return;t.style.removeProperty("display");let i=window.getComputedStyle(t).display;"none"===i&&(i="block"),t.style.display=i;const n=t.offsetHeight;t.style.overflow="hidden",t.style.height="0",t.style.paddingTop="0",t.style.paddingBottom="0",t.style.marginTop="0",t.style.marginBottom="0",t.offsetHeight,t.style.boxSizing="border-box",t.style.transitionProperty="height, margin, padding",t.style.transitionTimingFunction="ease-in-out",t.style.transitionDuration=e+"ms",t.style.height=n+"px",t.style.removeProperty("padding-top"),t.style.removeProperty("padding-bottom"),t.style.removeProperty("margin-top"),t.style.removeProperty("margin-bottom"),window.setTimeout((async()=>{t.style.removeProperty("height"),t.style.removeProperty("overflow"),t.style.removeProperty("transition-duration"),t.style.removeProperty("transition-property")}),e)}function E(t){return{x:t.clientX,y:t.clientY}}function x(t,e,i){let n=2*(i/=2)*(1-i)+.5;return n-=.5,n*=2,t+(e-t)*n}function k(t,e,i,n,s){return function(t,e,i){return Math.max(e,Math.min(t,i))}(function(t,e,i,n,s){return n+(s-n)*(t-e)/(i-e)}(t,e,i,n,s),n,s)}var S=class{constructor(t,e){if(this.isFocused=!1,this.canvas=t,this.nodeEl=e,this.nodeEl.nodeObj=this,this.labelEl=e.querySelector(".canvas-node-label"),this.containerEl=e.querySelector(".canvas-node-container"),this.contentEl=e.querySelector(".canvas-node-content"),!this.labelEl||!this.containerEl||!this.contentEl)return void console.error("Failed to find all required elements for canvas node",this);const i=this.contentEl.classList;if(i.contains("image-embed")?this.type="image":i.contains("video-embed")?this.type="video":i.contains("audio-embed")?this.type="audio":i.contains("markdown-embed")&&i.contains("external-markdown-embed")?this.type="external-markdown":i.contains("markdown-embed")?this.type="markdown":i.contains("canvas-embed")?this.type="canvas":"IFRAME"===this.contentEl.firstElementChild?.tagName?this.type="website":this.nodeEl.classList.contains("canvas-node-group")?this.type="group":this.type="none","external-markdown"==this.type){const e=this.contentEl.querySelector(".obsidian-document");console.log(e);const i=t.document.children.find((t=>t.documentEl==e));i?this.document=i:console.error("Failed to find document object for external markdown node",this)}this.initEvents()}get size(){return new b(parseFloat(this.nodeEl.style.width.replace("px","")),parseFloat(this.nodeEl.style.height.replace("px","")))}set size(t){this.nodeEl.style.width=t.x+"px",this.nodeEl.style.height=t.y+"px",this.nodeEl.style.setProperty("--canvas-node-width",t.x+"px"),this.nodeEl.style.setProperty("--canvas-node-height",t.y+"px")}get position(){const t=this.nodeEl.style.transform.match(/translate\(([^,]+)px, ([^,]+)px\)/),e=this.nodeEl.style.translate.match(/([^,]+)px ([^,]+)px/);let i=0,n=0;return t&&(i+=parseFloat(t[1]),n+=parseFloat(t[2])),e&&(i+=parseFloat(e[1]),n+=parseFloat(e[2])),new b(i,n)}set position(t){this.nodeEl.style.transform=`translate(${t.x}px, ${t.y}px)`}get bounds(){let t=new g(0,0,0,0),e=this.size.scale(this.canvas.scale),i=this.position.scale(this.canvas.scale).add(this.canvas.position);return t.position=i,t.size=e,t}get label(){return this.labelEl.textContent??""}set label(t){this.labelEl.textContent=t}get isScrollable(){return!!this.document&&this.document?.documentEl.scrollHeight>this.document?.documentEl.clientHeight}get scrollContainer(){return this.document?.documentEl}focus(t=!0){this.isFocused&&t||(this.canvas.focusedNode!=this&&this.canvas.focusedNode?.focus(!1),this.nodeEl.classList.toggle("is-focused",t),this.canvas.focusedNode=t?this:null,this.isFocused=t)}initEvents(){const t=this;function e(){console.log("leave"),t.focus(!1),t.nodeEl.removeEventListener("mouseleave",e),t.nodeEl.removeEventListener("touchend",e)}this.nodeEl.addEventListener("dblclick",(e=>{t.fitToView(!1)})),this.nodeEl.addEventListener("pointerenter",(function(i){t.focus(!0),t.nodeEl.addEventListener("mouseleave",e),t.nodeEl.addEventListener("touchend",e),i.stopPropagation()}))}fitToView(t=!1){this.canvas.fitToBounds(this.bounds,.9,t)}},C=class{constructor(t){this.hiddenNodes=[],this.focusedNode=null,this._renderScale=1,this._minScale=.1,this._maxScale=5,this._targetScale=1,this._scale=1,this._targetPosition=new b(0,0),this._position=new b(0,0),this._backgroundBaseScale=20,this._invisibleBackgroundScale=2,this._backgroundScale=this._backgroundBaseScale,this._backgroundDotSize=1,this._backgroundPosition=new b(0,0),this.lastTime=0,this.document=t,this.nodes=Array.from(t.documentEl.querySelectorAll(".canvas-node")).map((t=>new S(this,t))),this.document.documentEl.style.position="absolute",this.document.documentEl.style.width="100%",this.document.documentEl.style.height="100%",this.document.documentEl.style.overflow="hidden",this.document.documentEl.style.top="0",this.document.documentEl.style.left="0",this.canvasEl=t.documentEl.querySelector(".canvas"),this.wrapperEl=t.documentEl.querySelector(".canvas-wrapper"),this.backgroundEl=t.documentEl.querySelector(".canvas-background pattern"),this.backgroundDotEl=this.backgroundEl?.querySelector("circle"),this.canvasEl.setAttribute("style","translate: 0px 1px; scale: 1;"),this.backgroundScale=this._backgroundScale,this.backgroundDotSize=this._backgroundDotSize,this.renderScale=this._renderScale;const e=g.fromElement(this.canvasEl).min.sub(this.nodeBounds.min);Array.from(this.canvasEl.children).forEach((t=>{t.style.translate=`${e.x}px ${e.y}px`})),this.forcePosition=this.nodeBounds.min.sub(this.wrapperBounds.min),requestAnimationFrame(this.updateScale.bind(this)),this.initEvents(),this.wrapperEl.style.transition="opacity 0.0s",this.wrapperEl.classList.add("hide"),this.wrapperEl.style.transition="opacity 3s",this.wrapperEl.classList.remove("hide"),this.fitToBounds(this.nodeBounds,3,!0),setTimeout((()=>{this.fitToBounds(this.nodeBounds,.9,!1)}),100)}get renderScale(){return this._renderScale}set renderScale(t){this._renderScale=t,this.canvasEl.style.zoom=100*t+"%",this.scale=this._scale,this.position=this._position}get nodeBounds(){if(0==this.nodes.length)return new g(0,0,0,0);const t=this.nodes[0].bounds;for(const e of this.nodes)t.encapsulate(e.bounds);return t}get wrapperBounds(){return g.fromElement(this.wrapperEl)}get minScale(){return this._minScale}get maxScale(){return this._maxScale}get targetScale(){return this._targetScale}set targetScale(t){t=Math.min(Math.max(t,this.minScale),this.maxScale),this._targetScale=t}get scale(){return this._scale}set scale(t){let e=t/this._scale;this._scale=t;const i=(t/this.renderScale).toString()??"1";this.canvasEl.style.scale=i;const n=(1/Math.sqrt(t)).toString()??"1";this.wrapperEl.style.setProperty("--zoom-multiplier",n),this.canvasEl.classList.toggle("small-scale",this.scale<.15),this.backgroundScale=this.backgroundScale*e}get targetPosition(){return this._targetPosition}set targetPosition(t){this._targetPosition=t}get position(){return this._position}set position(t){this._position=t;let e=t.divide(this.renderScale);this.canvasEl.style.translate=`${e.x}px ${e.y}px`,this.backgroundPosition=this.position}set forcePosition(t){this.targetPosition=t,this.position=t}get forcePosition(){return this.position}get backgroundScale(){return this._backgroundScale}set backgroundScale(t){const e=t.toString()??"20";this.backgroundEl?.setAttribute("width",e),this.backgroundEl?.setAttribute("height",e),this._backgroundScale=t,this.backgroundEl?.parentElement&&(this.backgroundEl.parentElement.style.opacity=(1-k(this._backgroundScale,this._backgroundBaseScale/2,this._invisibleBackgroundScale,0,1)).toString())}get backgroundDotSize(){return this._backgroundDotSize}set backgroundDotSize(t){const e=t.toString()??"0.7";this.backgroundDotEl?.setAttribute("r",e),this.backgroundDotEl?.setAttribute("cx",e),this.backgroundDotEl?.setAttribute("cy",e),this._backgroundDotSize=t}get backgroundPosition(){return this._backgroundPosition}set backgroundPosition(t){this.backgroundEl&&(this.backgroundEl?.setAttribute("x",t.x.toString()),this.backgroundEl?.setAttribute("y",t.y.toString()),this._backgroundPosition=t)}updateScale(t){0==this.lastTime&&(this.lastTime=t);const e=(t-this.lastTime)/1e3;var i,n,s;this.lastTime=t,Math.abs(this.targetScale-this.scale)>1e-4&&(this.scale=x(this.scale,this.targetScale,6*e)),this.targetPosition.sub(this.position).magnitude>.001&&(this.position=(i=this.position,n=this.targetPosition,s=6*e,new b(x(i.x,n.x,s),x(i.y,n.y,s))));let o=g.screenBounds;this.hiddenNodes.sort(((t,e)=>{const i=t.bounds.center,n=e.bounds.center;return i.sub(o.center).magnitude-n.sub(o.center).magnitude}));for(let t=0;t<50&&!(t>=this.hiddenNodes.length);t++){const e=this.hiddenNodes[t];if(!e){this.hiddenNodes.splice(t,1);continue}const i=e.bounds.expand(100).overlaps(o);e.nodeEl.style.display=i?"":"none",i&&this.hiddenNodes.splice(t,1)}requestAnimationFrame(this.updateScale.bind(this))}initEvents(){const t=new IntersectionObserver((t=>{t.forEach((t=>{t.target.style.display=t.isIntersecting?"":"none",t.isIntersecting||this.hiddenNodes.push(t.target.nodeObj)}))}),{root:null,rootMargin:"0px",threshold:0});this.nodes.forEach((e=>t.observe(e.nodeEl)));const e=this,i=navigator.userAgent.includes("Windows");function n(t){const i=e.wrapperEl.getBoundingClientRect(),n=t.clientX-i.left,s=t.clientY-i.top;return new b(n,s)}function s(t,e,i){const n=i?.scrollContainer;if(n){if(0!=n.scrollTop&&t<0&&Math.abs(t/(e+.01))>2)return!1;if(n.scrollHeight-n.scrollTop>n.clientHeight+1&&t>0&&Math.abs(t/(e+.01))>2)return!1;if(0!=n.scrollLeft&&e<0&&Math.abs(e/(t+.01))>2)return!1;if(n.scrollWidth-n.scrollLeft>n.clientWidth+1&&e>0&&Math.abs(e/(t+.01))>2)return!1}return!0}this.wrapperEl.addEventListener("pointerdown",(function(t){if("mouse"!=t.pointerType&&"pen"!=t.pointerType)return;const s=n(t),o=e.position,r=e.focusedNode;function a(t){if(i&&r?.isScrollable&&4==t.buttons)return;t.preventDefault();const a=n(t).sub(s);e.forcePosition=o.add(a)}document.addEventListener("mousemove",a),document.addEventListener("mouseup",(function t(e){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",t)}))})),this.wrapperEl.addEventListener("wheel",(function(t){if(!s(t.deltaY,t.deltaX,e.focusedNode))return;let i=1;i-=t.deltaY/700*i,e.scaleAround(i,n(t))}),{passive:!0});let o=!1;this.wrapperEl.addEventListener("touchstart",(function(t){if(o)return;o=!0;const i=t.touches;function r(t){const e=n(t[0]),i=2==t.length?n(t[1]):null,s=i?e.add(i).scale(.5):e;return{touch1:e,touch2:i,center:s,distance:i?b.distance(e,i):0}}let a=r(i),l=2==i.length;const c=e.focusedNode;function h(t){const i=t.touches,n=r(i);if(2==i.length){l||(a=r(i),l=!0);const t=(n.distance-a.distance)/a.distance;e.scaleAround(1+t,n.center)}const o=n.center.sub(a.center);l||s(-o.y,o.x,c)?(t.preventDefault(),e.targetPosition=e.targetPosition.add(o),a=r(i)):a=r(i)}document.addEventListener("touchmove",h),document.addEventListener("touchend",(function t(e){document.removeEventListener("touchmove",h),document.removeEventListener("touchend",t),o=!1}))}))}scaleAround(t,e,i=!1){const n=this.targetScale;let s=n*t;s=Math.min(Math.max(s,this.minScale),this.maxScale),t=s/n;const o=e.sub(this.targetPosition).scale(t).add(this.targetPosition),r=e.sub(o);return i?(this.scale*=t,this.targetScale=this.scale,this.forcePosition=this.forcePosition.add(r)):(this.targetScale*=t,this.targetPosition=this.targetPosition.add(r)),r}setScaleAround(t,e,i=!1){this.scaleAround(t/this.targetScale,e,i)}fitToBounds(t=this.nodeBounds,e=.9,i=!1){this.hideNodesOutsideBounds(t.scale(2));const n=this.document.containerEl.clientWidth,s=this.document.containerEl.clientHeight,o=n/t.width,r=s/t.height,a=e*Math.min(o,r);this.scaleAround(a,t.center,i),this.centerView(t.center,i)}hideNodesOutsideBounds(t){for(const e of this.nodes)t.overlaps(e.bounds)||(e.nodeEl.style.display="none",this.hiddenNodes.push(e))}centerView(t,e=!1){const i=this.wrapperBounds.center.sub(t);e?this.forcePosition=this.forcePosition.add(i):this.targetPosition=this.targetPosition.add(i)}},L=class{constructor(t="#right-sidebar-content",e="start"){this.selector="#right-sidebar-content",this.type="start",this.selector=t,this.type=e}},T=class{constructor(){this.featureId="feature",this.enabled=!0,this.unavailable=!1,this.alwaysEnabled=!1,this.hideSettingsButton=!1}setAvailable(t){this.unavailable=!t,this.enabled=t}},_=class extends T{constructor(t,e){super(),this.featurePlacement=new L,this.featureId=t??"inserted-feature",this.featurePlacement=e??new L}insertFeature(t,e){if(!t)return!1;let i=t.querySelector(this.featurePlacement.selector);if(i)switch(this.featurePlacement.type){case"before":return i.before(e),!0;case"after":return i.after(e),!0;case"start":return i.prepend(e),!0;case"end":return i.append(e),!0;default:return!1}return!1}},I=class extends _{constructor(){super(...arguments),this.displayTitle="Feature"}},P=class extends _{constructor(){super(...arguments)}},O=class extends I{constructor(){super(),this.featureId="aliases",this.displayTitle="Aliases",this.featurePlacement=new L(".header .data-bar","start")}},F=class extends I{constructor(){super(),this.noBacklinks="",this.featureId="backlinks",this.displayTitle="",this.noBacklinks="",this.featurePlacement=new L("#right-sidebar-content","end")}},N=class{};N.libFolderName="site-lib",N.mediaFolderName="media",N.scriptsFolderName="scripts",N.cssFolderName="styles",N.fontFolderName="fonts",N.htmlFolderName="html",N.metadataFileName="metadata.json",N.searchIndexFileName="search-index.json";var M=class extends P{constructor(){super(),this.sourcePath="",this.featureId="custom-head",this.featurePlacement=new L("head","end"),this.includePath=`${N.libFolderName}/${N.htmlFolderName}/custom-head.html`}},z=class extends T{constructor(){super(),this.allowFoldingLists=!0,this.allowFoldingHeadings=!0,this.documentWidth="45em",this.showCreatedUpdatedTime=!0,this.featureId="obsidian-document",this.alwaysEnabled=!0}},A=class extends P{constructor(){super(),this.showCustomIcons=!1,this.showDefaultFolderIcons=!1,this.showDefaultFileIcons=!1,this.defaultFolderIcon="lucide//folder",this.defaultFileIcon="lucide//file",this.defaultMediaIcon="lucide//file-image",this.exposeStartingPath=!0,this.featureId="file-navigation",this.featurePlacement=new L("#left-sidebar-content","end"),this.includePath=`${N.libFolderName}/${N.htmlFolderName}/file-tree.html`}},R=class extends I{constructor(){super(),this.showOrphanNodes=!0,this.showAttachments=!1,this.allowGlobalGraph=!0,this.allowExpand=!0,this.attractionForce=1,this.linkLength=15,this.repulsionForce=80,this.centralForce=2,this.edgePruning=100,this.minNodeRadius=3,this.maxNodeRadius=7,this.featureId="graph-view",this.displayTitle="",this.featurePlacement=new L("#right-sidebar-content","start")}},D=class extends T{constructor(){super(),this.featureId="link-preview",this.hideSettingsButton=!0}},B=class extends I{constructor(){super(),this.autoCollapseDepth=1,this.featureId="outline",this.displayTitle="",this.featurePlacement=new L("#right-sidebar-content","end")}},H=class extends I{constructor(){super(),this.showYamlProperties=!0,this.yamlPropertiesDefaultExpanded=!1,this.featureId="properties",this.displayTitle="",this.featurePlacement=new L(".header","start")}},q=class extends T{constructor(){super(),this.siteUrl="",this.authorName="",this.featureId="rss"}},W=class extends I{constructor(){super(),this.featureId="search",this.displayTitle="",this.featurePlacement=new L("#left-sidebar .topbar-content","start")}},$=class extends T{constructor(){super(),this.allowResizing=!0,this.allowCollapsing=!0,this.rightDefaultWidth="20em",this.leftDefaultWidth="20em",this.featureId="sidebar"}},V=class extends I{constructor(){super(),this.showInlineTags=!0,this.showFrontmatterTags=!0,this.featureId="tags",this.displayTitle="",this.featurePlacement=new L(".header .data-bar","end")}},j=class extends I{constructor(){super(),this.featureId="theme-toggle",this.displayTitle="",this.featurePlacement=new L("#right-sidebar .topbar-content","start")}},Y=class extends _{constructor(){super(),this.copyrightText="© {year} {author}. All rights reserved.",this.author="",this.authorUrl="",this.featureId="copyright",this.enabled=!1,this.featurePlacement=new L(".footer .data-bar","end")}},U=class extends _{constructor(){super(),this.links=[],this.linkColorDark="#3ac4df",this.linkColorLight="#0c6fff",this.featureId="footer-links",this.enabled=!1,this.featurePlacement=new L(".footer .data-bar","end")}},G=class extends T{constructor(){super(),this.links=[],this.height="40px",this.backgroundColor="",this.moveThemeToggleToNavbar=!1,this.featureId="navbar",this.enabled=!1}},K=class extends _{constructor(){super(),this.repo="",this.repoId="",this.category="",this.categoryId="",this.mapping="pathname",this.strict=!0,this.reactionsEnabled=!0,this.emitMetadata=!1,this.inputPosition="bottom",this.theme="preferred_color_scheme",this.lang="zh-CN",this.loading="lazy",this.featureId="giscus",this.enabled=!1,this.featurePlacement=new L(".footer .data-bar","start")}},X=class extends T{constructor(){super(),this.showLineNumbers=!0,this.defaultCollapse=!0,this.collapseThreshold=30,this.defaultWrap=!1,this.showBottomExpandButton=!0,this.enableHighlightLine=!0,this.highlightLineColor="#464646",this.highlightLineOpacity=.5,this.featureId="code-block",this.alwaysEnabled=!0}},J=class extends T{constructor(){super(),this.enableVercelInsights=!1,this.enableVercelSpeedInsights=!1,this.featureId="vercel-insights",this.alwaysEnabled=!0}},Q=class{static fromJSON(t){let e=Object.assign(new Q,JSON.parse(t));return e.backlinks=Object.assign(new F,e.backlinks),e.tags=Object.assign(new V,e.tags),e.alias=Object.assign(new O,e.alias),e.properties=Object.assign(new H,e.properties),e.fileNavigation=Object.assign(new A,e.fileNavigation),e.search=Object.assign(new W,e.search),e.outline=Object.assign(new B,e.outline),e.themeToggle=Object.assign(new j,e.themeToggle),e.graphView=Object.assign(new R,e.graphView),e.sidebar=Object.assign(new $,e.sidebar),e.customHead=Object.assign(new M,e.customHead),e.document=Object.assign(new z,e.document),e.rss=Object.assign(new q,e.rss),e.linkPreview=Object.assign(new D,e.linkPreview),e.giscus=Object.assign(new K,e.giscus),e.footerLinks=Object.assign(new U,e.footerLinks??{}),e.navbar=Object.assign(new G,e.navbar??{}),e.copyright=Object.assign(new Y,e.copyright??{}),e.codeBlock=Object.assign(new X,e.codeBlock??{}),e.vercelInsights=Object.assign(new J,e.vercelInsights??{}),e}},Z=class{constructor(){this.ignoreMetadata=!1,this.webpages={},this.fileInfo={},this.sourceToTarget={},this.attachments=[],this.shownInTree=[],this.allFiles=[],this.siteName="",this.vaultName="",this.createdTime=0,this.modifiedTime=0,this.pluginVersion="",this.exportRoot="",this.baseURL="",this.themeName="",this.bodyClasses="",this.hasFavicon=!1,this.featureOptions=new Q,this.exportOptions={}}static fromJSON(t){let e=Object.assign(new Z,JSON.parse(t));return e.featureOptions=Q.fromJSON(JSON.stringify(e.featureOptions)),e}},tt=class{constructor(t,e=!0){this._collapsed=!1,this.calloutEl=t,this.titleEl=t.querySelector(".callout-title-inner"),this.contentEl=t.querySelector(".callout-content"),this.iconEl=t.querySelector(".callout-icon"),this.foldIconEl=t.querySelector(".callout-fold");switch(t.getAttribute("data-callout-fold")){case"+":this.foldType=0,this._collapsed=!1;break;case"-":this.foldType=1,this._collapsed=!0;break;default:this.foldType=2,this._collapsed=!1}this.type=t.getAttribute("data-callout")??"",this.metadata=t.getAttribute("data-callout-metadata")??"",e&&this.init()}get title(){return this.titleEl?.textContent??""}set title(t){this.titleEl.textContent=t}get collapsed(){return this._collapsed}set collapsed(t){this.toggle(t)}toggle(t){2!=this.foldType&&(void 0===t&&(t=!this._collapsed),this.calloutEl?.classList.toggle("is-collapsed",t),this.foldIconEl?.classList.toggle("is-collapsed",t),t?v(this.contentEl,150):w(this.contentEl,150),this._collapsed=t)}collapse(){this.toggle(!0)}expand(){this.toggle(!1)}init(){this.foldIconEl&&this.foldIconEl.addEventListener("click",(()=>{this.toggle()}))}},et=class{constructor(t){this._children=[],this._isCollapsed=!1,this._content=[],this._divParent=t.parentElement,this._headerElement=t,this._collapseIndicatorElement=this._headerElement.querySelector(".heading-collapse-indicator"),this._id=t.id,this._level=parseInt(t.tagName.replace("H","")),et.headerMap.set(t,this),this._collapseIndicatorElement&&this._collapseIndicatorElement.addEventListener("click",(()=>{this.toggleCollapse()})),this.addAnchorCopyButton(),et.injectStyles()}addAnchorCopyButton(){if(!this._id)return;const t=document.createElement("button");t.className="heading-anchor-copy-button",t.textContent="#",t.setAttribute("aria-label","复制标题链接"),t.title="复制标题链接",t.onclick=e=>{e.preventDefault(),e.stopPropagation();const i=`${window.location.origin}${window.location.pathname}#${this._id}`;navigator.clipboard.writeText(i),t.classList.add("is-active"),setTimeout((()=>{t.classList.remove("is-active")}),1e3)},this._headerElement.appendChild(t)}static injectStyles(){if(document.getElementById("heading-anchor-styles"))return;const t=document.createElement("style");t.id="heading-anchor-styles",t.textContent="\n            .heading-anchor-copy-button {\n                display: inline-flex;\n                align-items: center;\n                justify-content: center;\n                \n                /* 1. 核心清除：移除所有按钮痕迹 */\n                background: none !important;\n                border: none !important;\n                outline: none !important;           /* 防止点击时出现蓝色外框 */\n                box-shadow: none !important;         /* 移除阴影 */\n                -webkit-appearance: none;            /* 移除系统级按钮外观 */\n                appearance: none;\n                padding: 0;\n                \n                /* 2. 视觉表现：看起来像文本 */\n                opacity: 0;                          /* 默认隐藏，悬庭才显示 */\n                color: var(--text-faint);            /* 使用淡淡的文字颜色 */\n                font-size: 0.9em;\n                margin-left: 0.2em;\n                cursor: pointer;\n                font-family: var(--font-monospace);  /* 使用等宽字体让 # 更美观 */\n                vertical-align: middle;\n                \n                transition: opacity 0.2s ease-in-out, color 0.15s ease-in-out;\n            }\n\n            /* 3. 状态控制：强力确保任何时刻都没有背景和边框 */\n            .heading-anchor-copy-button:hover,\n            .heading-anchor-copy-button:focus,\n            .heading-anchor-copy-button:active,\n            .heading-anchor-copy-button:focus-visible {\n                outline: none !important;\n                border: none !important;\n                box-shadow: none !important;\n                background: none !important;\n            }\n\n            /* 4. 悬停效果：仅在鼠标移入标题时显示 */\n            h1:hover .heading-anchor-copy-button,\n            h2:hover .heading-anchor-copy-button,\n            h3:hover .heading-anchor-copy-button,\n            h4:hover .heading-anchor-copy-button,\n            h5:hover .heading-anchor-copy-button,\n            h6:hover .heading-anchor-copy-button {\n                opacity: 0.4;  /* 设置为半透明，不喧宾夺主 */\n            }\n\n            /* 5. 点击激活时反馈：通过改变不透明度和颜色来示意 */\n            .heading-anchor-copy-button.is-active {\n                opacity: 1 !important;\n                color: var(--text-normal) !important;\n            }\n        ",document.head.appendChild(t)}get id(){return this._id}get text(){return this._headerElement.textContent??""}set text(t){this._headerElement.textContent=t}get level(){return this._level}get headerElement(){return this._headerElement}get collapseIndicatorElement(){return this._collapseIndicatorElement}get children(){return this._children}get isCollapsed(){return this._isCollapsed}scrollTo(t={behavior:"smooth",block:"start"}){this._headerElement.scrollIntoView(t)}find(t){if(t(this))return this;for(const e of this.children){const i=e.find(t);if(i)return i}}findByID(t){return t.startsWith("#")&&(t=t.substring(1)),this.find((e=>e.id===t))}getFlatChildren(){let t=[this];for(const e of this._children)t=t.concat(e.getFlatChildren());return t}toggleCollapse(){this._isCollapsed=!this._isCollapsed,this._collapseIndicatorElement?.classList.toggle("is-collapsed",this._isCollapsed),this._headerElement.classList.toggle("is-collapsed",this._isCollapsed),this.updateVisibility(this._isCollapsed)}updateVisibility(t){this._collapseIndicatorElement?.classList.toggle("is-collapsed",t),this._headerElement.classList.toggle("is-collapsed",t);for(const e of this._content)e.style.display=t?"none":"";for(const e of this._children)e.headerElement.style.display=t?"none":"",t?e.updateVisibility(!0):e.updateVisibility(e._isCollapsed)}getHeaderWithContentRecursive(){let t=[];t.push(this._divParent);for(const e of this._content)t.push(e);for(const e of this._children)t=t.concat(e.getHeaderWithContentRecursive());return t}static createHeaderTree(t){const e=Array.from(t.querySelectorAll("h1, h2, h3, h4, h5, h6")).map((t=>new et(t))),i=[],n=[];for(let t=0;t<e.length;t++){const s=e[t];for(;n.length>0&&n[n.length-1].level>=s.level;)n.pop();n.length>0?n[n.length-1].children.push(s):i.push(s),n.push(s);let o=s.headerElement.nextElementSibling;for(;o&&!(o instanceof HTMLHeadingElement);)o instanceof HTMLElement&&s._content.push(o),o=o.nextElementSibling;for(o=s.headerElement.parentElement?.nextElementSibling??null;o&&!o.querySelector("h1, h2, h3, h4, h5, h6");)o instanceof HTMLElement&&!o.classList.contains("footer")&&s._content.push(o),o=o.nextElementSibling}return i}},it=et;it.headerMap=new WeakMap;var nt=class{constructor(t,e,i){this.isPinned=!1,this.resizeObserver=null,this.hoverTimeout=null,this.showTimeout=null,this.link=t,this.target=e,this.onRemove=i,this.createPreviewElements(),this.setupEventListeners(),this.positionPreview(),this.setupOutsideClickListener()}static savePinnedPreviews(){const t=nt.pinnedPreviews.map((t=>({target:t.target,top:t.filePreviewPopover.style.top,left:t.filePreviewPopover.style.left,width:t.filePreviewPopover.style.width,height:t.filePreviewPopover.style.height,zIndex:t.filePreviewPopover.style.zIndex})));localStorage.setItem("pinnedPreviews",JSON.stringify(t))}static loadPinnedPreviews(){JSON.parse(localStorage.getItem("pinnedPreviews")??"[]").forEach((async t=>{const e=new nt(null,t.target,(()=>{}));e.setPinned(!0),e.filePreviewPopover.style.top=t.top,e.filePreviewPopover.style.left=t.left,e.filePreviewPopover.style.width=t.width,e.filePreviewPopover.style.height=t.height,e.filePreviewPopover.style.zIndex=t.zIndex||nt.baseZIndex.toString(),e.show()}))}static create(t,e,i,n=!0){const s=new nt(null,t,(()=>{}));s.setPinned(n),s.filePreviewPopover.style.top=i+"px",s.filePreviewPopover.style.left=e+"px",s.show()}static initializeLink(t,e){let i=null;t.addEventListener("pointerenter",(function(){i||(i=new nt(t,e,(()=>{i=null})),i.startShowTimeout())})),t.addEventListener("pointerleave",(function(){i&&(i.isPinned||i.startRemoveTimeout(),i.clearShowTimeout())})),t.addEventListener("click",(function(t){i&&(i.isPinned||i.startRemoveTimeout(),i.clearShowTimeout())}))}createPreviewElements(){this.filePreviewPopover=document.createElement("div"),this.filePreviewPopover.className="file-preview popover hover-popover hide",document.body.appendChild(this.filePreviewPopover),this.markdownEmbed=document.createElement("div"),this.markdownEmbed.className="markdown-embed",this.filePreviewPopover.appendChild(this.markdownEmbed),this.markdownEmbedContent=document.createElement("div"),this.markdownEmbedContent.className="markdown-embed-content",this.markdownEmbed.appendChild(this.markdownEmbedContent),this.actionContainer=document.createElement("div"),this.actionContainer.className="preview-action-container",this.filePreviewPopover.appendChild(this.actionContainer),this.dragHandle=document.createElement("div"),this.dragHandle.className="drag-handle clickable-icon popover-action",this.actionContainer.appendChild(this.dragHandle),this.pinButton=document.createElement("button"),this.pinButton.className="pin-button clickable-icon popover-action",this.actionContainer.appendChild(this.pinButton),this.goToButton=document.createElement("button"),this.goToButton.className="go-to-button clickable-icon popover-action",this.actionContainer.appendChild(this.goToButton),this.filePreviewPopover.style.zIndex=nt.baseZIndex.toString(),this.bringToFront()}setPinned(t){this.isPinned=t,this.pinButton.classList.toggle("pinned",this.isPinned),this.filePreviewPopover.classList.toggle("pinned",this.isPinned),this.isPinned?nt.pinnedPreviews.push(this):nt.pinnedPreviews=nt.pinnedPreviews.filter((t=>t!==this))}setupEventListeners(){this.pinButton.addEventListener("click",(()=>{this.setPinned(!this.isPinned),nt.savePinnedPreviews()})),this.goToButton.addEventListener("click",(()=>{ObsidianSite.loadURL(this.target)})),this.setupDragHandleListeners(),this.filePreviewPopover.addEventListener("pointerenter",(()=>{this.clearRemoveTimeout()})),this.filePreviewPopover.addEventListener("pointerleave",(()=>{this.isPinned||this.startRemoveTimeout()})),this.setupResizeObserver()}updateMaxSize(){const t=window.innerWidth,e=window.innerHeight,i=this.filePreviewPopover.getBoundingClientRect(),n=t-i.left-10,s=e-i.top-10;this.filePreviewPopover.style.maxWidth=`${n}px`,this.filePreviewPopover.style.maxHeight=`${s}px`;const o=Math.max(10,i.left),r=Math.max(10,i.top);o!==i.left&&(this.filePreviewPopover.style.left=`${o}px`),r!==i.top&&(this.filePreviewPopover.style.top=`${r}px`),nt.savePinnedPreviews()}setupResizeObserver(){this.updateMaxSize(),this.resizeObserver=new ResizeObserver((()=>{this.updateMaxSize()})),this.resizeObserver.observe(this.filePreviewPopover),window.addEventListener("resize",this.updateMaxSize)}dragPreviewCallback(t){t.stopPropagation(),this.bringToFront();const e=t.clientX-this.filePreviewPopover.getBoundingClientRect().left,i=t.clientY-this.filePreviewPopover.getBoundingClientRect().top,n=t=>{let n=t.clientX-e,s=t.clientY-i;const o=window.innerWidth,r=window.innerHeight,a=this.filePreviewPopover.getBoundingClientRect();n=Math.max(0,Math.min(n,o-a.width)),s=Math.max(0,Math.min(s,r-a.height)),this.filePreviewPopover.style.left=n+"px",this.filePreviewPopover.style.top=s+"px",this.updateMaxSize()},s=()=>{this.isPinned&&nt.savePinnedPreviews(),document.removeEventListener("pointermove",n),document.removeEventListener("pointerup",s)};document.addEventListener("pointermove",n),document.addEventListener("pointerup",s)}setupDragHandleListeners(){this.dragHandle.addEventListener("pointerdown",this.dragPreviewCallback.bind(this)),this.actionContainer.addEventListener("pointerdown",this.dragPreviewCallback.bind(this))}positionPreview(){if(!this.link)return;const t=this.link.getBoundingClientRect(),e=this.filePreviewPopover.getBoundingClientRect(),i=window.innerWidth,n=window.innerHeight;this.filePreviewPopover.style.top="",this.filePreviewPopover.style.left="";const s=10;let o,r;o=n-t.bottom>=e.height+s?t.bottom+s:Math.max(s,t.top-e.height-s),r=t.left,r+e.width>i-s&&(r=Math.max(s,t.right-e.width)),o=Math.min(Math.max(s,o),n-e.height-s),r=Math.min(Math.max(s,r),i-e.width-s),this.filePreviewPopover.style.top=`${o}px`,this.filePreviewPopover.style.left=`${r}px`}setupOutsideClickListener(){this.outsideClickListener=t=>{this.isPinned||this.filePreviewPopover.contains(t.target)||this.link?.contains(t.target)||this.remove()},document.addEventListener("pointerdown",this.outsideClickListener)}startShowTimeout(){this.clearShowTimeout(),this.showTimeout=window.setTimeout((()=>this.show()),350)}clearShowTimeout(){null!==this.showTimeout&&(clearTimeout(this.showTimeout),this.showTimeout=null)}async show(){this.filePreviewDocument=new Lt(this.target),await((await this.filePreviewDocument.load(null,this.markdownEmbedContent,!0,!0))?.show()),this.positionPreview(),this.filePreviewPopover.classList.remove("hide")}bringToFront(){let t=Math.max(nt.baseZIndex,...nt.pinnedPreviews.map((t=>parseInt(t.filePreviewPopover.style.zIndex)||nt.baseZIndex)));t>=nt.maxZIndex&&(nt.pinnedPreviews.forEach(((t,e)=>{t.filePreviewPopover.style.zIndex=(nt.baseZIndex+e).toString()})),t=nt.baseZIndex+nt.pinnedPreviews.length-1),this.filePreviewPopover.style.zIndex=(t+1).toString()}startRemoveTimeout(){this.clearRemoveTimeout(),this.hoverTimeout=window.setTimeout((()=>this.remove()),300)}clearRemoveTimeout(){null!==this.hoverTimeout&&(clearTimeout(this.hoverTimeout),this.hoverTimeout=null)}remove(){this.clearRemoveTimeout(),this.clearShowTimeout(),this.filePreviewPopover&&this.filePreviewPopover.parentNode&&this.filePreviewPopover.parentNode.removeChild(this.filePreviewPopover),this.resizeObserver&&this.resizeObserver.disconnect(),window.removeEventListener("resize",this.updateMaxSize),document.removeEventListener("pointerdown",this.outsideClickListener),this.onRemove()}},st=nt;st.baseZIndex=100,st.maxZIndex=1e3,st.pinnedPreviews=[];var ot=class{static initializeLinks(t){console.log("Initializing links on element",t),t?.querySelectorAll(".internal-link, a.tag, a.tree-item-self, a.footnote-link").forEach((function(t){const e=t.getAttribute("href")??"null";"null"!=e?(t.addEventListener("click",(function(i){if(i.preventDefault(),i.stopPropagation(),ObsidianSite.loadURL(e),"phone"===ObsidianSite.deviceSize){const e=t.closest("#left-sidebar"),i=t.closest("#right-sidebar");e&&!1===ObsidianSite.leftSidebar?.collapsed?ObsidianSite.leftSidebar.collapsed=!0:i&&!1===ObsidianSite.rightSidebar?.collapsed&&(ObsidianSite.rightSidebar.collapsed=!0)}})),!e||e.startsWith("http")||ObsidianSite.documentExists(e)?t.classList.contains("internal-link")&&!ObsidianSite.metadata?.ignoreMetadata&&ObsidianSite.metadata?.featureOptions?.linkPreview?.enabled&&st.initializeLink(t,e):t.classList.add("is-unresolved")):console.log("No target found for link")}))}static getPathnameFromURL(t){return""==t||"/"==t||"\\"==t?"index.html":t?.startsWith("#")||t?.startsWith("?")?(ObsidianSite.document?.pathname?.split("#")[0]?.split("?")[0]??"")+(t??""):t?.split("?")[0]?.split("#")[0]?.trim()??""}static getHashFromURL(t){return(t.split("#")[1]??"").split("?")[0]?.trim()??""}static getQueryFromURL(t){return t.split("?")[1]?.trim()??""}static getFileDataIdFromURL(t){for((t=this.getPathnameFromURL(t)).startsWith("./")&&(t=t.substring(2));t.startsWith("../");)t=t.substring(3);return btoa(encodeURI(t))}},rt=class{constructor(t,e){this.parent=void 0,this.collapsible=!1,this.collapseEl=void 0,this.line=0,this.itemEl=t,this.parent=e,this.line=parseInt(this.itemEl.getAttribute("data-line")??"0"),this.collapseEl=Array.from(this.itemEl.children).find((t=>t.classList.contains("list-collapse-indicator")));const i=this.itemEl.querySelector("ol, ul");if(i&&(this.child=new at(i,this),this.collapseEl)){this.collapsible=!0;const t=this;this.collapseEl.addEventListener("click",(function(e){t.isCollapsed=!t.isCollapsed,e.stopPropagation()}))}}get isChecked(){return this.itemEl.classList.contains("is-checked")}get isCollapsed(){return this.itemEl.classList.contains("is-collapsed")}set isCollapsed(t){this.itemEl.classList.toggle("is-collapsed",t),this.collapseEl&&this.collapseEl.classList.toggle("is-collapsed",t)}get textContent(){return Array.prototype.filter.call(this.itemEl.childNodes,(t=>t.nodeType===Node.TEXT_NODE)).map((t=>t.textContent)).join("").trim()}get htmlContent(){return this.itemEl.innerHTML}},at=class{constructor(t,e){if(this.children=[],this.parent=void 0,"OL"!=t.tagName&&"UL"!=t.tagName)throw new Error("Invalid list element");this.listType="OL"==t.tagName?"ordered":t.classList.contains("contains-task-list")?"checklist":"unordered",this.listEl=t,this.parent=e;Array.from(this.listEl.children).filter((t=>"LI"==t.tagName)).forEach((t=>{this.children.push(new rt(t,this))}))}get linearList(){let t=[];return this.children.forEach((e=>{t.push(e),e.child&&(t=t.concat(e.child.linearList))})),t}},lt=class{constructor(t,e=5e3){this.message=t,this.duration=e,this.show()}show(){if(!lt.container){lt.container=document.createElement("div"),lt.container.classList.add("notice-container");(document.getElementById("layout")||document.body).appendChild(lt.container)}this.notification=document.createElement("div"),this.notification.classList.add("notice"),this.notification.innerHTML=this.message,lt.container.appendChild(this.notification),this.notification.style.opacity="0",this.notification.style.transform="translateX(350px)",this.notification.style.transition="all 0.5s",setTimeout((()=>{this.notification.style.opacity="1",this.notification.style.transform="translateX(0)",this.notification.style.height=this.notification.scrollHeight+"px"}),100),setTimeout((()=>{this.dismiss()}),this.duration),this.notification.addEventListener("click",(()=>{this.dismiss()}),{once:!0})}dismiss(){this.notification&&(this.notification.style.opacity="0",this.notification.style.height="0",this.notification.style.margin="0",this.notification.style.padding="0",setTimeout((()=>{this.notification.remove()}),500))}},ct=class{constructor(){}parseAndDisplayYamlProperties(t,e){const i=window.ObsidianSite.metadata.featureOptions.properties;if(!i?.showYamlProperties)return;const n=this.extractFrontmatter(e);if(!n||0===Object.keys(n).length)return;const s={},o=i.hideProperties||[];for(const t in n)o.includes(t)||(s[t]=n[t]);if(0===Object.keys(s).length)return;const r=this.createYamlPropertiesContainer(s,i.yamlPropertiesDefaultExpanded),a=e.querySelector(".data-bar");if(a)a.parentNode?.insertBefore(r,a);else{const t=e.querySelector("h1");t&&t.parentNode?.insertBefore(r,t.nextSibling)}}extractFrontmatter(t){try{const e=t.querySelector(".frontmatter, .yaml-frontmatter, pre[data-frontmatter]");if(!e)return null;const i=e.cloneNode(!0);i.querySelectorAll(".line-numbers-wrapper, .line-number").forEach((t=>t.remove()));const n=i.textContent;return n?this.parseYaml(n):null}catch(t){return console.warn("解析YAML前置属性失败:",t),null}}parseYaml(t){const e={},i=t.split("\n");let n=null;for(let t of i){if(t=t.trim(),!t||"---"===t)continue;if(t.startsWith("- ")){n&&(Array.isArray(e[n])||(e[n]=[]),e[n].push(t.substring(2).trim().replace(/^['"](.*)['"]$/,"$1")));continue}const i=t.indexOf(":");if(-1!==i){const s=t.substring(0,i).trim();let o=t.substring(i+1).trim();""===o?(n=s,e[s]=[]):(n=s,o.startsWith("[")&&o.endsWith("]")?o=o.substring(1,o.length-1).split(",").map((t=>t.trim().replace(/^['"](.*)['"]$/,"$1"))):(o=o.replace(/^['"](.*)['"]$/,"$1"),"true"===o?o=!0:"false"===o?o=!1:isNaN(Number(o))||""===o||(o=Number(o))),e[s]=o)}}return e}createYamlPropertiesContainer(t,e){const i=document.createElement("div");i.className="yaml-properties-container";const n=document.createElement("div");n.className="yaml-properties-header";const s=document.createElement("div");s.className="yaml-properties-title",s.textContent="文档属性";const o='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>',r='<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon"><path d="m7 20 5-5 5 5"></path><path d="m7 4 5 5 5-5"></path></svg>',a=document.createElement("button");a.className="yaml-properties-toggle",a.innerHTML=e?r:o,n.appendChild(s),n.appendChild(a);const l=document.createElement("div");l.className="yaml-properties-content",l.style.display=e?"block":"none";const c=this.createPropertiesTable(t);return l.appendChild(c),i.appendChild(n),i.appendChild(l),n.style.cursor="pointer",n.addEventListener("click",(()=>{const t="block"===l.style.display;l.style.display=t?"none":"block",a.innerHTML=t?o:r})),this.injectStyles(),i}createPropertiesTable(t){const e=document.createElement("table");e.className="yaml-properties-table";const i=t=>/^(https?:\/\/[^\s]+)$/.test(t);for(const n in t){const s=document.createElement("tr"),o=document.createElement("td");o.className="yaml-property-key",o.textContent=n;const r=document.createElement("td");r.className="yaml-property-value";const a=t[n],l=n.toLowerCase();if("tags"===l||"tag"===l){const t=Array.isArray(a)?a:String(a).split(/[\s,]+/).filter((t=>t.trim().length>0));t.forEach(((e,i)=>{const n=e.startsWith("#")?e:"#"+e,s=document.createElement("a");s.className="tag",s.textContent=n;const o=n.startsWith("#")?n.substring(1):n;s.href=`?query=tags:${encodeURIComponent(o)}`,r.appendChild(s),i<t.length-1&&r.appendChild(document.createTextNode(" "))}))}else if("boolean"==typeof a){const t=document.createElement("span");t.className="property-boolean "+(a?"is-true":"is-false"),t.textContent=a?"true":"false",r.appendChild(t)}else if(Array.isArray(a))a.forEach(((t,e)=>{const i=document.createElement("span");i.className="property-list-item",i.textContent=String(t),i.style.cursor="pointer",i.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),window.ObsidianSite.search?.searchParseFilters('"'+String(t)+'"')})),r.appendChild(i),e<a.length-1&&r.appendChild(document.createTextNode(" "))}));else if("string"==typeof a&&i(a)){const t=document.createElement("a");t.className="external-link",t.href=a,t.target="_blank",t.rel="noopener",t.textContent=a,r.appendChild(t)}else r.textContent=String(a);s.appendChild(o),s.appendChild(r),e.appendChild(s)}return e}injectStyles(){if(document.getElementById("yaml-properties-styles"))return;const t=document.createElement("style");t.id="yaml-properties-styles",t.textContent="\n            .yaml-properties-container {\n                border: 1px solid var(--background-modifier-border);\n                border-radius: 4px;\n                margin: 1em 0;\n                padding: 0;\n                overflow: hidden;\n                width: 100%;\n                box-sizing: border-box;\n            }\n            .yaml-properties-header {\n                background-color: transparent;\n                padding: 8px 12px;\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                border-bottom: 1px solid var(--background-modifier-border);\n            }\n            .yaml-properties-title {\n                font-weight: bold;\n                font-size: 0.9em;\n                color: var(--text-muted);\n            }\n            .yaml-properties-toggle {\n                background: none;\n                border: none;\n                color: var(--text-muted);\n                cursor: pointer;\n                padding: 0 16px;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                transition: color 0.2s ease;\n            }\n            .yaml-properties-toggle:hover {\n                color: var(--text-normal);\n            }\n            .yaml-properties-toggle svg {\n                width: 18px;\n                height: 18px;\n            }\n            .yaml-properties-content {\n                padding: 8px 12px;\n                width: 100%;\n                box-sizing: border-box;\n            }\n            .yaml-properties-table {\n                width: 100% !important;\n                border-collapse: collapse;\n                font-size: 0.9em;\n                table-layout: fixed;\n                margin: 0;\n                display: table;\n            }\n            .yaml-properties-table tr {\n                width: 100%;\n                display: table-row;\n            }\n            .yaml-property-key {\n                color: var(--text-muted);\n                width: 30% !important;\n                padding: 4px 8px 4px 0;\n                vertical-align: top;\n                box-sizing: border-box;\n            }\n            .yaml-property-value {\n                padding: 4px 0;\n                word-break: break-all;\n                width: 70% !important;\n                box-sizing: border-box;\n                flex-wrap: wrap;\n                gap: 4px;\n                align-items: center;\n                overflow-wrap: break-word;\n            }\n            .yaml-properties-table td {\n                box-sizing: border-box;\n            }\n            .yaml-property-value .tag,\n            .yaml-property-value .property-list-item {\n                background-color: var(--tag-background);\n                color: var(--tag-color);\n                border: var(--tag-border);\n                border-radius: var(--tag-radius);\n                padding: var(--tag-padding-y) var(--tag-padding-x);\n                font-size: var(--tag-size);\n                text-decoration: none;\n                display: inline-block;\n            }\n            .yaml-property-value .tag:hover,\n            .yaml-property-value .property-list-item:hover {\n                background-color: var(--tag-background-hover);\n                color: var(--tag-color-hover);\n            }\n            .yaml-property-value .external-link {\n                color: var(--link-color);\n                text-decoration: underline;\n            }\n            .yaml-property-value .external-link:hover {\n                color: var(--link-color-hover);\n            }\n            .yaml-property-value .property-boolean.is-true {\n                color: #22c55e;\n                font-weight: bold;\n            }\n            .yaml-property-value .property-boolean.is-false {\n                color: #ef4444;\n                font-weight: bold;\n            }\n        ",document.head.appendChild(t)}},ht=class{constructor(t,e){this.elements=new Map,this._options=t,e?this.replaceFeature(e):this.setupFeatureContainer(),this.options.insertFeature(document.body,this.getElement(ht.FEATURE_KEY)),this.onAfterMount()}getElementDefinitions(){return{[ht.FEATURE_KEY]:{type:"div",className:["feature","hide"],id:this.options.featureId},[ht.HEADER_KEY]:{type:"div",className:"feature-header"},[ht.CONTENT_KEY]:{type:"div",className:`${this.options.featureId}-content`},[ht.TITLE_KEY]:{type:"div",className:"feature-title"}}}getElementHierarchy(){return{[ht.FEATURE_KEY]:null,[ht.HEADER_KEY]:ht.FEATURE_KEY,[ht.TITLE_KEY]:ht.HEADER_KEY,[ht.CONTENT_KEY]:ht.FEATURE_KEY}}createElement(t){const e=document.createElement(t.type);if(t.className){const i=Array.isArray(t.className)?t.className:[t.className];e.classList.add(...i)}return t.id&&(e.id=t.id),t.attributes&&Object.entries(t.attributes).forEach((([t,i])=>{e.setAttribute(t,i)})),e}getElement(t){return this.elements.get(t)}setupFeatureContainer(){const t=this.getElementDefinitions(),e=this.getElementHierarchy();if(Object.entries(t).forEach((([t,e])=>{this.elements.set(t,this.createElement(e))})),Object.entries(e).forEach((([t,e])=>{if(null===e)return;const i=this.elements.get(t),n=this.elements.get(e);i&&n&&n.appendChild(i)})),this._options instanceof I&&this._options.displayTitle?.length>0){const t=this.getElement(ht.TITLE_KEY);t&&(t.innerText=this._options.displayTitle)}setTimeout((()=>{const t=this.getElement(ht.FEATURE_KEY);t?.classList.remove("hide")}),0)}replaceFeature(t){this.destroy();const e=this.getElementDefinitions(),i=this.getElementHierarchy();this.elements.set(ht.FEATURE_KEY,t),Object.entries(e).forEach((([e,n])=>{if(e===ht.FEATURE_KEY)return;let s=t.querySelector(`.${Array.isArray(n.className)?n.className[0]:n.className}`);if(!s){s=this.createElement(n);const t=i[e];if(t){const e=this.elements.get(t);e?.appendChild(s)}}this.elements.set(e,s)}))}onAfterMount(){}get options(){return this._options}destroy(){this.elements.forEach((t=>{t.parentNode&&t.parentNode.removeChild(t)})),this.elements.clear()}},dt=ht;dt.FEATURE_KEY="feature",dt.HEADER_KEY="header",dt.CONTENT_KEY="content",dt.TITLE_KEY="title";var ut=class extends dt{constructor(t,e,i){super(t,i),this.dependencies=e,this.updateContent()}regenerate(){this.updateContent()}updateDependencies(t,e=!0){this.dependencies=t,e&&this.regenerate()}modifyDependencies(t,e=!0){t(this.dependencies),e&&this.regenerate()}getDependencies(){return this.dependencies}updateContent(){let t=this.getElement(dt.CONTENT_KEY);const e=this.getElement(dt.FEATURE_KEY);if(e){if(e.isConnected||this.options.insertFeature(document.body,e),!t?.isConnected||!e.contains(t)){const i=`${this.options.featureId}-content`;let n=e.querySelector(`.${i}`);n?t=n:(t=document.createElement("div"),t.className=i,e.appendChild(t)),this.elements.set(dt.CONTENT_KEY,t)}if(t){for(;t.firstChild;)t.removeChild(t.firstChild);this.generateContent(t)}}}hide(){const t=this.getElement(dt.FEATURE_KEY);t&&(t.style.display="none")}show(){const t=this.getElement(dt.FEATURE_KEY);t&&(t.style.display="")}},pt=class extends ut{constructor(){const t=document.getElementById(ObsidianSite.metadata.featureOptions.giscus.featureId);super(ObsidianSite.metadata.featureOptions.giscus,{},t||void 0)}generateContent(t){if("file:"===window.location.protocol)return void(t.innerText="Giscus does not work on local files (file://). Please host your site on a server.");const e=this.options;if(!(e.repo&&e.repoId&&e.category&&e.categoryId))return void console.warn("Giscus is enabled but not fully configured. Please check your settings.");document.querySelectorAll('script[src="https://giscus.app/client.js"]').forEach((t=>t.remove())),document.querySelectorAll("iframe.giscus-frame").forEach((t=>t.remove()));const i=document.createElement("div");i.classList.add("giscus"),t.appendChild(i);const n=document.createElement("script");n.src="https://giscus.app/client.js",n.setAttribute("data-repo",e.repo),n.setAttribute("data-repo-id",e.repoId),n.setAttribute("data-category",e.category),n.setAttribute("data-category-id",e.categoryId),n.setAttribute("data-mapping",e.mapping),n.setAttribute("data-strict",e.strict?"1":"0"),n.setAttribute("data-reactions-enabled",e.reactionsEnabled?"1":"0"),n.setAttribute("data-emit-metadata",e.emitMetadata?"1":"0"),n.setAttribute("data-input-position",e.inputPosition),n.setAttribute("data-theme",this.getCurrentTheme()),n.setAttribute("data-lang",e.lang),n.setAttribute("data-loading",e.loading),n.crossOrigin="anonymous",n.async=!0,t.appendChild(n),this.setupThemeSync()}onAfterMount(){super.onAfterMount();const t=document.querySelector(".footer .data-bar");if(t){const e=this.getElement(dt.FEATURE_KEY);e&&e.parentElement===t&&t.insertBefore(e,t.firstChild)}}getCurrentTheme(){return document.body.classList.contains("theme-dark")?"dark":"light"}setupThemeSync(){if(this.themeChangeListener)return;this.themeChangeListener=()=>{const t=document.body.classList.contains("theme-dark")?"dark":"light",e=document.querySelector("iframe.giscus-frame");e&&e.contentWindow&&e.contentWindow.postMessage({giscus:{setConfig:{theme:t}}},"https://giscus.app")};const t=document.querySelector(".theme-toggle-input");t&&t.addEventListener("change",this.themeChangeListener)}static initOnEncryptedPage(){if(!ObsidianSite.metadata.featureOptions.giscus.enabled||!ObsidianSite.metadata.exportOptions.enableGiscusOnEncryptedPages)return;const t=document.querySelector("#password-lock-container");if(!t)return;t.querySelectorAll(".password-lock__giscus").forEach((t=>t.remove()));const e=document.createElement("div");e.classList.add("password-lock__giscus"),e.style.marginTop="3rem",e.style.width="100%",e.style.maxWidth="var(--file-line-width)",t.appendChild(e);const i=(new pt).getElement(dt.FEATURE_KEY);i&&(i.classList.remove("hide"),e.appendChild(i))}};function mt(t,e=document.body){const i=document.createElement("div");i.style.color=t,e.appendChild(i);const n=window.getComputedStyle(i).color;e.removeChild(i);const s=n.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);return s?{r:parseInt(s[1]),g:parseInt(s[2]),b:parseInt(s[3])}:null}function gt(t,e,i){const n=t=>(t/=255)<=.03928?t/12.92:Math.pow((t+.055)/1.055,2.4);return.2126*n(t)+.7152*n(e)+.0722*n(i)}function ft(t,e,i=3,n=document.body){const s=mt(e,n),o=mt(t,n);if(!s||!o)return t;const r=gt(s.r,s.g,s.b);let a=gt(o.r,o.g,o.b);var l,c;if((l=a,c=r,(Math.max(l,c)+.05)/(Math.min(l,c)+.05))>=i)return t;if(r<.5){let t=i*(r+.05)-.05;t=Math.min(1,Math.max(0,t));const e=bt(t);return`rgb(${e}, ${e}, ${e})`}{let t=(r+.05)/i-.05;t=Math.min(1,Math.max(0,t));const e=bt(t);return`rgb(${e}, ${e}, ${e})`}}function bt(t){let e;return e=t<=.00303949?12.92*t:1.055*Math.pow(t,1/2.4)-.055,Math.round(255*e)}var yt=class{constructor(t){this.processedContainers=[],this.observer=null,this.containerEl=t,this.initObserver()}static updateHighlightStyles(t){const e="code-block-highlight-styles";let i=document.getElementById(e);i||(i=document.createElement("style"),i.id=e,document.head.appendChild(i));const n=(t?.highlightLineColor||"#464646").replace("#",""),s=parseInt(n.substring(0,2)||"46",16),o=parseInt(n.substring(2,4)||"46",16),r=parseInt(n.substring(4,6)||"46",16),a=t?.highlightLineOpacity??.5;i.textContent=`\n            /* >>>>空格 高亮背景 */\n            .markdown-rendered pre code .highlight-line,\n            .markdown-rendered pre .highlight-line {\n                background-color: rgba(${s}, ${o}, ${r}, ${a});\n\t            display: inline-block;\n\t            box-sizing: border-box;\n\t            padding: 0 0;\n            }\n            /* 预览容器中的高亮样式 */\n            .code-block-highlight-preview pre code .highlight-line,\n            .code-block-highlight-preview pre .highlight-line,\n            .code-block-highlight-preview .highlight-line {\n                background-color: rgba(${s}, ${o}, ${r}, ${a}) !important;\n\t            display: block;\n\t            box-sizing: border-box;\n\t            padding: 0;\n                margin: 0;\n                line-height: inherit;\n            }\n            .code-block-highlight-preview pre code .highlight-line span,\n            .code-block-highlight-preview pre .highlight-line span {\n                display: inline;\n            }\n        `}getTranslation(t,e){try{const e=window.i18n;if(e?.codeBlock?.[t])return e.codeBlock[t]}catch(t){}return e}getCodeBlockOptions(){try{const t=window.ObsidianSite?.metadata;if(t?.featureOptions?.codeBlock)return t.featureOptions.codeBlock}catch(t){}return{showLineNumbers:!0,defaultCollapse:!0,collapseThreshold:30,defaultWrap:!1,showBottomExpandButton:!0,enableHighlightLine:!0,highlightLineColor:"#464646",highlightLineOpacity:.5}}initObserver(){"undefined"!=typeof IntersectionObserver&&(this.observer=new IntersectionObserver((t=>{t.forEach((t=>{if(t.isIntersecting){const e=t.target;this.lazyProcessCodeBlock(e),this.observer?.unobserve(e)}}))}),{rootMargin:"200px 0px"}))}lazyProcessCodeBlock(t){if("true"===t.getAttribute("data-lazy-processed"))return;const e=t.querySelector("pre");e&&(this.processHighlightBackground(e),this.addLineNumbers(e),this.createHeader(e),this.adjustContrast(t),t.setAttribute("data-lazy-processed","true"))}async init(){this.injectStyles(),await u(10),this.initCodeBlocks(),this.setupThemeObserver()}injectStyles(){const t="code-block-styles";let e=document.getElementById(t);e||(e=document.createElement("style"),e.id=t,document.head.appendChild(e));const i=this.getCodeBlockOptions();e.textContent="\n            /* Code Block Header and Features Styles */\n            .code-block-container {\n                position: relative;\n                margin-bottom: 1em;\n                border: 1px solid var(--background-modifier-border);\n                border-radius: 8px;\n                overflow: hidden;\n                background-color: var(--code-background);\n                --code-ui-color: #888; /* 默认灰色 */\n            }\n\n            .code-block-header {\n                display: flex;\n                justify-content: space-between;\n                align-items: center;\n                padding: 1px 12px;\n                background-color: var(--code-background);\n                border-bottom: none;\n                font-family: var(--font-interface);\n                user-select: none;\n            }\n\n            .code-block-header__title {\n                font-size: 0.85em;\n                font-weight: 500;\n                color: var(--code-ui-color) !important;\n                opacity: 0.75; \n                text-transform: capitalize;\n                user-select: none;\n            }\n            \n            .code-block-controls {\n                display: flex;\n                align-items: center;\n                gap: 6px;\n            }\n\n            .code-block-button {\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                background: transparent !important;\n                background-color: transparent !important;\n                border: none !important;\n                box-shadow: none !important;\n                color: var(--code-ui-color) !important; \n                opacity: 0.75; \n                cursor: pointer;\n                padding: 4px;\n                border-radius: 4px;\n                transition: opacity 0.2s, background-color 0.2s, filter 0.2s;\n            }\n\n            .code-block-button:hover,\n            .code-block-button.active {\n                opacity: 1 !important; \n                background-color: var(--background-modifier-hover) !important;\n                filter: brightness(1.2);\n            }\n            \n            .code-block-button.active {\n                color: var(--interactive-accent) !important;\n            }\n\n\n            .code-block-button.wrap-button.active {\n                background-color: transparent;\n                color: var(--text-muted);\n            }\n\n            .code-block-button svg {\n                width: 16px;\n                height: 16px;\n            }\n\n            .copy-button span {\n                font-size: 1em;\n                margin-left: 4px;\n            }\n\n            .markdown-rendered pre {\n                margin: 0 !important;\n                padding: 0 !important;\n                border: none !important;\n                border-radius: 0 !important;\n                background: transparent !important;\n                font-family: var(--font-monospace, 'Consolas', monospace);\n                display: block;\n                position: relative;\n                overflow: visible;\n                clear: both;\n                float: none;\n            }\n\n            /* 当有行号时，使用 grid 布局 */\n            .markdown-rendered pre.has-line-numbers {\n                display: grid;\n                grid-template-columns: auto 1fr;\n                gap: 0;\n            }\n\n            /* 当没有行号时，code 元素正常显示 */\n            .markdown-rendered pre:not(.has-line-numbers) {\n                display: block !important;\n            }\n\n            .markdown-rendered pre:not(.has-line-numbers) code,\n            .markdown-rendered pre:not(.has-line-numbers) code[data-line],\n            .markdown-rendered pre:not(.has-line-numbers).language-ansi > span,\n            .markdown-rendered pre:not(.has-line-numbers) .ansi-content-wrapper {\n                padding: 1em !important;\n                overflow-x: auto;\n                display: block !important;\n                white-space: pre !important; \n                word-wrap: normal !important;\n                font-family: inherit;\n                position: static !important;\n                top: auto !important;\n                left: auto !important;\n                right: auto !important;\n                bottom: auto !important;\n                width: 100% !important;\n                max-width: 100% !important;\n                box-sizing: border-box !important;\n                margin: 0 !important;\n                float: none !important;\n                clear: both !important;\n                transform: none !important;\n                z-index: auto !important;\n                background-color: var(--code-background);\n            }\n\n            /* 确保 code 内部的语法高亮元素在无行号时也正常显示 */\n            .markdown-rendered pre:not(.has-line-numbers) code * {\n                display: inline;\n                white-space: pre;\n                position: static !important;\n                top: auto !important;\n                left: auto !important;\n                right: auto !important;\n                bottom: auto !important;\n                background-color: transparent; /* 内部元素保持透明，让 code 的背景色显示 */\n            }\n\n            /* 重置可能影响代码块显示的属性，特别是针对 is-loaded 类 */\n            .markdown-rendered pre:not(.has-line-numbers) code.is-loaded {\n                position: static !important;\n                top: auto !important;\n                left: auto !important;\n                right: auto !important;\n                bottom: auto !important;\n                transform: none !important;\n                z-index: auto !important;\n                background-color: var(--code-background);\n            }\n\n            /* 当有行号时，code 元素占据 grid 第二列 */\n            .markdown-rendered pre.has-line-numbers code, \n            .markdown-rendered pre.has-line-numbers.language-ansi > span,\n            .markdown-rendered pre.has-line-numbers .ansi-content-wrapper {\n                grid-column: 2;\n                grid-row: 1;\n                padding: 1em !important;\n                overflow-x: auto;\n                display: block;\n                white-space: pre !important; \n                word-wrap: normal !important;\n                font-family: inherit;\n                min-width: 0; /* 防止 grid 项目溢出 */\n                width: 100%;\n                box-sizing: border-box;\n                background-color: var(--code-background);\n            }\n\n            /* 确保 code 内部的语法高亮元素正常显示，不影响 grid 布局 */\n            .markdown-rendered pre.has-line-numbers code * {\n                display: inline;\n                white-space: pre;\n                background-color: transparent; /* 内部元素保持透明，让 code 的背景色显示 */\n            }\n\n            /* 当换行时，code 内部的语法高亮元素也要换行 */\n            .markdown-rendered pre.wrap-code.has-line-numbers code * {\n                white-space: pre-wrap !important;\n            }\n\n            .line-numbers-wrapper {\n                grid-column: 1;\n                text-align: right;\n                padding: 1em 0.8em 1em 1em;\n                border-right: 1px solid var(--background-modifier-border);\n                color: var(--code-ui-color);\n                opacity: 0.7; /* 行号透明度调整 */\n                user-select: none;\n                font-family: inherit; /* Sync font with code */\n                background-color: var(--code-background);\n                min-width: 2.5em; \n            }\n\n            .line-number {\n                display: block;\n                line-height: inherit; /* Will be synced via JS */\n                font-size: inherit;\n            }\n            \n            .line-continuation::before {\n                content: \"\";\n                display: inline-block;\n                width: 4px;\n                height: 4px;\n                border-radius: 50%;\n                background-color: var(--text-faint);\n                opacity: 0.5;\n                vertical-align: middle;\n            }\n\n            /* Wrap Code Styles - 没有行号时 */\n            .markdown-rendered pre.wrap-code:not(.has-line-numbers) code,\n            .markdown-rendered pre.wrap-code:not(.has-line-numbers) code[data-line],\n            .markdown-rendered pre.wrap-code:not(.has-line-numbers) code.is-loaded,\n            .markdown-rendered pre.wrap-code:not(.has-line-numbers).language-ansi > span,\n            .markdown-rendered pre.wrap-code:not(.has-line-numbers) .ansi-content-wrapper {\n                white-space: pre-wrap !important;\n                word-wrap: break-word !important;\n                word-break: break-all !important;\n                width: 100% !important;\n                min-width: 0 !important; /* Override min-width: 100% */\n                overflow-x: visible !important;\n                overflow-wrap: break-word !important;\n                background-color: var(--code-background);\n            }\n\n            /* 当换行时，code 内部的语法高亮元素也要换行（无行号时） */\n            .markdown-rendered pre.wrap-code:not(.has-line-numbers) code * {\n                white-space: pre-wrap !important;\n            }\n\n            /* Wrap Code Styles - 有行号时 */\n            .markdown-rendered pre.wrap-code.has-line-numbers code,\n            .markdown-rendered pre.wrap-code.has-line-numbers.language-ansi > span,\n            .markdown-rendered pre.wrap-code.has-line-numbers .ansi-content-wrapper {\n                white-space: pre-wrap !important;\n                word-wrap: break-word !important;\n                word-break: break-all !important;\n                width: 100% !important;\n                min-width: 0 !important; /* Override min-width: 100% */\n                overflow-x: visible !important;\n                overflow-wrap: break-word !important;\n                background-color: var(--code-background);\n            }\n\n            /* Collapse Styles */\n            .code-block-container.collapsed .markdown-rendered pre,\n            .code-block-container.collapsed pre {\n                overflow-y: hidden;\n                position: relative;\n            }\n            \n            .code-block-container.collapsed .markdown-rendered pre::after,\n            .code-block-container.collapsed pre::after {\n                content: '';\n                position: absolute;\n                bottom: 0;\n                left: 0;\n                right: 0;\n                height: calc(3 * var(--code-line-height, 1.6) * 1em + 1em);\n                background: linear-gradient(to bottom, transparent 0%, var(--code-background) 100%);\n                pointer-events: none;\n                z-index: 10;\n            }\n            \n            .expand-button-container {\n                display: none;\n                justify-content: center;\n                padding: 8px;\n                border-top: 1px solid var(--background-modifier-border);\n                background: var(--background-secondary);\n            }\n\n            .code-block-container.collapsed .expand-button-container {\n                display: flex;\n            }\n\n            /* Corner expand button (if used in addition to header) */\n            .corner-button {\n                position: absolute;\n                bottom: 8px;\n                right: 8px;\n                z-index: 10;\n                background: var(--background-primary);\n                border: 1px solid var(--background-modifier-border);\n                box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n            }\n            \n            /* Bottom expand button for code blocks */\n            .bottom-expand-button {\n                position: absolute;\n                bottom: 12px;\n                right: 12px;\n                z-index: 10;\n                width: 36px;\n                height: 36px;\n                background: rgba(0, 0, 0, 0.7) !important;\n                border: none;\n                border-radius: 50%;\n                cursor: pointer;\n                display: flex;\n                align-items: center;\n                justify-content: center;\n                padding: 0;\n                transition: box-shadow 0.3s ease, transform 0.3s ease;\n                box-shadow: none;\n            }\n            \n            .bottom-expand-button:hover {\n                background: rgba(0, 0, 0, 0.7) !important;\n                box-shadow: 0 0 12px rgba(255, 255, 255, 0.3), 0 0 20px rgba(255, 255, 255, 0.2);\n            }\n            \n            .bottom-expand-button svg {\n                width: 20px;\n                height: 20px;\n                display: block;\n            }\n\n            /* ANSI Colors (Basic support) */\n            .ansi-black-fg { color: black; }\n            .ansi-red-fg { color: red; }\n            .ansi-green-fg { color: green; }\n            .ansi-yellow-fg { color: #d6d620; }\n            .ansi-blue-fg { color: blue; }\n            .ansi-magenta-fg { color: magenta; }\n            .ansi-cyan-fg { color: cyan; }\n            .ansi-white-fg { color: white; }\n            .ansi-bright-black-fg { color: gray; }\n            \n            /* Exclude YAML properties from line numbers */\n            .yaml-properties-container pre {\n                display: block !important;\n                grid-template-columns: 1fr !important;\n            }\n            .yaml-properties-container .line-numbers-wrapper {\n                display: none !important;\n            }\n            .yaml-properties-container pre.has-line-numbers {\n                grid-template-columns: 1fr !important;\n            }\n\n            /* 隐藏 frontmatter 代码块， */\n            .markdown-rendered pre.frontmatter,\n            .markdown-rendered pre.yaml-frontmatter,\n            .markdown-rendered pre[data-frontmatter] {\n                display: none !important;\n            }\n        ",yt.updateHighlightStyles(i)}initCodeBlocks(){const t=Array.from(this.containerEl.querySelectorAll("pre code")),e=Array.from(this.containerEl.querySelectorAll("pre.ansi-block"));new Set([...t.map((t=>t.parentElement)),...e.map((t=>t))].filter((t=>t))).forEach((t=>{if(!t)return;if("true"===t.getAttribute("data-processed"))return;if(t.closest(".yaml-properties-container"))return;if(t.classList.contains("frontmatter")||t.classList.contains("yaml-frontmatter")||t.hasAttribute("data-frontmatter"))return;const e=t.querySelector("button.copy-code-button");e&&e.remove(),this.handleAnsiBlock(t),this.processLanguage(t),this.prepareContainer(t);const i=t.parentElement,n=this.getCodeBlockOptions();this.getLineCount(t)>(n.collapseThreshold||30)&&n.defaultCollapse&&this.setupCollapse(t,i),this.observer?this.observer.observe(i):this.lazyProcessCodeBlock(i),t.setAttribute("data-processed","true")}))}handleAnsiBlock(t){if(t.classList.contains("ansi-block")){const e=Array.from(t.children).filter((t=>!t.classList.contains("line-numbers-wrapper")));if(!(1===e.length&&"SPAN"===e[0].tagName&&!e[0].classList.contains("line-number"))){const e=document.createElement("span");for(e.className="ansi-content-wrapper";t.firstChild;)e.appendChild(t.firstChild);t.appendChild(e)}t.classList.add("language-ansi")}}processHighlightBackground(t){if(!this.getCodeBlockOptions().enableHighlightLine)return;const e=this.getCodeElement(t);if(!e)return;const i=e.innerHTML.split("\n").map((t=>{const e=document.createElement("div");e.innerHTML=t;if((e.textContent||"").startsWith(">>>> ")){const e=document.createElement("div");e.innerHTML=t;let i=5;const n=document.createTreeWalker(e,NodeFilter.SHOW_TEXT);let s;for(;(s=n.nextNode())&&i>0;){const t=s,e=t.data;if(e.length<=i)i-=e.length,t.data="";else{const n=e.substring(i);t.data=n,i=0}}return`<span class="highlight-line">${e.innerHTML}</span>`}return t}));e.innerHTML=i.join("\n")}processLanguage(t){const e=t.querySelector("code");let i="";if(e){const t=e.className.match(/language-([^\s]+)/);t&&(i=t[1])}i||(i=t.className.match(/language-(\w+)/)?.[1]||""),!i&&t.classList.contains("ansi-block")&&(i="ansi"),i&&t.setAttribute("data-language",i)}getCodeElement(t){const e=t.querySelector("code");if(e)return e;if(t.classList.contains("language-ansi")){const e=t.querySelector(".ansi-content-wrapper");if(e)return e;const i=Array.from(t.children).find((t=>"SPAN"===t.tagName&&!t.classList.contains("line-numbers-wrapper")));if(i)return i}return t}prepareContainer(t){const e=document.createElement("div");e.className="code-block-container";const i=t.getAttribute("data-language");i&&e.setAttribute("data-language",i),t.parentNode?.insertBefore(e,t),e.appendChild(t);const n=window.getComputedStyle(t);n.backgroundColor&&"rgba(0, 0, 0, 0)"!==n.backgroundColor&&"transparent"!==n.backgroundColor&&(t.style.backgroundColor="transparent")}createHeader(t){const e=t.parentElement,i=document.createElement("div");i.className="code-block-header";const n=t.getAttribute("data-language")||"Text",s=document.createElement("div");s.className="code-block-header__title",s.textContent=n.charAt(0).toUpperCase()+n.slice(1);const o=document.createElement("div");o.className="code-block-controls";const r=this.getCodeBlockOptions();if(this.getLineCount(t)>(r.collapseThreshold||30)&&r.defaultCollapse){this.setupCollapse(t,e);const i=this.createButton("expand",this.getTranslation("expandCollapse","展开/收起"));this.updateExpandIcon(i,!0),i.onclick=()=>this.toggleCollapse(e,i),o.appendChild(i),e.expandBtn=i,r.showBottomExpandButton&&this.createBottomExpandButton(e,t)}const a=this.createButton("wrap",this.getTranslation("wrap","自动换行"));a.innerHTML=this.getIcon("wrap"),a.onclick=()=>this.toggleWrap(t,a),r.defaultWrap&&(t.classList.add("wrap-code"),a.innerHTML=this.getIcon("text")),o.appendChild(a);const l=document.createElement("button");l.className="code-block-button copy-button";const c=this.getTranslation("copy","复制");l.title=c,l.innerHTML=`${this.getIcon("copy")}<span>${c}</span>`,l.onclick=async()=>await this.copyCode(t,l),o.appendChild(l),i.appendChild(s),i.appendChild(o),e.insertBefore(i,t)}createButton(t,e){const i=document.createElement("button");return i.className=`code-block-button ${t}-button`,i.title=e,i}getIcon(t){return{copy:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="stroke-[2] size-4"><rect x="3" y="8" width="13" height="13" rx="4" stroke="currentColor"></rect><path fill-rule="evenodd" clip-rule="evenodd" d="M13 2.00004L12.8842 2.00002C12.0666 1.99982 11.5094 1.99968 11.0246 2.09611C9.92585 2.31466 8.95982 2.88816 8.25008 3.69274C7.90896 4.07944 7.62676 4.51983 7.41722 5.00004H9.76392C10.189 4.52493 10.7628 4.18736 11.4147 4.05768C11.6802 4.00488 12.0228 4.00004 13 4.00004H14.6C15.7366 4.00004 16.5289 4.00081 17.1458 4.05121C17.7509 4.10066 18.0986 4.19283 18.362 4.32702C18.9265 4.61464 19.3854 5.07358 19.673 5.63807C19.8072 5.90142 19.8994 6.24911 19.9488 6.85428C19.9992 7.47112 20 8.26343 20 9.40004V11C20 11.9773 19.9952 12.3199 19.9424 12.5853C19.8127 13.2373 19.4748 13.8114 19 14.2361V16.5829C20.4795 15.9374 21.5804 14.602 21.9039 12.9755C22.0004 12.4907 22.0002 11.9334 22 11.1158L22 11V9.40004V9.35725C22 8.27346 22 7.3993 21.9422 6.69141C21.8826 5.96256 21.7568 5.32238 21.455 4.73008C20.9757 3.78927 20.2108 3.02437 19.27 2.545C18.6777 2.24322 18.0375 2.1174 17.3086 2.05785C16.6007 2.00002 15.7266 2.00003 14.6428 2.00004L14.6 2.00004H13Z" fill="currentColor"></path></svg>',wrap:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" x2="21" y1="6" y2="6"></line><path d="M3 12h15a3 3 0 1 1 0 6h-4"></path><polyline points="16 16 14 18 16 20"></polyline><line x1="3" x2="10" y1="18" y2="18"></line></svg>',text:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 6.1H3"></path><path d="M21 12.1H3"></path><path d="M15.1 18H3"></path></svg>',expand:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 15 5 5 5-5"></path><path d="m7 9 5-5 5 5"></path></svg>',collapse:'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m7 20 5-5 5 5"></path><path d="m7 4 5 5 5-5"></path></svg>'}[t]||""}getLineCount(t){const e=(this.getCodeElement(t).textContent||"").split("\n");return e.length>0&&""===e[e.length-1]?e.length-1:e.length}addLineNumbers(t){if(t.querySelector(".line-numbers-wrapper"))return;if(!this.getCodeBlockOptions().showLineNumbers)return;const e=this.getLineCount(t);if(e<1)return;const i=document.createElement("div");i.className="line-numbers-wrapper",this.renderLineNumbers(i,e),t.insertBefore(i,t.firstChild),t.classList.add("has-line-numbers"),this.syncTypography(t,i);const n=this.debounce((()=>{requestAnimationFrame((()=>this.updateLineNumbers(t,i)))}),100);new MutationObserver((t=>{for(const e of t)if("attributes"===e.type&&"class"===e.attributeName){n();break}})).observe(t,{attributes:!0,attributeFilter:["class"]}),window.addEventListener("resize",n)}renderLineNumbers(t,e){let i="";for(let t=1;t<=e;t++)i+=`<span class="line-number" data-line="${t}">${t}</span>`;t.innerHTML=i}syncTypography(t,e){const i=this.getCodeElement(t),n=window.getComputedStyle(i);t.style.lineHeight=n.lineHeight,t.style.fontSize=n.fontSize,t.style.fontFamily=n.fontFamily,e.style.lineHeight=n.lineHeight,e.style.fontSize=n.fontSize,e.style.fontFamily=n.fontFamily}escapeHtml(t){return t.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}updateLineNumbers(t,e){const i=t.classList.contains("wrap-code"),n=this.getCodeElement(t);if(!i)return void this.renderLineNumbers(e,this.getLineCount(t));const s=document.createElement("div"),o=window.getComputedStyle(n);Object.assign(s.style,{position:"absolute",visibility:"hidden",top:"-9999px",left:"-9999px",width:o.width,fontFamily:o.fontFamily,fontSize:o.fontSize,fontWeight:o.fontWeight,lineHeight:o.lineHeight,letterSpacing:o.letterSpacing,boxSizing:"border-box",padding:o.padding,border:o.border,whiteSpace:"pre-wrap",wordWrap:"break-word",wordBreak:"break-all",overflowWrap:"break-word"}),document.body.appendChild(s);const r=document.createElement("div");r.style.width="100%",r.textContent="X",s.appendChild(r);const a=r.offsetHeight;if(s.removeChild(r),0===a)return void document.body.removeChild(s);const l=(n.textContent||"").split("\n");l.length>0&&""===l[l.length-1]&&l.pop();s.innerHTML=l.map((t=>`<div style="width: 100%; white-space: pre-wrap; word-wrap: break-word; word-break: break-all; margin: 0; padding: 0;">${this.escapeHtml(t)||"&nbsp;"}</div>`)).join("");const c=s.querySelectorAll("div");let h="";l.forEach(((t,e)=>{const i=c[e].offsetHeight,n=Math.max(1,Math.round(i/a));h+=`<span class="line-number" data-line="${e+1}">${e+1}</span>`;for(let t=1;t<n;t++)h+='<span class="line-number line-continuation"></span>'})),document.body.removeChild(s),e.innerHTML=h}toggleWrap(t,e){t.classList.toggle("wrap-code");const i=t.classList.contains("wrap-code");e.innerHTML=i?this.getIcon("text"):this.getIcon("wrap");const n=t.querySelector(".line-numbers-wrapper");n&&requestAnimationFrame((()=>{requestAnimationFrame((()=>{this.updateLineNumbers(t,n)}))}))}setupCollapse(t,e){e.classList.add("collapsed"),t.classList.add("collapsed"),t.setAttribute("data-collapsed","true"),this.setCollapsedHeight(t,20)}createBottomExpandButton(t,e){if(t.querySelector(".bottom-expand-button"))return;const i=document.createElement("button");i.className="bottom-expand-button",i.title=this.getTranslation("expandCollapse","展开/收起"),i.innerHTML='<svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="currentColor"><g id="SVGRepo_bgCarrier" stroke-width="0"></g><g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g><g id="SVGRepo_iconCarrier"><path d="M18 12L12 18L6 12" stroke="#ffffff" stroke-width="2"></path><path d="M18 6L12 12L6 6" stroke="#ffffff" stroke-width="2"></path></g></svg>',i.onclick=()=>{const e=t.querySelector(".code-block-button.expand-button");this.toggleCollapse(t,e||null)},t.appendChild(i),this.updateBottomButtonIcon(t,!0)}updateBottomButtonIcon(t,e){const i=t.querySelector(".bottom-expand-button");i&&(i.style.transform=e?"rotate(0deg)":"rotate(180deg)")}setCollapsedHeight(t,e){const i=window.getComputedStyle(t),n=e*(parseFloat(i.lineHeight)||1.6*parseFloat(i.fontSize));t.style.maxHeight=`${n}px`,t.style.overflowY="hidden"}toggleCollapse(t,e=null){const i=t.querySelector("pre");t.classList.contains("collapsed")?(t.classList.remove("collapsed"),i?.classList.remove("collapsed"),i&&(i.style.maxHeight="",i.style.overflowY=""),e&&this.updateExpandIcon(e,!1),this.updateBottomButtonIcon(t,!1)):(t.classList.add("collapsed"),i?.classList.add("collapsed"),i&&this.setCollapsedHeight(i,20),e&&this.updateExpandIcon(e,!0),this.updateBottomButtonIcon(t,!0),t.scrollIntoView({behavior:"auto",block:"nearest"}))}updateExpandIcon(t,e){t.innerHTML=e?this.getIcon("expand"):this.getIcon("collapse")}async copyCode(t,e){const i=this.getCodeElement(t),n=i.innerText||i.textContent||"";try{await navigator.clipboard.writeText(n),this.showCopyStatus(e,!0)}catch(t){this.fallbackCopy(n,e)}}fallbackCopy(t,e){const i=document.createElement("textarea");i.value=t,i.style.position="fixed",i.style.left="-9999px",document.body.appendChild(i),i.select();try{document.execCommand("copy"),this.showCopyStatus(e,!0)}catch(t){this.showCopyStatus(e,!1)}document.body.removeChild(i)}showCopyStatus(t,e){const i=t.innerHTML,n=t.querySelector("span");e?(t.classList.add("copied"),n&&(n.textContent=this.getTranslation("copied","已复制")),t.style.opacity="0.6",t.style.transition="opacity 0.3s ease"):(t.classList.add("error"),n&&(n.textContent="失败")),setTimeout((()=>{t.classList.remove("copied","error"),t.style.opacity="",t.style.transition="",t.innerHTML=i}),1e3)}setupThemeObserver(){const t=this.debounce((()=>{this.processedContainers=this.processedContainers.filter((t=>document.body.contains(t))),this.processedContainers.forEach((t=>{this.adjustContrast(t)}))}),100);new MutationObserver((e=>{for(const i of e)if("attributes"===i.type&&"class"===i.attributeName){t();break}})).observe(document.body,{attributes:!0,attributeFilter:["class"]})}adjustContrast(t){const e=getComputedStyle(t).backgroundColor,i=ft(document.body.classList.contains("theme-dark")?"#b0b0b0":"#555555",e,4,t);t.style.setProperty("--code-ui-color",i),this.processedContainers.includes(t)||this.processedContainers.push(t)}debounce(t,e){let i;return(...n)=>{clearTimeout(i),i=setTimeout((()=>t.apply(this,n)),e)}}},vt=class{constructor(t){this.containerEl=t}async init(){this.addMediaLabels()}addMediaLabels(){if(!document.getElementById("media-label-style")){const t=document.createElement("style");t.id="media-label-style",t.innerHTML="\n                .media-embed-label {\n                    font-size: 0.85em;\n                    color: var(--text-muted);\n                    margin-bottom: 8px;\n                    display: block;\n                    font-family: var(--font-interface);\n                    font-weight: 500;\n                    opacity: 0.8;\n                }\n                .internal-embed.media-embed {\n                    display: flex;\n                    flex-direction: column;\n                    margin-bottom: 1em;\n                }\n            ",document.head.appendChild(t)}this.containerEl.querySelectorAll(".internal-embed.media-embed.audio-embed, .internal-embed.media-embed.video-embed").forEach((t=>{if(t.querySelector(".media-embed-label"))return;const e=t.getAttribute("alt");if(e){const i=document.createElement("div");i.className="media-embed-label",i.innerText=e,t.prepend(i)}}))}},wt=class{constructor(){this.overlay=null,this.zoomImage=null,this.scale=1,this.translateX=0,this.translateY=0,this.isDragging=!1,this.lastPointerPos={x:0,y:0},this.baseWidth=0,this.baseHeight=0,this.minScale=.5,this.maxScale=10,this.zoomStep=.15,this.injectStyles(),this.createOverlay(),this.bindGlobalEvents()}static getInstance(){return wt.instance||(wt.instance=new wt),wt.instance}injectStyles(){if(document.getElementById("image-zoom-style"))return;const t=document.createElement("style");t.id="image-zoom-style",t.textContent="\n\t\t\t.markdown-rendered img:not(.callout-icon):not(.file-list-item-icon) {\n\t\t\t\tcursor: zoom-in;\n\t\t\t}\n\t\t\t\n\t\t\t.image-zoom-overlay {\n\t\t\t\tposition: fixed;\n\t\t\t\ttop: 0;\n\t\t\t\tleft: 0;\n\t\t\t\twidth: 100%;\n\t\t\t\theight: 100%;\n\t\t\t\tbackground: rgba(0, 0, 0, 0.85);\n\t\t\t\tz-index: 9999;\n\t\t\t\tdisplay: none;\n\t\t\t\tcursor: zoom-out;\n\t\t\t}\n\t\t\t\n\t\t\t.image-zoom-overlay.active {\n\t\t\t\tdisplay: flex;\n\t\t\t\tjustify-content: center;\n\t\t\t\talign-items: center;\n\t\t\t}\n\t\t\t\n\t\t\t.image-zoom-img {\n\t\t\t\tmax-width: none;\n\t\t\t\tmax-height: none;\n\t\t\t\ttransform-origin: center center;\n\t\t\t\tcursor: grab;\n\t\t\t\tuser-select: none;\n\t\t\t\t-webkit-user-drag: none;\n\t\t\t}\n\t\t\t\n\t\t\t.image-zoom-img.dragging {\n\t\t\t\tcursor: grabbing;\n\t\t\t}\n\t\t",document.head.appendChild(t)}createOverlay(){if(document.querySelector(".image-zoom-overlay"))return this.overlay=document.querySelector(".image-zoom-overlay"),void(this.zoomImage=this.overlay?.querySelector(".image-zoom-img"));this.overlay=document.createElement("div"),this.overlay.className="image-zoom-overlay",this.zoomImage=document.createElement("img"),this.zoomImage.className="image-zoom-img",this.overlay.appendChild(this.zoomImage),document.body.appendChild(this.overlay)}bindGlobalEvents(){this.overlay&&this.zoomImage&&(this.overlay.addEventListener("click",(t=>{t.target===this.overlay&&this.close()})),this.overlay.addEventListener("wheel",(t=>{t.preventDefault(),this.handleZoom(t)}),{passive:!1}),this.zoomImage.addEventListener("pointerdown",(t=>{this.startDrag(t)})),document.addEventListener("pointermove",(t=>{this.drag(t)})),document.addEventListener("pointerup",(()=>{this.endDrag()})),document.addEventListener("keydown",(t=>{"Escape"===t.key&&this.isOpen()&&this.close()})))}show(t){if(!this.overlay||!this.zoomImage)return;this.scale=1,this.translateX=0,this.translateY=0,this.isDragging=!1;const e=t.getAttribute("src")||t.src;this.zoomImage.src=e;const i=window.innerWidth,n=window.innerHeight,s=.85;let o=t.naturalWidth||t.width||500,r=t.naturalHeight||t.height||500;if(o>i*s){const t=i*s/o;o*=t,r*=t}if(r>n*s){const t=n*s/r;o*=t,r*=t}this.baseWidth=o,this.baseHeight=r,this.zoomImage.style.width=`${o}px`,this.zoomImage.style.height=`${r}px`,this.updateTransform(),this.overlay.classList.add("active")}close(){this.overlay&&(this.overlay.classList.remove("active"),this.isDragging=!1)}isOpen(){return this.overlay?.classList.contains("active")||!1}handleZoom(t){if(!this.zoomImage)return;const e=this.zoomImage.getBoundingClientRect(),i=e.left+e.width/2,n=e.top+e.height/2,s=t.clientX-i,o=t.clientY-n,r=this.scale,a=t.deltaY>0?-this.zoomStep:this.zoomStep;let l=this.scale+a;if(l=Math.max(this.minScale,Math.min(this.maxScale,l)),l===r)return;const c=l/r;this.translateX-=s*(c-1),this.translateY-=o*(c-1),this.scale=l,this.updateTransform()}startDrag(t){this.zoomImage&&(this.isDragging=!0,this.lastPointerPos={x:t.clientX,y:t.clientY},this.zoomImage.classList.add("dragging"),this.zoomImage.setPointerCapture(t.pointerId),t.preventDefault())}drag(t){if(!this.isDragging)return;const e=t.clientX-this.lastPointerPos.x,i=t.clientY-this.lastPointerPos.y;this.translateX+=e,this.translateY+=i,this.lastPointerPos={x:t.clientX,y:t.clientY},this.updateTransform()}endDrag(){this.zoomImage&&(this.isDragging=!1,this.zoomImage.classList.remove("dragging"))}updateTransform(){this.zoomImage&&(this.zoomImage.style.transform=`translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`)}initImagesInElement(t){t.querySelectorAll("img:not(.callout-icon):not(.file-list-item-icon):not(.image-zoom-img)").forEach((t=>{t.hasAttribute("data-zoom-initialized")||(t.addEventListener("click",(e=>{e.preventDefault(),e.stopPropagation(),this.show(t)})),t.setAttribute("data-zoom-initialized","true"))}))}},Et=wt;Et.instance=null;var xt=class{constructor(){this.collapseThreshold=1200,this.collapsedHeight=700,this.injectStyles()}static getInstance(){return xt.instance||(xt.instance=new xt),xt.instance}injectStyles(){if(document.getElementById("long-image-collapse-style"))return;const t=document.createElement("style");t.id="long-image-collapse-style",t.textContent=`\n\t\t\t/* 外层包裹器 - 用于控制按钮居中于图片宽度 */\n\t\t\t.long-image-wrapper {\n\t\t\t\tdisplay: inline-block;\n\t\t\t\twidth: fit-content;\n\t\t\t\tmax-width: 100%;\n\t\t\t}\n\t\t\t\n\t\t\t/* 长图片容器 */\n\t\t\t.long-image-container {\n\t\t\t\tposition: relative;\n\t\t\t\toverflow: hidden;\n\t\t\t\tborder-radius: var(--image-radius, 4px);\n\t\t\t}\n\t\t\t\n\t\t\t/* 折叠状态 */\n\t\t\t.long-image-container.collapsed {\n\t\t\t\tmax-height: ${this.collapsedHeight}px;\n\t\t\t\toverflow: hidden;\n\t\t\t}\n\t\t\t\n\t\t\t/* 渐变遮罩 */\n\t\t\t.long-image-container.collapsed::after {\n\t\t\t\tcontent: '';\n\t\t\t\tposition: absolute;\n\t\t\t\tbottom: 0;\n\t\t\t\tleft: 0;\n\t\t\t\tright: 0;\n\t\t\t\theight: 150px;\n\t\t\t\tbackground: linear-gradient(to bottom, transparent 0%, var(--background-primary, #fff) 100%);\n\t\t\t\tpointer-events: none;\n\t\t\t\tz-index: 10;\n\t\t\t}\n\t\t\t\n\t\t\t/* 展开按钮容器 - 宽度继承自外层包裹器 */\n\t\t\t.long-image-expand-container {\n\t\t\t\tdisplay: none;\n\t\t\t\tjustify-content: center;\n\t\t\t\tpadding: 12px 0;\n\t\t\t\twidth: 100%;\n\t\t\t}\n\t\t\t\n\t\t\t.long-image-container.collapsed + .long-image-expand-container,\n\t\t\t.long-image-container:not(.collapsed) + .long-image-expand-container.show-collapse {\n\t\t\t\tdisplay: flex;\n\t\t\t}\n\t\t\t\n\t\t\t/* 展开/收起按钮 */\n\t\t\t.long-image-expand-btn {\n\t\t\t\tdisplay: flex;\n\t\t\t\talign-items: center;\n\t\t\t\tgap: 6px;\n\t\t\t\tpadding: 8px 20px;\n\t\t\t\tbackground-color: var(--background-secondary, #f5f5f5);\n\t\t\t\tborder: 1px solid var(--background-modifier-border, #ddd);\n\t\t\t\tborder-radius: 20px;\n\t\t\t\tcursor: pointer;\n\t\t\t\tfont-size: 0.9em;\n\t\t\t\tcolor: var(--text-muted, #666);\n\t\t\t\ttransition: all 0.2s ease;\n\t\t\t}\n\t\t\t\n\t\t\t.long-image-expand-btn:hover {\n\t\t\t\tbackground-color: var(--background-modifier-hover, #eee);\n\t\t\t\tcolor: var(--text-normal, #333);\n\t\t\t}\n\t\t\t\n\t\t\t.long-image-expand-btn svg {\n\t\t\t\twidth: 16px;\n\t\t\t\theight: 16px;\n\t\t\t\ttransition: transform 0.3s ease;\n\t\t\t}\n\t\t\t\n\t\t\t.long-image-container:not(.collapsed) + .long-image-expand-container .long-image-expand-btn svg {\n\t\t\t\ttransform: rotate(180deg);\n\t\t\t}\n\t\t\t\n\t\t\t/* 确保图片在容器内正常显示 */\n\t\t\t.long-image-container img {\n\t\t\t\tdisplay: block;\n\t\t\t\tmax-width: 100%;\n\t\t\t\theight: auto;\n\t\t\t}\n\t\t`,document.head.appendChild(t)}getTranslation(t,e){try{const e=window.i18n;if(e?.longImage?.[t])return e.longImage[t]}catch(t){}return e}initImagesInElement(t){t.querySelectorAll("img:not(.callout-icon):not(.file-list-item-icon):not(.long-image-processed)").forEach((t=>{const e=t;e.complete&&e.naturalHeight>0?this.processImage(e):e.addEventListener("load",(()=>{this.processImage(e)}),{once:!0})}))}processImage(t){t.classList.add("long-image-processed");const e=t.naturalHeight,i=t.offsetHeight;if((i>0?i:e)<=this.collapseThreshold)return;const n=document.createElement("div");n.className="long-image-wrapper";const s=document.createElement("div");s.className="long-image-container collapsed";const o=document.createElement("div");o.className="long-image-expand-container";const r=document.createElement("button");r.className="long-image-expand-btn",r.innerHTML=`\n\t\t\t${this.getExpandIcon()}\n\t\t\t<span>${this.getTranslation("expand","展开长图")}</span>\n\t\t`,o.appendChild(r),t.parentNode?.insertBefore(n,t),s.appendChild(t),n.appendChild(s),n.appendChild(o),r.addEventListener("click",(()=>{this.toggleCollapse(s,r)}))}toggleCollapse(t,e){const i=t.classList.contains("collapsed"),n=e.closest(".long-image-expand-container");i?(t.classList.remove("collapsed"),n?.classList.add("show-collapse"),e.innerHTML=`\n\t\t\t\t${this.getExpandIcon()}\n\t\t\t\t<span>${this.getTranslation("collapse","收起长图")}</span>\n\t\t\t`):(t.classList.add("collapsed"),n?.classList.remove("show-collapse"),e.innerHTML=`\n\t\t\t\t${this.getExpandIcon()}\n\t\t\t\t<span>${this.getTranslation("expand","展开长图")}</span>\n\t\t\t`,t.scrollIntoView({behavior:"auto",block:"start"}))}getExpandIcon(){return'<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n\t\t\t<path d="m6 9 6 6 6-6"/>\n\t\t</svg>'}},kt=xt;kt.instance=null;var St=class{constructor(t,e){this.noResultsEl=null,this.cardsData=[],this.buttonGroups=new Map,this.dynamicGroups=new Map,this.dynamicAllButtons=new Map,this.systemsSet=new Set,this.tagsCount=new Map,this.difficultiesSet=new Set,this.authorsCount=new Map,this.state={searchQuery:"",system:"all",favorite:"all",tag:[],difficulty:[],author:[],releaseTime:"all",createTime:"all",customDateStart:null,customDateEnd:null,sortField:"score",sortDirection:"desc",status:"all",fcontinue:"all"},this.selectedTagFiltersLower=[],this.selectedDifficultyFiltersLower=[],this.selectedAuthorFiltersLower=[],this.root=t,this.gallery=e,this.filtersContainer=this.ensureFiltersContainer(),this.searchInput=this.root.querySelector("#machine-search-input"),this.searchButton=this.root.querySelector(".search-button"),this.resultsCountEl=this.root.querySelector(".results-count"),this.collectCards(),this.buildFilters(),this.setupSearch(),this.applyFilters()}static initialize(t){const e=t??document.body,i=Array.from(e.querySelectorAll(".machine-gallery-grid"));if(0!==i.length)for(const t of i){const e=t.parentElement;e&&!St.initializedRoots.has(e)&&(new St(e,t),St.initializedRoots.add(e))}}ensureFiltersContainer(){let t=this.root.querySelector(".filters-container");if(!t){t=document.createElement("div"),t.className="filters-container";const e=this.root.querySelector(".top-toolbar");e?.nextSibling?e.parentElement?.insertBefore(t,e.nextSibling):this.root.insertBefore(t,this.gallery)}return t.innerHTML="",t}collectCards(){Array.from(this.gallery.querySelectorAll(".machine-card")).forEach(((t,e)=>{const i=t.querySelector(".machine-title"),n=t.querySelector(".machine-os-info"),s=t.querySelector(".machine-extra-info"),o=t.querySelector(".machine-difficulty-info"),r=t.querySelector(".machine-creator"),a=t.querySelector(".machine-date"),l=t.querySelector(".machine-rating"),c=t.querySelector(".machine-status-tag"),h=i?.textContent?.trim()??"",d=this.splitValues(n?.textContent,"系统");d.forEach((t=>this.systemsSet.add(t)));const u=this.splitValues(s?.textContent);u.forEach((t=>this.incrementCount(this.tagsCount,t)));const p=this.splitValues(o?.textContent,"难度");p.forEach((t=>this.difficultiesSet.add(t)));const m=this.splitValues(r?.textContent,"作者");m.forEach((t=>this.incrementCount(this.authorsCount,t)));const g=a?.textContent?.trim()??"",f=this.parseDateFromText(g),b=f?.getFullYear()??null,y=i?.getAttribute("href")??i?.dataset.href??"",v=this.resolveCreateTimeFromCard(t)??this.resolveCreateTime(y),w=Boolean(c&&c.textContent&&c.textContent.includes("💖")),E=l?.textContent?.match(/([0-9]+(?:\.[0-9]+)?)/),x=E?Number.parseFloat(E[1]):null,k=[h,d.join(" "),u.join(" "),p.join(" "),m.join(" "),g,t.textContent??""],S={index:e,element:t,title:h,titleLower:h.toLowerCase(),systems:d,systemsLower:d.map((t=>t.toLowerCase())),tags:u,tagsLower:u.map((t=>t.toLowerCase())),difficulties:p,difficultiesLower:p.map((t=>t.toLowerCase())),authors:m,authorsLower:m.map((t=>t.toLowerCase())),releaseDate:f,releaseYear:b,releaseText:g,createTime:v,favorite:w,score:x,searchContent:k.join(" \n ").toLowerCase()};this.cardsData.push(S)}))}splitValues(t,e){if(!t)return[];let i=t.trim();if(e&&i.startsWith(e)){const t=i.indexOf(":");i=t>-1?i.substring(t+1).trim():i.replace(e,"")}return i.split(/[\s,，|\/]+/).map((t=>t.trim())).filter((t=>t.length>0))}incrementCount(t,e){if(!e)return;const i=t.get(e)??0;t.set(e,i+1)}parseDateFromText(t){if(!t)return null;const e=[/\d{4}[年\/.\-]\d{1,2}[月\/.\-]\d{1,2}(?:[日号])?(?:\s+\d{1,2}:\d{2}(?::\d{2})?)?/,/\d{4}[年\/.\-]\d{1,2}(?:[月])?/,/\d{8}/,/\d{4}[\/.\-]\d{1,2}[\/.\-]\d{1,2}/];for(const i of e){const e=t.match(i);if(!e)continue;const[n]=e,s=this.parseDateString(n);if(s)return s}return null}parseDateString(t){if(!t)return null;const e=t.trim();if(!e)return null;if(/^\d+$/.test(e)){const t=Number(e);if(!Number.isNaN(t)){const i=e.length>=13?t:1e3*t,n=new Date(i);return Number.isNaN(n.getTime())?null:n}}if(/^\d{8}$/.test(e)){const t=`${e.substring(0,4)}-${e.substring(4,6)}-${e.substring(6,8)}`,i=new Date(t);if(!Number.isNaN(i.getTime()))return i}let i=e.replace(/[年\/.]/g,"-").replace(/月/g,"-").replace(/[日号]/g,"").replace(/\s+/g," ").trim();/^\d{4}-\d{1,2}$/.test(i)&&(i=`${i}-01`),/^\d{4}-\d{1,2}-\d{1,2}\s+\d{1,2}:\d{2}(?::\d{2})?$/.test(i)&&(i=i.replace(" ","T")),i=i.replace(/\//g,"-");const n=new Date(i);if(!Number.isNaN(n.getTime()))return n;const s=new Date(Date.parse(i));return Number.isNaN(s.getTime())?null:s}resolveCreateTimeFromCard(t){const e=this.extractDateFromElementAttributes(t);if(e)return e;const i=Array.from(t.querySelectorAll("[data-created],[data-create-time],[data-created-time],[data-created_at],[data-created-date],[data-createtime],[data-createdat]"));for(const t of i){const e=this.extractDateFromElementAttributes(t)??this.extractDateFromElementText(t);if(e)return e}const n=[".machine-created",".machine-meta",".machine-info",".machine-date",".machine-extra-info",".machine-header",".machine-details"];for(const e of n){const i=t.querySelector(e);if(!i)continue;const n=this.extractDateFromElementText(i);if(n)return n}return this.extractDateFromElementText(t)}extractDateFromElementAttributes(t){const e=Object.entries(t.dataset??{});for(const[t,i]of e){if(!i)continue;const e=t.toLowerCase();if(!e.includes("created")&&!e.includes("ctime"))continue;const n=this.parseDateString(i);if(n)return n}const i=Array.from(t.attributes);for(const t of i){const e=t.name.toLowerCase();if(!e.includes("created")&&!e.includes("ctime"))continue;const i=this.parseDateString(t.value);if(i)return i}return null}extractDateFromElementText(t){if(!t)return null;const e=t.textContent??"";return e&&/(创建|添加|created|create)/i.test(e)?this.parseDateFromText(e):null}resolveCreateTime(t){if(!t)return null;let e=ot.getPathnameFromURL(t);const i=ObsidianSite.metadata;if(!i)return null;if(!e.endsWith(".html")){const t=i.sourceToTarget?.[e];t&&(e=t)}const n=i.fileInfo?.[e];if(!n?.createdTime)return null;const s=new Date(n.createdTime);return Number.isNaN(s.getTime())?null:s}buildFilters(){this.buildSystemRow(),this.buildFavoriteRow(),this.buildTagRow(),this.buildDifficultyRow(),this.buildAuthorRow(),this.buildReleaseTimeRow(),this.buildCreateTimeRow(),this.buildSortRow(),this.ensureDatePicker()}buildSystemRow(){const t=this.createRowContainer();t.appendChild(this.createFilterButton("system","all","全部系统",!0)),Array.from(this.systemsSet).sort(((t,e)=>t.localeCompare(e))).forEach((e=>{t.appendChild(this.createFilterButton("system",e,e))})),this.filtersContainer.appendChild(t)}buildFavoriteRow(){const t=this.createRowContainer();t.appendChild(this.createFilterButton("favorite","all","全部收藏",!0)),t.appendChild(this.createFilterButton("favorite","true","已收藏 💖")),t.appendChild(this.createFilterButton("favorite","false","未收藏")),this.filtersContainer.appendChild(t)}buildTagRow(){const t=Array.from(this.tagsCount.entries()).filter((([t])=>t.length>0));if(0===t.length)return;const e=document.createElement("div");e.className="filter-item-column";const i=this.createRowContainer(),n=this.createFilterButton("tag","all","所有知识点",!0);i.appendChild(n),this.dynamicAllButtons.set("tag",n);const s=this.createToggleButton("tag");i.appendChild(s);const o=document.createElement("div");o.className="filter-item filter-buttons-dynamic-container",e.appendChild(i),e.appendChild(o),this.filtersContainer.appendChild(e);const r=t.map((([t,e])=>({value:t,count:e,label:t}))).sort(((t,e)=>e.count!==t.count?e.count-t.count:t.value.localeCompare(e.value)));this.dynamicGroups.set("tag",{values:r,container:o,toggleButton:s,limit:10,expanded:!1}),this.renderDynamicGroup("tag")}buildDifficultyRow(){const t=this.createRowContainer();t.appendChild(this.createFilterButton("difficulty","all","全部难度",!0)),Array.from(this.difficultiesSet).sort(((t,e)=>t.localeCompare(e))).forEach((e=>{t.appendChild(this.createFilterButton("difficulty",e,e))})),this.filtersContainer.appendChild(t)}buildAuthorRow(){const t=Array.from(this.authorsCount.entries()).filter((([t])=>t.length>0));if(0===t.length)return;const e=document.createElement("div");e.className="filter-item-column";const i=this.createRowContainer(),n=this.createFilterButton("author","all","全部作者",!0);i.appendChild(n),this.dynamicAllButtons.set("author",n);const s=this.createToggleButton("author");i.appendChild(s);const o=document.createElement("div");o.className="filter-item filter-buttons-dynamic-container",e.appendChild(i),e.appendChild(o),this.filtersContainer.appendChild(e);const r=t.map((([t,e])=>({value:t,count:e,label:t}))).sort(((t,e)=>e.count!==t.count?e.count-t.count:t.value.localeCompare(e.value)));this.dynamicGroups.set("author",{values:r,container:o,toggleButton:s,limit:5,expanded:!1}),this.renderDynamicGroup("author")}buildReleaseTimeRow(){const t=this.createRowContainer();[{value:"all",label:"发布时间"},{value:"after2024",label:"2024之后"},{value:"2024-2021",label:"2024-2021"},{value:"2021-2018",label:"2021-2018"},{value:"2018-2015",label:"2018-2015"},{value:"before2015",label:"2015之前"}].forEach(((e,i)=>{const n=this.createFilterButton("releaseTime",e.value,e.label,0===i);t.appendChild(n)})),this.filtersContainer.appendChild(t)}buildCreateTimeRow(){const t=this.createRowContainer();[{value:"all",label:"添加时间"},{value:"week",label:"最近一周"},{value:"month",label:"最近一月"},{value:"quarter",label:"最近三月"},{value:"year",label:"最近一年"},{value:"custom",label:"自定义"}].forEach(((e,i)=>{const n=this.createFilterButton("createTime",e.value,e.label,0===i);t.appendChild(n)})),this.filtersContainer.appendChild(t)}buildSortRow(){const t=this.createRowContainer();[{label:"评分 ↓",field:"score",direction:"desc"},{label:"评分 ↑",field:"score",direction:"asc"},{label:"标题 A-Z",field:"title",direction:"asc"},{label:"标题 Z-A",field:"title",direction:"desc"},{label:"发布日期 新→旧",field:"datePublished",direction:"desc"},{label:"发布日期 旧→新",field:"datePublished",direction:"asc"},{label:"创建时间 新→旧",field:"ctime",direction:"desc"},{label:"创建时间 旧→新",field:"ctime",direction:"asc"}].forEach((e=>{const i=this.createFilterButton("sort",`${e.field}:${e.direction}`,e.label);i.dataset.sortField=e.field,i.dataset.sortDirection=e.direction;const n=e.field===this.state.sortField&&e.direction===this.state.sortDirection;this.setButtonActiveState(i,n),t.appendChild(i)})),this.filtersContainer.appendChild(t)}ensureDatePicker(){let t=this.root.querySelector("#custom-date-picker");t?t.innerHTML="":(t=document.createElement("div"),t.id="custom-date-picker",t.style.display="none",t.className="filter-item",this.filtersContainer.appendChild(t));const e=document.createElement("span");e.textContent="开始日期:";const i=document.createElement("input");i.type="date",i.id="start-date";const n=document.createElement("span");n.textContent="结束日期:",n.style.marginLeft="10px";const s=document.createElement("input");s.type="date",s.id="end-date";const o=document.createElement("button");o.textContent="应用",o.className="filter-btn",o.style.marginLeft="10px",o.addEventListener("click",(()=>{this.state.customDateStart=i.value||null,this.state.customDateEnd=s.value||null,this.applyFilters()})),t.append(e,i,n,s,o)}createRowContainer(){const t=document.createElement("div");return t.className="filter-item",t}createFilterButton(t,e,i,n=!1){const s=document.createElement("button");return s.className="filter-btn",s.type="button",s.textContent=i,s.dataset.filterType=t,s.dataset.filterValue=e,this.setButtonActiveState(s,n),s.addEventListener("click",(()=>this.onFilterButtonClick(s))),this.registerButton(t,s),s}setButtonActiveState(t,e){t.classList.toggle("active",e),t.setAttribute("aria-pressed",e?"true":"false")}isMultiSelectType(t){return"tag"===t||"difficulty"===t||"author"===t}getMultiSelectState(t){switch(t){case"tag":return this.state.tag;case"difficulty":return this.state.difficulty;case"author":return this.state.author}return[]}setMultiSelectState(t,e){switch(t){case"tag":this.state.tag=e;break;case"difficulty":this.state.difficulty=e;break;case"author":this.state.author=e}}getStringStateForType(t){switch(t){case"system":return this.state.system;case"favorite":return this.state.favorite;case"releaseTime":return this.state.releaseTime;case"createTime":return this.state.createTime;case"status":return this.state.status;case"fcontinue":return this.state.fcontinue;default:return null}}isValueActive(t,e){if(this.isMultiSelectType(t)){const i=this.getMultiSelectState(t);return"all"===e?0===i.length:i.some((t=>t.toLowerCase()===e.toLowerCase()))}const i=this.getStringStateForType(t);return null!==i&&i===e}handleMultiSelectClick(t,e){if("all"===e)return void this.setMultiSelectState(t,[]);const i=e.toLowerCase(),n=this.getMultiSelectState(t);if(n.some((t=>t.toLowerCase()===i))){const e=n.filter((t=>t.toLowerCase()!==i));this.setMultiSelectState(t,e)}else this.setMultiSelectState(t,[...n,e])}createToggleButton(t){const e=document.createElement("button");return e.className="filter-btn toggle-btn",e.type="button",e.textContent="展开更多",e.addEventListener("click",(()=>{const e=this.dynamicGroups.get(t);e&&(e.expanded=!e.expanded,this.renderDynamicGroup(t))})),e}renderDynamicGroup(t){const e=this.dynamicGroups.get(t);if(!e)return;e.container.innerHTML="",this.resetButtonGroup(t);if((e.expanded?e.values:e.values.slice(0,e.limit)).forEach((i=>{const n=this.createFilterButton(t,i.value,i.label,this.isValueActive(t,i.value));n.title=`共 ${i.count} 条记录`,e.container.appendChild(n)})),e.values.length>e.limit){const t=e.values.length-e.limit;e.toggleButton.style.display="inline-block",e.toggleButton.textContent=e.expanded?"收起":`展开更多 (${t}+)`}else e.toggleButton.style.display="none";this.updateActiveButtons(t)}resetButtonGroup(t){const e=this.dynamicAllButtons.get(t);e?this.buttonGroups.set(t,[e]):this.buttonGroups.has(t)&&this.buttonGroups.set(t,[])}registerButton(t,e){const i=this.buttonGroups.get(t)??[];i.push(e),this.buttonGroups.set(t,i)}setupSearch(){this.searchInput&&(this.searchInput.addEventListener("input",(()=>{this.state.searchQuery=this.searchInput?.value.trim().toLowerCase()??"",this.applyFilters()})),this.searchInput.addEventListener("keydown",(t=>{"Enter"===t.key&&(t.preventDefault(),this.state.searchQuery=this.searchInput?.value.trim().toLowerCase()??"",this.applyFilters())}))),this.searchButton&&this.searchButton.addEventListener("click",(()=>{this.state.searchQuery=this.searchInput?.value.trim().toLowerCase()??"",this.applyFilters()}))}onFilterButtonClick(t){const e=t.dataset.filterType??"",i=t.dataset.filterValue??"";if(!e)return;if(this.isMultiSelectType(e))return this.handleMultiSelectClick(e,i),this.updateActiveButtons(e),void this.applyFilters();if("sort"===e)return this.state.sortField=t.dataset.sortField??"score",this.state.sortDirection=t.dataset.sortDirection??"desc",this.updateActiveButtons(e,t),void this.applyFilters();if("createTime"===e){this.state.createTime=i;const n=this.root.querySelector("#custom-date-picker");return n&&(n.style.display="custom"===i?"flex":"none"),"custom"!==i&&(this.state.customDateStart=null,this.state.customDateEnd=null),this.updateActiveButtons(e,t),void this.applyFilters()}if("releaseTime"===e)return this.state.releaseTime=i,this.updateActiveButtons(e,t),void this.applyFilters();const n=e;if(n in this.state){"string"==typeof this.state[n]&&(this.state[n]=i),this.updateActiveButtons(e,t),this.applyFilters()}}updateActiveButtons(t,e){const i=this.buttonGroups.get(t)??[];if(0===i.length)return;if(this.isMultiSelectType(t)){const e=new Set(this.getMultiSelectState(t).map((t=>t.toLowerCase()))),n=0===e.size;return void i.forEach((t=>{if(t.classList.contains("toggle-btn"))return;const i=(t.dataset.filterValue??"").toLowerCase(),s="all"===i?n:e.has(i);this.setButtonActiveState(t,s)}))}if("sort"===t)return void i.forEach((t=>{if(t.classList.contains("toggle-btn"))return;const e=t.dataset.sortField,i=t.dataset.sortDirection,n=e===this.state.sortField&&i===this.state.sortDirection;this.setButtonActiveState(t,n)}));const n=this.getStringStateForType(t);i.forEach((t=>{if(t.classList.contains("toggle-btn"))return;if(e)return void this.setButtonActiveState(t,t===e);if(null===n)return;const i=t.dataset.filterValue??"";this.setButtonActiveState(t,i===n)}))}applyFilters(){const t=this.state.searchQuery;this.selectedTagFiltersLower=this.state.tag.map((t=>t.toLowerCase())),this.selectedDifficultyFiltersLower=this.state.difficulty.map((t=>t.toLowerCase())),this.selectedAuthorFiltersLower=this.state.author.map((t=>t.toLowerCase()));const e=this.cardsData.filter((e=>this.matchesCard(e,t))).sort(((t,e)=>this.compareCards(t,e))),i=new Set(e.map((t=>t.element)));this.cardsData.forEach((t=>{i.has(t.element)?t.element.style.display="":t.element.style.display="none"})),e.forEach((t=>{this.gallery.appendChild(t.element)})),this.updateResultsCount(e.length)}matchesCard(t,e){if("all"!==this.state.system&&!t.systemsLower.includes(this.state.system.toLowerCase()))return!1;if("true"===this.state.favorite&&!t.favorite)return!1;if("false"===this.state.favorite&&t.favorite)return!1;if(this.selectedTagFiltersLower.length>0){if(this.selectedTagFiltersLower.some((e=>!t.tagsLower.includes(e))))return!1}if(this.selectedDifficultyFiltersLower.length>0){if(!this.selectedDifficultyFiltersLower.some((e=>t.difficultiesLower.includes(e))))return!1}if(this.selectedAuthorFiltersLower.length>0){if(!this.selectedAuthorFiltersLower.some((e=>t.authorsLower.includes(e))))return!1}return!!this.matchesReleaseTime(t)&&(!!this.matchesCreateTime(t)&&(!(e&&e.length>0)||t.searchContent.includes(e)))}matchesReleaseTime(t){const e=this.state.releaseTime;if("all"===e)return!0;const i=t.releaseYear;if(!i)return!1;switch(e){case"after2024":return i>2024;case"2024-2021":return i>=2021&&i<=2024;case"2021-2018":return i>=2018&&i<2021;case"2018-2015":return i>=2015&&i<2018;case"before2015":return i<2015;default:return!0}}matchesCreateTime(t){const e=this.state.createTime;if("all"===e)return!0;const i=t.createTime;if(!i)return!1;const n=new Date;let s=null;switch(e){case"week":s=new Date(n.getTime()-6048e5);break;case"month":s=new Date(n.getFullYear(),n.getMonth()-1,n.getDate());break;case"quarter":s=new Date(n.getFullYear(),n.getMonth()-3,n.getDate());break;case"year":s=new Date(n.getFullYear()-1,n.getMonth(),n.getDate());break;case"custom":return this.matchesCustomRange(i);default:return!0}return!s||i>=s}matchesCustomRange(t){const e=this.state.customDateStart?new Date(this.state.customDateStart):null,i=this.state.customDateEnd?new Date(this.state.customDateEnd):null;return(!e||!Number.isNaN(e.getTime()))&&((!i||!Number.isNaN(i.getTime()))&&(!(e&&(e.setHours(0,0,0,0),t<e))&&!(i&&(i.setHours(23,59,59,999),t>i))))}compareCards(t,e){const i=this.state.sortField,n=this.state.sortDirection;if("title"===i){const i=t.titleLower.localeCompare(e.titleLower);return"asc"===n?i:-i}let s,o;switch(i){case"score":s=t.score??("asc"===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),o=e.score??("asc"===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY);break;case"datePublished":s=t.releaseDate?.getTime()??("asc"===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),o=e.releaseDate?.getTime()??("asc"===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY);break;case"ctime":s=t.createTime?.getTime()??("asc"===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY),o=e.createTime?.getTime()??("asc"===n?Number.POSITIVE_INFINITY:Number.NEGATIVE_INFINITY);break;default:s=0,o=0}return s===o?t.index-e.index:"asc"===n?s-o:o-s}updateResultsCount(t){this.resultsCountEl||(this.resultsCountEl=document.createElement("div"),this.resultsCountEl.className="results-count",this.filtersContainer.after(this.resultsCountEl)),this.resultsCountEl.textContent=`找到 ${t} 个结果`,this.noResultsEl||(this.noResultsEl=document.createElement("div"),this.noResultsEl.className="no-results",this.noResultsEl.textContent="没有找到符合条件的媒体",this.resultsCountEl.after(this.noResultsEl)),this.noResultsEl.style.display=0===t?"block":"none"}},Ct=St;Ct.initializedRoots=new WeakSet;var Lt=class{constructor(t){if(this.title="",this.headers=[],this.callouts=[],this.lists=[],this.children=[],this.isPreview=!1,this.initialized=!1,this._exists=!1,!window?.location)return;if((t=t.trim()).startsWith("http")||t.startsWith("www")||t.startsWith("/")||t.startsWith("\\"))return void console.error("Please use a relative path from the root of the wesite to load a webpage");this.pathname=ot.getPathnameFromURL(t),this.hash=ot.getHashFromURL(t),this.query=ot.getQueryFromURL(t);let e=window?.location?.origin;if("null"==e&&(e="file://"),this.info=ObsidianSite.getWebpageData(this.pathname),!this.info&&!ObsidianSite.metadata.ignoreMetadata)return new lt("This page does not exist yet."),void console.warn("This page does not exist yet.",this.pathname);this._exists=!0,this.documentType=this.info?.type??"markdown",this.title=this.info?.title??this.pathname}get isMainDocument(){return null==this.parent&&!this.isPreview}get bounds(){return g.fromElement(this.documentEl)}get exists(){return this._exists}findHeader(t){for(const e of this.headers){let i=e.find(t);if(i)return i}return null}getFlatHeaders(){return this.headers.flatMap((t=>t.getFlatChildren()))}scrollToHeader(t){console.log("Scrolling to header",t);const e=this.findHeader((e=>e.id==t));e&&e.scrollTo()}findElements(){this.containerEl||(this.containerEl=ObsidianSite.centerContentEl),this.sizerEl="markdown"==this.documentType?this.containerEl.querySelector(".markdown-preview-sizer"):void 0,this.documentEl=this.containerEl.querySelector(".obsidian-document"),this.headerEl=this.containerEl.querySelector(".header"),this.footerEl=this.containerEl.querySelector(".footer")}async load(t=null,e=ObsidianSite.centerContentEl,i=!1,n=!1){if(this.parent=t,this.isPreview=i,!this.pathname||!this.exists)return this;ObsidianSite.document;await ObsidianSite.showLoading(!0,e),this.containerEl=e;const s=await ObsidianSite.fetch(this.pathname);if(!s?.ok)return new lt("This document could not be loaded."),void console.error("Failed to load document",this.pathname);{const t=await s.text();this.sourceHtml=(new DOMParser).parseFromString(t,"text/html");let i=this.sourceHtml.querySelector(".obsidian-document");if(i||(i=this.sourceHtml.querySelector(".password-lock")),i){i=document.adoptNode(i);const t=e.querySelector(".obsidian-document")||e.querySelector(".password-lock");t?(t.before(i),t.remove()):e.appendChild(i)}window.__tocHideObserver&&(window.__tocHideObserver.disconnect(),window.__tocHideObserver=null);document.querySelectorAll("script[data-unlock-script]").forEach((t=>t.remove()));const r=this.sourceHtml.querySelectorAll("script[data-unlock-script]");if(r.length>0){const t=document.createDocumentFragment();r.forEach((e=>{const i=document.createElement("script");i.textContent=e.textContent,i.setAttribute("data-unlock-script","true"),t.appendChild(i)})),document.body.appendChild(t)}if(await this.loadChildDocuments(),await this.postLoadInit(),this.sizerEl&&n&&this.hash&&""!=this.hash){var o=this.headers.find((t=>t.findByID(this.hash)))?.findByID(this.hash);o&&(this.sizerEl.innerHTML=o.getHeaderWithContentRecursive().map((t=>t.outerHTML)).join(""))}this.initialized=!1}return this}async show(){await ObsidianSite.showLoading(!1,this.containerEl)}async postLoadInit(){this.findElements(),await this.postProcess();if(null!==document.querySelector("#password-lock-container")){const t=document.querySelector("#outline");t&&(t.style.setProperty("display","none","important"),t.setAttribute("data-toc-hidden","true")),pt.initOnEncryptedPage()}return(this.isMainDocument||this.isPreview)&&this.documentEl&&(this.processHeaders(),this.processCallouts(),this.processLists(),this.initNewImageZoom(),(new ct).parseAndDisplayYamlProperties(this.info,this.documentEl??this.containerEl),this.renderCreatedUpdatedBar()),"canvas"==this.documentType&&(this.canvas=new C(this)),(this.isMainDocument||this.isPreview)&&this.documentEl&&(ot.initializeLinks(this.documentEl??this.containerEl),Ct.initialize(this.containerEl??this.documentEl),this.initMachineTypeTags(),this.initFootnotes()),this}renderCreatedUpdatedBar(){if(!this.headerEl)return;if(!ObsidianSite.metadata?.featureOptions?.document?.showCreatedUpdatedTime)return;this.headerEl.querySelector(".created-updated-bar")?.remove();const{createdTime:t,modifiedTime:e}=this.info||{};if(!t&&!e)return;const i=document.createElement("div");i.className="created-updated-bar";const n=(t,e)=>{const i=document.createElement("span");i.className=`${e}-time`;const n=document.createElement("span");n.className=`${e}-icon`,n.innerHTML="created"===e?'<svg width="1.2em" height="1.2em" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n\t\t\t\t<path d="M20 10V7C20 5.89543 19.1046 5 18 5H6C4.89543 5 4 5.89543 4 7V10M20 10V19C20 20.1046 19.1046 21 18 21H6C4.89543 21 4 20.1046 4 19V10M20 10H4M8 3V7M16 3V7" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>\n\t\t\t\t<rect x="6" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>\n\t\t\t\t<rect x="10.5" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>\n\t\t\t\t<rect x="15" y="12" width="3" height="3" rx="0.5" fill="currentColor"/>\n\t\t\t</svg>':'<svg width="1.2em" height="1.2em" viewBox="0 0 1024 1024" fill="currentColor">\n\t\t\t\t<path d="M512 192c179.2 0 320 140.8 320 320s-140.8 320-320 320-320-140.8-320-320S332.8 192 512 192M512 128C300.8 128 128 300.8 128 512s172.8 384 384 384 384-172.8 384-384S723.2 128 512 128L512 128z"/>\n\t\t\t\t<path d="M640 672c-6.4 0-19.2 0-25.6-6.4l-128-128C486.4 531.2 480 518.4 480 512L480 288C480 268.8 492.8 256 512 256s32 12.8 32 32l0 211.2 121.6 121.6c12.8 12.8 12.8 32 0 44.8C659.2 672 646.4 672 640 672z"/>\n\t\t\t</svg>';const s=document.createElement("span");s.className=`${e}-time-value`;const o=new Date(t),r=o.getFullYear(),a=String(o.getMonth()+1).padStart(2,"0"),l=String(o.getDate()).padStart(2,"0");if("created"===e)s.textContent=`${r}-${a}-${l}`;else{const t=String(o.getHours()).padStart(2,"0"),e=String(o.getMinutes()).padStart(2,"0");s.textContent=`${r}-${a}-${l} ${t}:${e}`}return i.appendChild(n),i.appendChild(s),i};t&&i.appendChild(n(t,"created")),e&&i.appendChild(n(e,"updated"));const s=this.headerEl.querySelector("h1.page-title");s?.nextSibling?s.parentNode?.insertBefore(i,s.nextSibling):s?s.parentNode?.appendChild(i):this.headerEl.insertBefore(i,this.headerEl.firstChild)}initFootnotes(){Promise.resolve().then((()=>(d(),l))).then((({FootnoteHandler:t})=>{t.getInstance().initializeFootnotes(this.documentEl??this.containerEl)}))}initNewImageZoom(){this.documentEl&&(kt.getInstance().initImagesInElement(this.documentEl),Et.getInstance().initImagesInElement(this.documentEl))}processHeaders(){this.documentEl&&(this.headers=it.createHeaderTree(this.documentEl))}processCallouts(){if(!this.documentEl)return;const t=Array.from(this.documentEl.querySelectorAll(".callout"));this.callouts=[];for(const e of t)this.callouts.push(new tt(e))}processLists(){if(!this.documentEl)return;const t=Array.from(this.documentEl.querySelectorAll(":is(ul, ol):not(:is(ul, ol) :is(ul, ol))"));this.lists=[];for(const e of t)this.lists.push(new at(e,void 0))}async postProcess(){this.documentEl&&(this.isMainDocument&&!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.giscus.enabled&&(window.requestIdleCallback?window.requestIdleCallback((()=>new pt)):setTimeout((()=>new pt),1e3)),this.documentEl?.querySelectorAll(".kanban-plugin__item.is-complete input[type='checkbox']").forEach((t=>t.checked=!0)),ObsidianSite.metadata.ignoreMetadata||(this.documentEl?.classList.toggle("allow-fold-headings",ObsidianSite.metadata.featureOptions.document.allowFoldingHeadings),this.documentEl?.classList.toggle("allow-fold-lists",ObsidianSite.metadata.featureOptions.document.allowFoldingLists)),this.documentEl&&(await new yt(this.documentEl).init(),await new vt(this.documentEl).init()))}async loadChildDocuments(){if(!this.documentEl)return;this.findElements();let t=this,e=0;for(;t;)t=t.parent,e++;if(e>4)return;const i=Array.from(this.documentEl.querySelectorAll("link[itemprop='include-document']")),n=[];for(const t of i){const e=t.getAttribute("href");if(!e)continue;const i=new Lt(e).load(this,t.parentElement);n.push(i),console.log("Loading child",e),t.remove()}const s=await Promise.all(n);console.log("Loaded child documents",s),this.children.push(...s.filter((t=>null!=t)))}async loadChild(t,e){let i=new Lt(t),n=await i.load(this,e);return n&&this.children.push(n),n}async unloadChild(t){this.children=this.children.filter((e=>e!=t)),t.documentEl?.remove()}getMinReadableWidth(){return 30*parseFloat(getComputedStyle(this.sizerEl??this.documentEl).fontSize)}initMachineTypeTags(){const t=this.containerEl??this.documentEl;if(!t)return;const e=Array.from(t.querySelectorAll(".machine-type-tag"));for(const t of e){const e=t.getAttribute("title")?.toLowerCase()||"";t.replaceChildren(),"windows"===e?this.createSVGIcon(t,"windows"):"linux"===e?this.createSVGIcon(t,"linux"):"both"===e&&this.createSVGIcon(t,"both")}}createSVGIcon(t,e){const i=document.createElement("img");i.classList.add("machine-type-icon__image",`machine-type-icon__image--${e}`);const n="both"===e?"both.svg":`${e}.svg`;switch(i.src=`${N.libFolderName}/${N.mediaFolderName}/${n}`,e){case"both":i.alt="Windows 和 Linux";break;case"windows":i.alt="Windows";break;default:i.alt="Linux"}i.decoding="async",i.loading="lazy",this.moveMachineTypeIconToTitle(t,i)||t.appendChild(i)}moveMachineTypeIconToTitle(t,e){const i=t.closest(".machine-card");if(!i)return!1;const n=i.querySelector(".machine-title");if(!n)return!1;return this.ensureMachineTitleIconWrapper(n).replaceChildren(e),this.ensureMachineTitleTextWrapper(n),t.remove(),!0}ensureMachineTitleIconWrapper(t){let e=t.querySelector(".machine-title__icon");return e||(e=document.createElement("span"),e.className="machine-title__icon",t.insertBefore(e,t.firstChild)),e}ensureMachineTitleTextWrapper(t){let e=t.querySelector(".machine-title__text");const i=t.querySelector(".machine-title__icon");e||(e=document.createElement("span"),e.className="machine-title__text",t.appendChild(e));const n=Array.from(t.childNodes).filter((t=>t!==e&&t!==i&&!(t instanceof HTMLElement&&t.classList.contains("machine-title__icon"))));if(n.length>0)for(const t of n)e.appendChild(t);t.classList.add("machine-title--with-icon")}};function Tt(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{l(n.next(t))}catch(t){o(t)}}function a(t){try{l(n.throw(t))}catch(t){o(t)}}function l(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,a)}l((n=n.apply(t,e||[])).next())}))}var _t="KEYS",It="VALUES",Pt="",Ot=class{constructor(t,e){const i=t._tree,n=Array.from(i.keys());this.set=t,this._type=e,this._path=n.length>0?[{node:i,keys:n}]:[]}next(){const t=this.dive();return this.backtrack(),t}dive(){if(0===this._path.length)return{done:!0,value:void 0};const{node:t,keys:e}=Ft(this._path);if(Ft(e)===Pt)return{done:!1,value:this.result()};const i=t.get(Ft(e));return this._path.push({node:i,keys:Array.from(i.keys())}),this.dive()}backtrack(){if(0===this._path.length)return;const t=Ft(this._path).keys;t.pop(),t.length>0||(this._path.pop(),this.backtrack())}key(){return this.set._prefix+this._path.map((({keys:t})=>Ft(t))).filter((t=>t!==Pt)).join("")}value(){return Ft(this._path).node.get(Pt)}result(){switch(this._type){case It:return this.value();case _t:return this.key();default:return[this.key(),this.value()]}}[Symbol.iterator](){return this}},Ft=t=>t[t.length-1],Nt=(t,e,i,n,s,o,r,a)=>{const l=o*r;t:for(const c of t.keys())if(c===Pt){const e=s[l-1];e<=i&&n.set(a,[t.get(c),e])}else{let l=o;for(let t=0;t<c.length;++t,++l){const n=c[t],o=r*l,a=o-r;let h=s[o];const d=Math.max(0,l-i-1),u=Math.min(r-1,l+i);for(let t=d;t<u;++t){const i=n!==e[t],r=s[a+t]+ +i,l=s[a+t+1]+1,c=s[o+t]+1,d=s[o+t+1]=Math.min(r,l,c);d<h&&(h=d)}if(h>i)continue t}Nt(t.get(c),e,i,n,s,l,r,a+c)}},Mt=class{constructor(t=new Map,e=""){this._size=void 0,this._tree=t,this._prefix=e}atPrefix(t){if(!t.startsWith(this._prefix))throw new Error("Mismatched prefix");const[e,i]=zt(this._tree,t.slice(this._prefix.length));if(void 0===e){const[e,n]=qt(i);for(const i of e.keys())if(i!==Pt&&i.startsWith(n)){const s=new Map;return s.set(i.slice(n.length),e.get(i)),new Mt(s,t)}}return new Mt(e,t)}clear(){this._size=void 0,this._tree.clear()}delete(t){return this._size=void 0,Dt(this._tree,t)}entries(){return new Ot(this,"ENTRIES")}forEach(t){for(const[e,i]of this)t(e,i,this)}fuzzyGet(t,e){return((t,e,i)=>{const n=new Map;if(void 0===e)return n;const s=e.length+1,o=s+i,r=new Uint8Array(o*s).fill(i+1);for(let t=0;t<s;++t)r[t]=t;for(let t=1;t<o;++t)r[t*s]=t;return Nt(t,e,i,n,r,1,s,""),n})(this._tree,t,e)}get(t){const e=At(this._tree,t);return void 0!==e?e.get(Pt):void 0}has(t){const e=At(this._tree,t);return void 0!==e&&e.has(Pt)}keys(){return new Ot(this,_t)}set(t,e){if("string"!=typeof t)throw new Error("key must be a string");this._size=void 0;return Rt(this._tree,t).set(Pt,e),this}get size(){if(this._size)return this._size;this._size=0;const t=this.entries();for(;!t.next().done;)this._size+=1;return this._size}update(t,e){if("string"!=typeof t)throw new Error("key must be a string");this._size=void 0;const i=Rt(this._tree,t);return i.set(Pt,e(i.get(Pt))),this}fetch(t,e){if("string"!=typeof t)throw new Error("key must be a string");this._size=void 0;const i=Rt(this._tree,t);let n=i.get(Pt);return void 0===n&&i.set(Pt,n=e()),n}values(){return new Ot(this,It)}[Symbol.iterator](){return this.entries()}static from(t){const e=new Mt;for(const[i,n]of t)e.set(i,n);return e}static fromObject(t){return Mt.from(Object.entries(t))}},zt=(t,e,i=[])=>{if(0===e.length||null==t)return[t,i];for(const n of t.keys())if(n!==Pt&&e.startsWith(n))return i.push([t,n]),zt(t.get(n),e.slice(n.length),i);return i.push([t,e]),zt(void 0,"",i)},At=(t,e)=>{if(0===e.length||null==t)return t;for(const i of t.keys())if(i!==Pt&&e.startsWith(i))return At(t.get(i),e.slice(i.length))},Rt=(t,e)=>{const i=e.length;t:for(let n=0;t&&n<i;){for(const s of t.keys())if(s!==Pt&&e[n]===s[0]){const o=Math.min(i-n,s.length);let r=1;for(;r<o&&e[n+r]===s[r];)++r;const a=t.get(s);if(r===s.length)t=a;else{const i=new Map;i.set(s.slice(r),a),t.set(e.slice(n,n+r),i),t.delete(s),t=i}n+=r;continue t}const s=new Map;return t.set(e.slice(n),s),s}return t},Dt=(t,e)=>{const[i,n]=zt(t,e);if(void 0!==i)if(i.delete(Pt),0===i.size)Bt(n);else if(1===i.size){const[t,e]=i.entries().next().value;Ht(n,t,e)}},Bt=t=>{if(0===t.length)return;const[e,i]=qt(t);if(e.delete(i),0===e.size)Bt(t.slice(0,-1));else if(1===e.size){const[i,n]=e.entries().next().value;i!==Pt&&Ht(t.slice(0,-1),i,n)}},Ht=(t,e,i)=>{if(0===t.length)return;const[n,s]=qt(t);n.set(s+e,i),n.delete(s)},qt=t=>t[t.length-1],Wt="or",$t=class{constructor(t){if(null==(null==t?void 0:t.fields))throw new Error('MiniSearch: option "fields" must be provided');const e=null==t.autoVacuum||!0===t.autoVacuum?se:t.autoVacuum;this._options=Object.assign(Object.assign(Object.assign({},Zt),t),{autoVacuum:e,searchOptions:Object.assign(Object.assign({},te),t.searchOptions||{}),autoSuggestOptions:Object.assign(Object.assign({},ee),t.autoSuggestOptions||{})}),this._index=new Mt,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldIds={},this._fieldLength=new Map,this._avgFieldLength=[],this._nextId=0,this._storedFields=new Map,this._dirtCount=0,this._currentVacuum=null,this._enqueuedVacuum=null,this._enqueuedVacuumConditions=ne,this.addFields(this._options.fields)}add(t){const{extractField:e,tokenize:i,processTerm:n,fields:s,idField:o}=this._options,r=e(t,o);if(null==r)throw new Error(`MiniSearch: document does not have ID field "${o}"`);if(this._idToShortId.has(r))throw new Error(`MiniSearch: duplicate ID ${r}`);const a=this.addDocumentId(r);this.saveStoredFields(a,t);for(const o of s){const s=e(t,o);if(null==s)continue;const r=i(s.toString(),o),l=this._fieldIds[o],c=new Set(r).size;this.addFieldLength(a,l,this._documentCount-1,c);for(const t of r){const e=n(t,o);if(Array.isArray(e))for(const t of e)this.addTerm(l,a,t);else e&&this.addTerm(l,a,e)}}}addAll(t){for(const e of t)this.add(e)}addAllAsync(t,e={}){const{chunkSize:i=10}=e,n={chunk:[],promise:Promise.resolve()},{chunk:s,promise:o}=t.reduce((({chunk:t,promise:e},n,s)=>(t.push(n),(s+1)%i==0?{chunk:[],promise:e.then((()=>new Promise((t=>setTimeout(t,0))))).then((()=>this.addAll(t)))}:{chunk:t,promise:e})),n);return o.then((()=>this.addAll(s)))}remove(t){const{tokenize:e,processTerm:i,extractField:n,fields:s,idField:o}=this._options,r=n(t,o);if(null==r)throw new Error(`MiniSearch: document does not have ID field "${o}"`);const a=this._idToShortId.get(r);if(null==a)throw new Error(`MiniSearch: cannot remove document with ID ${r}: it is not in the index`);for(const o of s){const s=n(t,o);if(null==s)continue;const r=e(s.toString(),o),l=this._fieldIds[o],c=new Set(r).size;this.removeFieldLength(a,l,this._documentCount,c);for(const t of r){const e=i(t,o);if(Array.isArray(e))for(const t of e)this.removeTerm(l,a,t);else e&&this.removeTerm(l,a,e)}}this._storedFields.delete(a),this._documentIds.delete(a),this._idToShortId.delete(r),this._fieldLength.delete(a),this._documentCount-=1}removeAll(t){if(t)for(const e of t)this.remove(e);else{if(arguments.length>0)throw new Error("Expected documents to be present. Omit the argument to remove all documents.");this._index=new Mt,this._documentCount=0,this._documentIds=new Map,this._idToShortId=new Map,this._fieldLength=new Map,this._avgFieldLength=[],this._storedFields=new Map,this._nextId=0}}discard(t){const e=this._idToShortId.get(t);if(null==e)throw new Error(`MiniSearch: cannot discard document with ID ${t}: it is not in the index`);this._idToShortId.delete(t),this._documentIds.delete(e),this._storedFields.delete(e),(this._fieldLength.get(e)||[]).forEach(((t,i)=>{this.removeFieldLength(e,i,this._documentCount,t)})),this._fieldLength.delete(e),this._documentCount-=1,this._dirtCount+=1,this.maybeAutoVacuum()}maybeAutoVacuum(){if(!1===this._options.autoVacuum)return;const{minDirtFactor:t,minDirtCount:e,batchSize:i,batchWait:n}=this._options.autoVacuum;this.conditionalVacuum({batchSize:i,batchWait:n},{minDirtCount:e,minDirtFactor:t})}discardAll(t){const e=this._options.autoVacuum;try{this._options.autoVacuum=!1;for(const e of t)this.discard(e)}finally{this._options.autoVacuum=e}this.maybeAutoVacuum()}replace(t){const{idField:e,extractField:i}=this._options,n=i(t,e);this.discard(n),this.add(t)}vacuum(t={}){return this.conditionalVacuum(t)}conditionalVacuum(t,e){return this._currentVacuum?(this._enqueuedVacuumConditions=this._enqueuedVacuumConditions&&e,null!=this._enqueuedVacuum||(this._enqueuedVacuum=this._currentVacuum.then((()=>{const e=this._enqueuedVacuumConditions;return this._enqueuedVacuumConditions=ne,this.performVacuuming(t,e)}))),this._enqueuedVacuum):!1===this.vacuumConditionsMet(e)?Promise.resolve():(this._currentVacuum=this.performVacuuming(t),this._currentVacuum)}performVacuuming(t,e){return Tt(this,void 0,void 0,(function*(){const i=this._dirtCount;if(this.vacuumConditionsMet(e)){const e=t.batchSize||ie.batchSize,n=t.batchWait||ie.batchWait;let s=1;for(const[t,i]of this._index){for(const[t,e]of i)for(const[n]of e)this._documentIds.has(n)||(e.size<=1?i.delete(t):e.delete(n));0===this._index.get(t).size&&this._index.delete(t),s%e==0&&(yield new Promise((t=>setTimeout(t,n)))),s+=1}this._dirtCount-=i}yield null,this._currentVacuum=this._enqueuedVacuum,this._enqueuedVacuum=null}))}vacuumConditionsMet(t){if(null==t)return!0;let{minDirtCount:e,minDirtFactor:i}=t;return e=e||se.minDirtCount,i=i||se.minDirtFactor,this.dirtCount>=e&&this.dirtFactor>=i}get isVacuuming(){return null!=this._currentVacuum}get dirtCount(){return this._dirtCount}get dirtFactor(){return this._dirtCount/(1+this._documentCount+this._dirtCount)}has(t){return this._idToShortId.has(t)}getStoredFields(t){const e=this._idToShortId.get(t);if(null!=e)return this._storedFields.get(e)}search(t,e={}){const i=this.executeQuery(t,e),n=[];for(const[t,{score:s,terms:o,match:r}]of i){const i=o.length||1,a={id:this._documentIds.get(t),score:s*i,terms:Object.keys(r),queryTerms:o,match:r};Object.assign(a,this._storedFields.get(t)),(null==e.filter||e.filter(a))&&n.push(a)}return t===$t.wildcard&&null==e.boostDocument&&null==this._options.searchOptions.boostDocument||n.sort(ae),n}autoSuggest(t,e={}){e=Object.assign(Object.assign({},this._options.autoSuggestOptions),e);const i=new Map;for(const{score:n,terms:s}of this.search(t,e)){const t=s.join(" "),e=i.get(t);null!=e?(e.score+=n,e.count+=1):i.set(t,{score:n,terms:s,count:1})}const n=[];for(const[t,{score:e,terms:s,count:o}]of i)n.push({suggestion:t,terms:s,score:e/o});return n.sort(ae),n}get documentCount(){return this._documentCount}get termCount(){return this._index.size}static loadJSON(t,e){if(null==e)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJS(JSON.parse(t),e)}static loadJSONAsync(t,e){return Tt(this,void 0,void 0,(function*(){if(null==e)throw new Error("MiniSearch: loadJSON should be given the same options used when serializing the index");return this.loadJSAsync(JSON.parse(t),e)}))}static getDefault(t){if(Zt.hasOwnProperty(t))return Kt(Zt,t);throw new Error(`MiniSearch: unknown option "${t}"`)}static loadJS(t,e){const{index:i,documentIds:n,fieldLength:s,storedFields:o,serializationVersion:r}=t,a=this.instantiateMiniSearch(t,e);a._documentIds=ce(n),a._fieldLength=ce(s),a._storedFields=ce(o);for(const[t,e]of a._documentIds)a._idToShortId.set(e,t);for(const[t,e]of i){const i=new Map;for(const t of Object.keys(e)){let n=e[t];1===r&&(n=n.ds),i.set(parseInt(t,10),ce(n))}a._index.set(t,i)}return a}static loadJSAsync(t,e){return Tt(this,void 0,void 0,(function*(){const{index:i,documentIds:n,fieldLength:s,storedFields:o,serializationVersion:r}=t,a=this.instantiateMiniSearch(t,e);a._documentIds=yield he(n),a._fieldLength=yield he(s),a._storedFields=yield he(o);for(const[t,e]of a._documentIds)a._idToShortId.set(e,t);let l=0;for(const[t,e]of i){const i=new Map;for(const t of Object.keys(e)){let n=e[t];1===r&&(n=n.ds),i.set(parseInt(t,10),yield he(n))}++l%1e3==0&&(yield de(0)),a._index.set(t,i)}return a}))}static instantiateMiniSearch(t,e){const{documentCount:i,nextId:n,fieldIds:s,averageFieldLength:o,dirtCount:r,serializationVersion:a}=t;if(1!==a&&2!==a)throw new Error("MiniSearch: cannot deserialize an index created with an incompatible version");const l=new $t(e);return l._documentCount=i,l._nextId=n,l._idToShortId=new Map,l._fieldIds=s,l._avgFieldLength=o,l._dirtCount=r||0,l._index=new Mt,l}executeQuery(t,e={}){if(t===$t.wildcard)return this.executeWildcardQuery(e);if("string"!=typeof t){const i=Object.assign(Object.assign(Object.assign({},e),t),{queries:void 0}),n=t.queries.map((t=>this.executeQuery(t,i)));return this.combineResults(n,i.combineWith)}const{tokenize:i,processTerm:n,searchOptions:s}=this._options,o=Object.assign(Object.assign({tokenize:i,processTerm:n},s),e),{tokenize:r,processTerm:a}=o,l=r(t).flatMap((t=>a(t))).filter((t=>!!t)).map(Qt(o)).map((t=>this.executeQuerySpec(t,o)));return this.combineResults(l,o.combineWith)}executeQuerySpec(t,e){const i=Object.assign(Object.assign({},this._options.searchOptions),e),n=(i.fields||this._options.fields).reduce(((t,e)=>Object.assign(Object.assign({},t),{[e]:Kt(i.boost,e)||1})),{}),{boostDocument:s,weights:o,maxFuzzy:r,bm25:a}=i,{fuzzy:l,prefix:c}=Object.assign(Object.assign({},te.weights),o),h=this._index.get(t.term),d=this.termResults(t.term,t.term,1,t.termBoost,h,n,s,a);let u,p;if(t.prefix&&(u=this._index.atPrefix(t.term)),t.fuzzy){const e=!0===t.fuzzy?.2:t.fuzzy,i=e<1?Math.min(r,Math.round(t.term.length*e)):e;i&&(p=this._index.fuzzyGet(t.term,i))}if(u)for(const[e,i]of u){const o=e.length-t.term.length;if(!o)continue;null==p||p.delete(e);const r=c*e.length/(e.length+.3*o);this.termResults(t.term,e,r,t.termBoost,i,n,s,a,d)}if(p)for(const e of p.keys()){const[i,o]=p.get(e);if(!o)continue;const r=l*e.length/(e.length+o);this.termResults(t.term,e,r,t.termBoost,i,n,s,a,d)}return d}executeWildcardQuery(t){const e=new Map,i=Object.assign(Object.assign({},this._options.searchOptions),t);for(const[t,n]of this._documentIds){const s=i.boostDocument?i.boostDocument(n,"",this._storedFields.get(t)):1;e.set(t,{score:s,terms:[],match:{}})}return e}combineResults(t,e=Wt){if(0===t.length)return new Map;const i=e.toLowerCase(),n=Xt[i];if(!n)throw new Error(`Invalid combination operator: ${e}`);return t.reduce(n)||new Map}toJSON(){const t=[];for(const[e,i]of this._index){const n={};for(const[t,e]of i)n[t]=Object.fromEntries(e);t.push([e,n])}return{documentCount:this._documentCount,nextId:this._nextId,documentIds:Object.fromEntries(this._documentIds),fieldIds:this._fieldIds,fieldLength:Object.fromEntries(this._fieldLength),averageFieldLength:this._avgFieldLength,storedFields:Object.fromEntries(this._storedFields),dirtCount:this._dirtCount,index:t,serializationVersion:2}}termResults(t,e,i,n,s,o,r,a,l=new Map){if(null==s)return l;for(const c of Object.keys(o)){const h=o[c],d=this._fieldIds[c],u=s.get(d);if(null==u)continue;let p=u.size;const m=this._avgFieldLength[d];for(const s of u.keys()){if(!this._documentIds.has(s)){this.removeTerm(d,s,e),p-=1;continue}const o=r?r(this._documentIds.get(s),e,this._storedFields.get(s)):1;if(!o)continue;const g=u.get(s),f=this._fieldLength.get(s)[d],b=i*n*h*o*Jt(g,p,this._documentCount,f,m,a),y=l.get(s);if(y){y.score+=b,oe(y.terms,t);const i=Kt(y.match,e);i?i.push(c):y.match[e]=[c]}else l.set(s,{score:b,terms:[t],match:{[e]:[c]}})}}return l}addTerm(t,e,i){const n=this._index.fetch(i,le);let s=n.get(t);if(null==s)s=new Map,s.set(e,1),n.set(t,s);else{const t=s.get(e);s.set(e,(t||0)+1)}}removeTerm(t,e,i){if(!this._index.has(i))return void this.warnDocumentChanged(e,t,i);const n=this._index.fetch(i,le),s=n.get(t);null==s||null==s.get(e)?this.warnDocumentChanged(e,t,i):s.get(e)<=1?s.size<=1?n.delete(t):s.delete(e):s.set(e,s.get(e)-1),0===this._index.get(i).size&&this._index.delete(i)}warnDocumentChanged(t,e,i){for(const n of Object.keys(this._fieldIds))if(this._fieldIds[n]===e)return void this._options.logger("warn",`MiniSearch: document with ID ${this._documentIds.get(t)} has changed before removal: term "${i}" was not present in field "${n}". Removing a document after it has changed can corrupt the index!`,"version_conflict")}addDocumentId(t){const e=this._nextId;return this._idToShortId.set(t,e),this._documentIds.set(e,t),this._documentCount+=1,this._nextId+=1,e}addFields(t){for(let e=0;e<t.length;e++)this._fieldIds[t[e]]=e}addFieldLength(t,e,i,n){let s=this._fieldLength.get(t);null==s&&this._fieldLength.set(t,s=[]),s[e]=n;const o=(this._avgFieldLength[e]||0)*i+n;this._avgFieldLength[e]=o/(i+1)}removeFieldLength(t,e,i,n){if(1===i)return void(this._avgFieldLength[e]=0);const s=this._avgFieldLength[e]*i-n;this._avgFieldLength[e]=s/(i-1)}saveStoredFields(t,e){const{storeFields:i,extractField:n}=this._options;if(null==i||0===i.length)return;let s=this._storedFields.get(t);null==s&&this._storedFields.set(t,s={});for(const t of i){const i=n(e,t);void 0!==i&&(s[t]=i)}}};$t.wildcard=Symbol("*");var Vt,jt,Yt,Ut,Gt,Kt=(t,e)=>Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0,Xt={[Wt]:(t,e)=>{for(const i of e.keys()){const n=t.get(i);if(null==n)t.set(i,e.get(i));else{const{score:t,terms:s,match:o}=e.get(i);n.score=n.score+t,n.match=Object.assign(n.match,o),re(n.terms,s)}}return t},and:(t,e)=>{const i=new Map;for(const n of e.keys()){const s=t.get(n);if(null==s)continue;const{score:o,terms:r,match:a}=e.get(n);re(s.terms,r),i.set(n,{score:s.score+o,terms:s.terms,match:Object.assign(s.match,a)})}return i},and_not:(t,e)=>{for(const i of e.keys())t.delete(i);return t}},Jt=(t,e,i,n,s,o)=>{const{k:r,b:a,d:l}=o;return Math.log(1+(i-e+.5)/(e+.5))*(l+t*(r+1)/(t+r*(1-a+a*n/s)))},Qt=t=>(e,i,n)=>({term:e,fuzzy:"function"==typeof t.fuzzy?t.fuzzy(e,i,n):t.fuzzy||!1,prefix:"function"==typeof t.prefix?t.prefix(e,i,n):!0===t.prefix,termBoost:"function"==typeof t.boostTerm?t.boostTerm(e,i,n):1}),Zt={idField:"id",extractField:(t,e)=>t[e],tokenize:t=>t.split(ue),processTerm:t=>t.toLowerCase(),fields:void 0,searchOptions:void 0,storeFields:[],logger:(t,e)=>{"function"==typeof(null===console||void 0===console?void 0:console[t])&&console[t](e)},autoVacuum:!0},te={combineWith:Wt,prefix:!1,fuzzy:!1,maxFuzzy:6,boost:{},weights:{fuzzy:.45,prefix:.375},bm25:{k:1.2,b:.7,d:.5}},ee={combineWith:"and",prefix:(t,e,i)=>e===i.length-1},ie={batchSize:1e3,batchWait:10},ne={minDirtFactor:.1,minDirtCount:20},se=Object.assign(Object.assign({},ie),ne),oe=(t,e)=>{t.includes(e)||t.push(e)},re=(t,e)=>{for(const i of e)t.includes(i)||t.push(i)},ae=({score:t},{score:e})=>e-t,le=()=>new Map,ce=t=>{const e=new Map;for(const i of Object.keys(t))e.set(parseInt(i,10),t[i]);return e},he=t=>Tt(void 0,void 0,void 0,(function*(){const e=new Map;let i=0;for(const n of Object.keys(t))e.set(parseInt(n,10),t[n]),++i%1e3==0&&(yield de(0));return e})),de=t=>new Promise((e=>setTimeout(e,t))),ue=/[\n\r\p{Z}\p{P}]+/u,pe=class{search(t,e=63){if(0==t.length)return void this.clear();this.input.value=t,this.input.style.color=63!=e?"var(--text-accent)":"";const i=[];1&e&&i.push("title"),2&e&&i.push("aliases"),4&e&&i.push("headers"),8&e&&i.push("tags"),16&e&&i.push("path"),32&e&&i.push("content"),console.log(1&e,2&e,4&e,8&e,16&e,32&e);const n=this.index.search(t,{prefix:!0,fuzzy:.2,boost:{title:2,aliases:1.8,headers:1.5,tags:1.3,path:1.1},fields:i});console.log("Search results",n),n.length>50&&n.splice(50);const s=[],o=new Map;for(const e of n){if(e.score<.3*n[0].score&&s.length>4||e.score<.1*n[0].score)break;if(s.push(e.path),t.length>2){const i=[];let n=!1;for(const s in e.match){if(e.match[s].includes("headers"))for(const o of e.headers)if(o.toLowerCase().includes(s.toLowerCase())&&(i.includes(o)||i.push(o),t.toLowerCase()!=s.toLowerCase())){n=!0;break}if(n)break}o.set(e.path,i)}}if(ObsidianSite.fileTree?.filter(s),ObsidianSite.fileTree?.setSubHeadings(o),ObsidianSite.fileTree?.sort(((t,e)=>t&&e?s.findIndex((e=>t.path==e))-s.findIndex((t=>e.path==t)):0)),!ObsidianSite.fileTree){const e=document.createElement("div");n.filter((t=>t.path.endsWith(".html"))).slice(0,20).forEach((i=>{const n=document.createElement("div");n.classList.add("search-result");const s=document.createElement("a");s.classList.add("tree-item-self");const o=i.path+"?mark="+encodeURIComponent(t);s.setAttribute("href",o),s.appendChild(document.createTextNode(i.title)),n.appendChild(s),e.append(n)})),this.dedicatedSearchResultsList.replaceChildren(e),this.container.after(this.dedicatedSearchResultsList),ot.initializeLinks(this.dedicatedSearchResultsList)}}searchParseFilters(t){t.startsWith("?")&&(t=t.substring(1));let e=t.split(":")[0];t.includes(":")||(e=""),"content"==e||"text"==e||"body"==e?this.search(t,32):"title"==e||"name"==e?this.search(t,1):"path"==e?this.search(t,16):"header"==e||"headers"==e?this.search(t,4):"tag"==e||"tags"==e||t.startsWith("#")?this.search(t,8):"alias"==e||"aliases"==e?this.search(t,2):this.search(t)}clear(){this.container?.classList.remove("has-content"),this.input.value="",this.clearCurrentDocumentSearch(),ObsidianSite.fileTree?.unfilter(),ObsidianSite.fileTree?.removeSubHeadings(),ObsidianSite.fileTree?.unsort()}async init(){if(this.input=document.querySelector('input[type="search"]'),this.container=this.input?.closest("#search-container"),!this.input||!this.container)return;ObsidianSite.metadata.featureOptions.search.insertFeature(document.body,this.container);const t=await ObsidianSite.fetch(N.libFolderName+"/search-index.json");if(!t?.ok)return void console.error("Failed to fetch search index");const e=await t.json();try{this.index=$t.loadJS(e,{fields:["title","path","tags","headers"]})}catch(t){return void console.error("Failed to load search index: ",t)}const i=document.querySelector("#search-clear-button");return i?.addEventListener("click",(t=>{this.clear()})),this.input.addEventListener("input",(t=>{const e=t.target?.value??"";0!=e.length?this.searchParseFilters(e):this.clear()})),ObsidianSite.fileTree||(this.dedicatedSearchResultsList=document.createElement("div"),this.dedicatedSearchResultsList.setAttribute("id","search-results")),this}async searchCurrentDocument(t){this.clearCurrentDocumentSearch();(function(t){const e=[],i=document.createTreeWalker(t,NodeFilter.SHOW_TEXT,null);let n;for(;n=i.nextNode();)e.push(n);return e})(ObsidianSite.document.sizerEl??ObsidianSite.document.documentEl).forEach((async e=>{const i=e.nodeValue,n=i?.replace(new RegExp(t,"gi"),(t=>`<mark>${t}</mark>`));if(n&&n!==i){const t=document.createElement("div");t.innerHTML=n;Array.from(t.childNodes).forEach((t=>{t.nodeType!=Node.TEXT_NODE&&t?.setAttribute("class","search-mark"),e?.parentNode?.insertBefore(t,e)})),e?.parentNode?.removeChild(e)}}));const e=document.querySelector(".search-mark");setTimeout((()=>{e&&ObsidianSite.scrollTo(e)}),500)}clearCurrentDocumentSearch(){document.querySelectorAll(".search-mark").forEach((t=>{t.outerHTML=t.innerHTML}))}},me=class{constructor(t){if(this.minWidthEm=15,!t.classList.contains("sidebar"))throw new Error("Invalid sidebar container");this.containerEl=t,this.contentEl=t.querySelector(".leaf-content"),this.topbarEl=t.querySelector(".sidebar-topbar"),this.collapseEl=t.querySelector(".sidebar-collapse-icon"),this.topbarContentEl=t.querySelector(".topbar-content"),this.resizeHandleEl=t.querySelector(".sidebar-handle")??void 0,this._isLeft="left-sidebar"==t.id,this._sidebarID=t.id,this.collapseEl.addEventListener("click",(()=>{this.collapsed=!this.collapsed})),this.clickOutsideCollapse=this.clickOutsideCollapse.bind(this),this.minResizeWidth=parseFloat(getComputedStyle(this.resizeHandleEl?.parentElement??this.resizeHandleEl).fontSize)*this.minWidthEm,this.collapseWidth=this.minResizeWidth/4,this.setupSidebarResize()}get sidebarID(){return this._sidebarID}get isLeft(){return this._isLeft}get resizing(){return this._resizing}get collapsed(){return this._collapsed}set collapsed(t){if(this._collapsed===t)return;this._collapsed=t;const e="phone"===ObsidianSite.deviceSize,i="tablet"===ObsidianSite.deviceSize;t?document.body.removeEventListener("click",this.clickOutsideCollapse):(e&&(this.isLeft?ObsidianSite.rightSidebar&&!ObsidianSite.rightSidebar.collapsed&&(ObsidianSite.rightSidebar.collapsed=!0):ObsidianSite.leftSidebar&&!ObsidianSite.leftSidebar.collapsed&&(ObsidianSite.leftSidebar.collapsed=!0)),(e||i)&&(document.body.removeEventListener("click",this.clickOutsideCollapse),document.body.addEventListener("click",this.clickOutsideCollapse))),this.containerEl.classList.toggle("is-collapsed",t)}get floating(){return this._floating}set floating(t){this._floating=t,this.containerEl.classList.toggle("floating",t)}get width(){return this.containerEl.offsetWidth}set width(t){const e=`min(max(${t}px, ${this.minWidthEm}em), 40vw)`;t<this.collapseWidth?(this.collapsed=!0,this.containerEl.style.removeProperty("transition-duration")):(this.collapsed=!1,this.containerEl.style.setProperty("--sidebar-width",e),t>this.minResizeWidth&&(this.containerEl.style.transitionDuration="0s")),ObsidianSite.graphView&&ObsidianSite.graphView.graphRenderer.autoResizeCanvas()}setupSidebarResize(){if(!this.resizeHandleEl)return;const t=localStorage.getItem(`${this.sidebarID}-width`);t&&this.containerEl.style.setProperty("--sidebar-width",t);const e=this;function i(t){if(!e.resizing)return;const i=e.isLeft?t.clientX:window.innerWidth-t.clientX;e.width=i}this.resizeHandleEl.addEventListener("pointerdown",(function(t){e._resizing=!0,e.containerEl.classList.add("is-resizing"),document.addEventListener("pointermove",i),document.addEventListener("pointerup",(function(){document.removeEventListener("pointermove",i);const t=getComputedStyle(e.containerEl).getPropertyValue("--sidebar-width");localStorage.setItem(`${e.sidebarID}-width`,t),e.containerEl.classList.remove("is-resizing"),e.containerEl.style.removeProperty("transition-duration")}))})),this.resizeHandleEl.addEventListener("dblclick",(function(t){e.resetWidth()}))}resetWidth(){this.containerEl.style.removeProperty("transition-duration"),this.containerEl.style.removeProperty("--sidebar-width"),localStorage.removeItem(`${this.sidebarID}-width`),setTimeout((()=>{console.log("Resizing canvas"),ObsidianSite.graphView&&(ObsidianSite.graphView.graphRenderer.autoResizeCanvas(),ObsidianSite.graphView.graphRenderer.centerCamera())}),500)}clickOutsideCollapse(t){if(t.target?.closest(`#${this.containerEl.id}`))return;const e="phone"===ObsidianSite.deviceSize,i="tablet"===ObsidianSite.deviceSize;(e||i)&&(this.collapsed=!0)}},ge=class{constructor(t,e,i=0,n=1){this._path="",this.collapseAnimationLength=150,this._oldAnimationLength=this.collapseAnimationLength,this.root=this instanceof be?this:e?.root??(e instanceof be?e:void 0),this.parent=e,this.minCollapseDepth=n;let s=this instanceof be;this.itemEl=t,this.selfEl=s?t:t.querySelector(".tree-item-self"),this.collapseIconEl=s?t:this.selfEl.querySelector(".collapse-icon"),this.innerEl=s?t:this.selfEl.querySelector(".tree-item-inner"),this.childrenEl=s?t:t.querySelector(".tree-item-children");const o=this.selfEl.getAttribute("href");o&&(this.path=o),this.children=[];if(Array.from(this.childrenEl.children).filter((t=>t.classList.contains("tree-item"))).forEach((t=>{this.children.push(new ge(t,this,i+1,this.minCollapseDepth))})),this._isFolder=this.itemEl.classList.contains("nav-folder"),this._isLink="A"==this.selfEl.tagName,this.depth=i,this._isCollapsible=this.itemEl.classList.contains("mod-collapsible")&&this.depth>=this.minCollapseDepth,this._isCollapsible||(!this.collapseIconEl||this instanceof be||(console.log(this),this.collapseIconEl.remove(),this.collapseIconEl=void 0),this.selfEl.classList.remove("mod-collapsible"),this.itemEl.classList.remove("mod-collapsible"),this.itemEl.classList.remove("is-collapsed")),this.collapsed=this.itemEl.classList.contains("is-collapsed"),this._isCollapsible){(this.isLink?this.collapseIconEl??this.selfEl:this.selfEl).addEventListener("click",(t=>{this.collapsed=!this.collapsed,t.preventDefault(),t.stopPropagation()}))}this._checkAnyChildrenOpen()}get path(){return this._path}set path(t){this.root.pathToItem&&(this.root.pathToItem.delete(this._path),this.root.pathToItem.set(t,this)),this._path=t,this.selfEl.setAttribute("href",t)}get title(){return this.innerEl.innerHTML}set title(t){this.innerEl.innerHTML=t}get isFolder(){return this._isFolder}get isLink(){return this._isLink}get collapsable(){return this._isCollapsible}get collapsed(){return this._collapsed}set collapsed(t){this.collapsable||(t=!1),this.collapsed!=t&&(!t&&this.parent instanceof ge&&this.parent.collapsed&&(this.parent.collapsed=!1),this._collapsed=t,this.itemEl.classList.toggle("is-collapsed",t),this.collapseIconEl?.classList.toggle("is-collapsed",t),t?v(this.childrenEl,this.collapseAnimationLength):w(this.childrenEl,this.collapseAnimationLength),this.parent?._checkAnyChildrenOpen())}get collapsedRecursive(){return this._collapsedRecursive}set collapsedRecursive(t){this.collapsedRecursive!=t&&(this._collapsedRecursive=t,this.children.forEach((e=>{e.collapsed=t,e.collapsedRecursive=t})))}get anyChildrenOpen(){return this._anyChildrenOpen}_checkAnyChildrenOpen(){return this._anyChildrenOpen=this.children.some((t=>!t.collapsed&&t.collapsable)),this._collapsedRecursive=!this._anyChildrenOpen,this._anyChildrenOpen}forAllChildren(t){this.children.forEach((e=>{t(e),e.forAllChildren(t)}))}overrideAnimationLength(t){this._oldAnimationLength=this.collapseAnimationLength,this.collapseAnimationLength=t,this.children.forEach((e=>{e.overrideAnimationLength(t)}))}restoreAnimationLength(){this.collapseAnimationLength=this._oldAnimationLength,this.children.forEach((t=>{t.restoreAnimationLength()}))}setActive(){this.root.activeItem&&this.root.activeItem.selfEl.classList.remove("is-active"),this.root.activeItem=this,this.selfEl.classList.add("is-active")}setFiltered(t){t?this.itemEl.classList.add("filtered-out"):(this.itemEl.classList.remove("filtered-out"),this.parent?.setFiltered(!1))}filter(t){this.overrideAnimationLength(0),this.itemEl.classList.add("filtered"),this.collapsedRecursive=!1,this.forAllChildren((t=>{t.setFiltered(!0)})),t.forEach((t=>{const e=this.findByPath(t);e&&e.setFiltered(!1)}))}async unfilter(){this.itemEl.classList.remove("filtered"),this.forAllChildren((t=>{t.setFiltered(!1)})),this.collapsedRecursive=!0,this.restoreAnimationLength()}setSubHeadings(t){this.removeSubHeadings();for(const[e,i]of t){if(0==i.length)continue;const t=this.findByPath(e);if(!t)continue;t.itemEl.classList.add("has-hints");const n=document.createElement("div");n.classList.add("tree-hint-container"),t.itemEl.appendChild(n),i.forEach((t=>{const i=document.createElement("a");i.classList.add("tree-hint-label"),i.classList.add("internal-link"),i.textContent=t,i.href=e+"#"+t,n.appendChild(i)})),ot.initializeLinks(n)}}removeSubHeadings(){this.itemEl.classList.remove("has-hints"),this.itemEl.querySelectorAll(".tree-hint-container").forEach((t=>{t.remove()})),this.itemEl.querySelectorAll(".has-hints").forEach((t=>{t.classList.remove("has-hints")}))}sort(t){this.itemEl.classList.add("sorted"),this.children.sort(t),this.children.forEach((e=>{e.sort(t)})),this.children.forEach((t=>{this.childrenEl.appendChild(t.itemEl)}))}unsort(){this.itemEl.classList.remove("sorted"),this.sort(((t,e)=>(ObsidianSite.getWebpageData(t.path)?.treeOrder??0)-(ObsidianSite.getWebpageData(e.path)?.treeOrder??0)))}find(t){if(t(this))return this;for(const e of this.children){const i=e.find(t);if(i)return i}}findByPath(t){return this.root.pathToItem.get(t)}},fe=class extends ge{constructor(t,e=1){const i=t.classList.contains("tree-container")?t:t.querySelector(".tree-container");if(null==i)throw new Error("Invalid tree container");super(i,void 0,0,e),this.pathToItem=new Map,this.rootEl=i,this.childrenEl=this.rootEl,this.selfEl=this.rootEl,this.innerEl=this.rootEl,this.collapseAllEl=this.rootEl.querySelector(".tree-collapse-all");const n=this.collapseAllEl?.querySelector("svg");n&&(n.innerHTML="<path d></path><path d></path>",this.collapsePath1=n.querySelector("path"),this.collapsePath2=n.querySelector("path:last-child")),this.forAllChildren((t=>{""!=t.path&&this.pathToItem.set(t.path,t)})),this.collapseAllEl?.addEventListener("click",(()=>{this.setCollapseIcon(!this.collapsedRecursive),this.collapsedRecursive=!this.collapsedRecursive})),ot.initializeLinks(this.rootEl),this.setCollapseIcon(!this.anyChildrenOpen)}_checkAnyChildrenOpen(){const t=super._checkAnyChildrenOpen();return this.setCollapseIcon(!t),t}setCollapseIcon(t){t?(this.collapsePath1?.setAttribute("d",fe.collapsePaths[0]),this.collapsePath2?.setAttribute("d",fe.collapsePaths[1])):(this.collapsePath1?.setAttribute("d",fe.uncollapsePaths[0]),this.collapsePath2?.setAttribute("d",fe.uncollapsePaths[1]))}revealPath(t){const e=this.findByPath(t);e&&(e.collapsed=!1)}},be=fe;be.collapsePaths=["m7 15 5 5 5-5","m7 9 5-5 5 5"],be.uncollapsePaths=["m7 20 5-5 5 5","m7 4 5 5 5-5"];var ye,ve,we,Ee,xe,ke,Se,Ce,Le=class{constructor(){this.nodeCount=0,this.linkCount=0,this.hoveredNode=-1,o(this,Vt,0),o(this,jt,0),o(this,Yt,0),o(this,Ut,0),o(this,Gt,0),this.startPositions=new Float32Array(0),this.linkSources=new Int32Array(0),this.linkTargets=new Int32Array(0),this.radii=new Float32Array(0),this.maxRadius=0,this.averageRadius=0,this.minRadius=0}init(t,e){if(this.free(),this.graphView=t,this.nodeCount=t.nodeCount,this.linkCount=t.linkCount,e?.length!=2*this.nodeCount)throw new Error("Invalid positions array length");this.radii=new Float32Array(t.radii),this.linkSources=new Int32Array(t.linkSources),this.linkTargets=new Int32Array(t.linkTargets),this.maxRadius=this.radii.reduce(((t,e)=>Math.max(t,e))),this.averageRadius=this.radii.reduce(((t,e)=>t+e))/this.radii.length,this.minRadius=this.radii.reduce(((t,e)=>Math.min(t,e))),this.startPositions=new Float32Array(2*this.nodeCount),this.startPositions=this.generatePositions(e),r(this,Vt,Module._malloc(this.startPositions.byteLength)),r(this,jt,this.startPositions.byteLength),r(this,Yt,Module._malloc(this.radii.byteLength)),r(this,Ut,Module._malloc(this.linkSources.byteLength)),r(this,Gt,Module._malloc(this.linkTargets.byteLength)),Module.HEAP32.set(new Int32Array(this.startPositions.buffer),s(this,Vt)/this.startPositions.BYTES_PER_ELEMENT),Module.HEAP32.set(new Int32Array(this.radii.buffer),s(this,Yt)/this.radii.BYTES_PER_ELEMENT),Module.HEAP32.set(new Int32Array(this.linkSources.buffer),s(this,Ut)/this.linkSources.BYTES_PER_ELEMENT),Module.HEAP32.set(new Int32Array(this.linkTargets.buffer),s(this,Gt)/this.linkTargets.BYTES_PER_ELEMENT),Module._Init(s(this,Vt),s(this,Yt),s(this,Ut),s(this,Gt),this.nodeCount,this.linkCount,t.batchFraction,t.ticker.deltaTime,t.options.attractionForce,t.options.linkLength,t.options.repulsionForce,t.options.centralForce)}get positions(){return Module.HEAP32.buffer.slice(s(this,Vt),s(this,Vt)+s(this,jt))}get positionsF(){return new Float32Array(this.positions)}generatePositions(t){let e=new Float32Array(t??new Array(2*this.nodeCount).fill(0));const i=2*this.averageRadius*Math.sqrt(this.nodeCount)*2;for(let t=0;t<this.nodeCount;t++){const n=e[2*t];if(0!=n&&!isNaN(n)&&null!=n)continue;const s=(1-this.radii[t]/this.maxRadius)*i;e[2*t]=Math.cos(t/this.nodeCount*7.41*2*Math.PI)*s,e[2*t+1]=Math.sin(t/this.nodeCount*7.41*2*Math.PI)*s}return e}getBounds(){let t=new g(0,0,0,0);const e=new Float32Array(this.positions);for(let i=0;i<this.nodeCount-1;i+=2){const n=new b(e[i],e[i+1]);t.encapsulatePoint(n.scale(2))}const i=t.center,n=i.magnitude;return t=t.expand(50+n),t.translate(i.inverse),t}update(t,e,i){this.hoveredNode=Module._Update(t.x,t.y,e,i)}free(){Module._free(s(this,Vt)),Module._free(s(this,Yt)),Module._free(s(this,Ut)),Module._free(s(this,Gt)),Module._FreeMemory()}set batchFraction(t){Module._SetBatchFractionSize(t)}set attractionForce(t){Module._SetAttractionForce(t)}set repulsionForce(t){Module._SetRepulsionForce(t)}set centralForce(t){Module._SetCentralForce(t)}set linkLength(t){Module._SetLinkLength(t)}set dt(t){Module._SetDt(t)}set settleness(t){Module._SetSettleness(t)}};Vt=new WeakMap,jt=new WeakMap,Yt=new WeakMap,Ut=new WeakMap,Gt=new WeakMap;var Te=class{constructor(t){o(this,ye),o(this,we),o(this,xe),o(this,Se),this.graph=t,this.canvas=document.querySelector("#graph-canvas"),this.canvasSidebar=this.canvas.closest(".sidebar"),console.log("Creating graph worker");try{this.view=this.canvas.transferControlToOffscreen()}catch(t){console.log("Failed to transfer control to offscreen canvas")}var e=`${ObsidianSite.document.info.pathToRoot}/${N.libFolderName}/${N.scriptsFolderName}/graph-render-worker.js`;if("file:"===window.location.protocol){var i=ObsidianSite.getLocalDataFromId(ot.getFileDataIdFromURL(e));const t=Uint8Array.from(Array.from(i.data).map((t=>t.charCodeAt(0))));this.worker=new Worker(URL.createObjectURL(new Blob([t],{type:"application/javascript"})))}else this.worker=new Worker(new URL(e,window.location.href).pathname);this._cameraOffset=new b(0,0),this._cameraScale=1,this._hoveredNode=-1,this._grabbedNode=-1,this._colors={background:0,link:0,node:0,outline:0,text:0,accent:0},this._width=0,this._height=0,this.cameraOffset=new b(this.canvas.width,this.canvas.height).scale(.5),this.cameraScale=1,this.hoveredNode=-1,this.grabbedNode=-1,this.resampleColors(),a(this,ye,ve).call(this,!0),this.width=this.canvas.width,this.height=this.canvas.height,this.autoResizeCanvas()}get cameraOffset(){return this._cameraOffset}set cameraOffset(t){this._cameraOffset=t,a(this,xe,ke).call(this,t,this.cameraScale)}get cameraScale(){return this._cameraScale}set cameraScale(t){this._cameraScale=t,a(this,xe,ke).call(this,this.cameraOffset,t)}get hoveredNode(){return this._hoveredNode}set hoveredNode(t){this._hoveredNode=t,a(this,we,Ee).call(this,t,this._grabbedNode)}get grabbedNode(){return this._grabbedNode}set grabbedNode(t){this._grabbedNode=t,a(this,we,Ee).call(this,this._hoveredNode,t)}get colors(){return this._colors}set colors(t){this._colors=t,a(this,Se,Ce).call(this,t)}get width(){return this._width}set width(t){this._width=t,this.resizeCanvas(t,this._height)}get height(){return this._height}set height(t){this._height=t,this.resizeCanvas(this._width,t)}set activeNode(t){this.worker.postMessage({type:"set_active",active:t})}updateData(t){this.graph=t,a(this,ye,ve).call(this)}sampleColor(t){const e=document.createElement("div");document.body.appendChild(e),e.style.setProperty("display","none"),e.style.setProperty("color","var("+t+")");const i=getComputedStyle(e).color,n=getComputedStyle(e).opacity;e.remove();const s=function(t){const e=t.match(/rgb?\((\d+),\s*(\d+),\s*(\d+)\)/);return e?{red:parseInt(e[1]),green:parseInt(e[2]),blue:parseInt(e[3]),alpha:1}:null}(i);return{a:parseFloat(n)*(s?.alpha??1),rgb:(s?.red??8912896)<<16|(s?.green??34816)<<8|(s?.blue??136)}}resampleColors(){this.colors={background:this.sampleColor("--background-secondary").rgb,link:this.sampleColor("--graph-line").rgb,node:this.sampleColor("--graph-node").rgb,outline:this.sampleColor("--graph-line").rgb,text:this.sampleColor("--graph-text").rgb,accent:this.sampleColor("--interactive-accent").rgb}}draw(t){this.worker.postMessage({type:"draw",positions:t},[t])}resizeCanvas(t,e){this.worker.postMessage({type:"resize",width:t,height:e}),this._width=t,this._height=e}autoResizeCanvas(){let t=this.canvas.offsetWidth,e=this.canvas.offsetHeight;this.width==t&&this.height==e||(this.centerCamera(),this.resizeCanvas(t,e))}centerCamera(){this.cameraOffset=new b(this.width,this.height).scale(.5)}toScreenSpace(t,e,i=!0){let n=t*this.cameraScale+this.cameraOffset.x,s=e*this.cameraScale+this.cameraOffset.y;return i&&(n=Math.floor(n),s=Math.floor(s)),new b(n,s)}vecToScreenSpace(t,e=!0){return this.toScreenSpace(t.x,t.y,e)}toWorldspace(t,e){const i=(t-this.cameraOffset.x)/this.cameraScale,n=(e-this.cameraOffset.y)/this.cameraScale;return new b(i,n)}vecToWorldspace(t){return this.toWorldspace(t.x,t.y)}setCameraCenterWorldspace(t){this.cameraOffset=new b(this.width/2-t.x*this.cameraScale,this.height/2-t.y*this.cameraScale)}getCameraCenterWorldspace(){return this.toWorldspace(this.width/2,this.height/2)}};ye=new WeakSet,ve=function(t=!1){const{width:e,height:i}=this.view;let n={width:e,height:i,view:this.view},s=[this.view];t||(n={width:e,height:i},s=[]),this.worker.postMessage({type:"init",linkCount:this.graph.graphSim.linkCount,linkSources:this.graph.graphSim.linkSources,linkTargets:this.graph.graphSim.linkTargets,nodeCount:this.graph.graphSim.nodeCount,radii:this.graph.graphSim.radii,labels:this.graph.labels,linkLength:this.graph.options.linkLength,edgePruning:this.graph.options.edgePruning,options:n},s)},we=new WeakSet,Ee=function(t,e){const i={type:"update_interaction",hoveredNode:t,grabbedNode:e};this.worker.postMessage(i)},xe=new WeakSet,ke=function(t,e){this.worker.postMessage({type:"update_camera",cameraOffset:t,cameraScale:e})},Se=new WeakSet,Ce=function(t){this.worker.postMessage({type:"update_colors",colors:t})};var _e=class extends dt{constructor(t){super(ObsidianSite.metadata.featureOptions.graphView,t),this.batchFraction=1,this.graphExpanded=!1,this._paused=!1,this._isGlobalGraph=!1,this.eventsInitialized=!1,this.updateRunning=!1,this.mouseWorldPos=new b(0,0),this.scrollVelocity=0,this.firstUpdate=!0,this.drawLastTime=0,this.graphSim=new Le,this.graphContainer=document.querySelector(".graph-view-container"),this.globalGraphButton=document.querySelector(".graph-global.graph-icon"),this.expandGraphButton=document.querySelector(".graph-expand.graph-icon"),this.ticker=new y(60),this.ticker.add(this.update.bind(this)),this.ticker.start(),requestAnimationFrame(this.draw.bind(this))}set options(t){this._options=t,this.graphSim&&(this.graphSim.attractionForce=t.attractionForce,this.graphSim.centralForce=t.centralForce,this.graphSim.linkLength=t.linkLength,this.graphSim.repulsionForce=t.repulsionForce/this.batchFraction)}get options(){return this._options}set attractionForce(t){t!=this.options.attractionForce&&(this.options.attractionForce=t,this.graphSim&&(this.graphSim.attractionForce=t,this.graphSim.settleness=1))}get attractionForce(){return this.options.attractionForce}set centralForce(t){t!=this.options.centralForce&&(this.options.centralForce=t,this.graphSim&&(this.graphSim.centralForce=t,this.graphSim.settleness=1))}get centralForce(){return this.options.centralForce}set linkLength(t){t!=this.options.linkLength&&(this.options.linkLength=t,this.graphSim&&(this.graphSim.linkLength=t,this.graphSim.settleness=1))}get linkLength(){return this.options.linkLength}set repulsionForce(t){t!=this.options.repulsionForce&&(this.options.repulsionForce=t,this.graphSim&&(this.graphSim.repulsionForce=t/this.batchFraction,this.graphSim.settleness=1))}get repulsionForce(){return this.options.repulsionForce}get paused(){return this._paused}set paused(t){this._paused=t}get isGlobalGraph(){return this._isGlobalGraph}set isGlobalGraph(t){this._isGlobalGraph=t}initEvents(){const t=this;function e(e){const i=t.graphRenderer.canvas.getBoundingClientRect(),n=function(t){return new b(t.clientX,t.clientY)}(e);return new b(n.x-i.left,n.y-i.top)}function i(e){const i=t.graphRenderer.canvas.getBoundingClientRect(),n=function(t){const e=Array.from(t.touches),i=e.reduce(((t,e)=>t+e.clientX),0)/e.length,n=e.reduce(((t,e)=>t+e.clientY),0)/e.length;return new b(i,n)}(e);return new b(n.x-i.left,n.y-i.top)}let n=new b(0,0),s=new b(0,0),o=new b(0,0),r=new b(0,0),a=0,l=!1,c=!1,h=new b(0,0),d=-1,u=!1;const p=this.graphContainer,m=this.graphRenderer;this.graphRenderer.canvas.addEventListener("pointerenter",(function(g){let f=0,y=!1;function v(i){n=e(i),t.mouseWorldPos=m.vecToWorldspace(n),o=new b(n.x-s.x,n.y-s.y),s=n,-1!=m.grabbedNode&&(r=new b(n.x-h.x,n.y-h.y)),l&&-1!=m.hoveredNode&&-1==m.grabbedNode&&m.hoveredNode!=m.grabbedNode&&(m.grabbedNode=m.hoveredNode),l&&-1==m.hoveredNode&&-1==m.grabbedNode||c?m.cameraOffset=new b(m.cameraOffset.x+o.x,m.cameraOffset.y+o.y):-1!=m.hoveredNode?m.canvas.style.cursor="pointer":m.canvas.style.cursor="default"}function w(e){if(1==e.touches?.length)return y&&(s=i(e),y=!1),void v(e);if(2==e.touches?.length){const r=E(e.touches[0]),a=E(e.touches[1]);n=i(e),o=new b(n.x-s.x,n.y-s.y),s=n;const l=Math.sqrt(Math.pow(r.x-a.x,2)+Math.pow(r.y-a.y,2));y||(y=!0,f=l,o=new b(0,0),t.mouseWorldPos=b.Undefined,m.grabbedNode=-1,m.hoveredNode=-1);const c=(l-f)/f;t.scaleAround(m.vecToWorldspace(n),1+c,.15,15),m.cameraOffset=new b(m.cameraOffset.x+o.x,m.cameraOffset.y+o.y),f=l}}function x(e){document.removeEventListener("pointerup",x);const i=Date.now();setTimeout((()=>{l&&-1!=m.hoveredNode&&Math.abs(r.x)<=4&&Math.abs(r.y)<=4&&i-a<300&&t.navigateToNode(m.hoveredNode),l&&-1!=m.grabbedNode&&(m.grabbedNode=-1),0==e.button&&(l=!1),"touch"==e.pointerType&&d==e.pointerId&&(d=-1,l=!1),1==e.button&&(c=!1),u||(document.removeEventListener("mousemove",v),document.removeEventListener("touchmove",w))}),0)}function k(e){document.addEventListener("pointerup",x),t.mouseWorldPos=m.vecToWorldspace(n),r=new b(0,0),0==e.button&&(l=!0),"touch"==e.pointerType&&-1==d&&(d=e.pointerId,l=!0),1==e.button&&(c=!0),h=n,a=Date.now()}n=e(g),t.mouseWorldPos=m.vecToWorldspace(n),s=e(g),u=!0,document.addEventListener("mousemove",v),document.addEventListener("touchmove",w),p.addEventListener("pointerdown",k),p.addEventListener("pointerleave",(function e(i){setTimeout((()=>{u=!1,l||(document.removeEventListener("mousemove",v),document.removeEventListener("touchmove",w),t.mouseWorldPos=b.Undefined),p.removeEventListener("pointerdown",k),p.removeEventListener("pointerleave",e)}),1)}))})),this.expandGraphButton?.addEventListener("click",(e=>{e.stopPropagation(),t.toggleExpandedGraph()})),this.globalGraphButton?.addEventListener("click",(e=>{e.stopPropagation(),t.isGlobalGraph?t.showGraph([ObsidianSite.document.pathname]):t.showGraph()})),p.addEventListener("wheel",(function(e){const i=.065;e.deltaY>0?(t.scrollVelocity>=-.065&&(t.scrollVelocity=-.065),t.scrollVelocity*=1.16):(t.scrollVelocity<=i&&(t.scrollVelocity=i),t.scrollVelocity*=1.16)})),p.addEventListener("dblclick",(function(e){t.fitToNodes()})),document.querySelector(".theme-toggle-input")?.addEventListener("change",(t=>{setTimeout((()=>m.resampleColors()),0)}))}async generate(t){this.paths=t,this.nodeCount=this.paths.length,this.linkSources=[],this.linkTargets=[],this.labels=[],this.radii=[],this.colors=[];const e=[];for(let t=0;t<this.nodeCount;t++)e.push(0);let i=0;for(const t of this.paths){const n=ObsidianSite.getWebpageData(t);if(!n)continue;this.labels.push(n.title);const s=n.links.map((t=>ot.getPathnameFromURL(t))).concat(n.attachments).concat(n.backlinks);let o=[...new Set(s)];o.push(t);for(const t of o){const n=this.paths.indexOf(t);-1!=n&&(this.linkSources.push(n),this.linkTargets.push(i),e[i]++,e[n]++)}i++}const n=Math.max(...e);this.radii=e.map((t=>x(this.options.minNodeRadius,this.options.maxNodeRadius,Math.min(t/(.8*n),1)))),this.linkCount=this.linkSources.length}async showGraph(t){this.paused=!0;let e=[];if(t){for(const i of t){const t=ObsidianSite.getWebpageData(i);t?.backlinks&&e.push(...t.backlinks),t?.links&&e.push(...t.links.map((t=>ot.getPathnameFromURL(t)))),t?.attachments&&e.push(...t.attachments)}e.push(...t)}else e=ObsidianSite.metadata.allFiles;if(e.length==ObsidianSite.metadata.allFiles.length?this.isGlobalGraph=!0:this.isGlobalGraph=!1,e=e.filter((t=>{let e=ObsidianSite.getWebpageData(t);if(!e||!e.type)return!1;const i=e.backlinks||[],n=e.links||[];return!(!this.options.showOrphanNodes&&0==i.length&&0==n.length)&&!!(this.options.showAttachments||"attachment"!=e.type&&"media"!=e.type&&"other"!=e.type)})),0==e.length)return void console.log("No nodes to display.");const i=[...new Set(e)],n=new Array(2*i.length).fill(0);if(this.paths?.length>0){const t=this.graphSim.positionsF;for(let e=0;e<i.length;e++){const s=i[e],o=this.paths.indexOf(s);-1!=o&&(n[2*e]=t[2*o],n[2*e+1]=t[2*o+1])}}await this.generate(i),this.graphSim.init(this,n),this.graphRenderer?this.graphRenderer.updateData(this):this.graphRenderer=new Te(this),this.fitToNodes(),this.eventsInitialized||(this.initEvents(),this.eventsInitialized=!0),this.paused=!1;this.globalGraphButton.innerHTML=this.isGlobalGraph?'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-circle-dot"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="1"/></svg>':'<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="svg-icon lucide-git-fork"><circle cx="12" cy="18" r="3"/><circle cx="6" cy="6" r="3"/><circle cx="18" cy="6" r="3"/><path d="M18 9v2c0 .6-.4 1-1 1H7c-.6 0-1-.4-1-1V9"/><path d="M12 12v3"/></svg>',this.setActiveNodeByPath(ObsidianSite.document.pathname)}fitToNodes(){this.graphRenderer.centerCamera(),this.graphRenderer.cameraScale=1/Math.sqrt(this.nodeCount)*this.graphRenderer.canvas.width/200,this.graphSim.settleness=1}update(t){!this.paused&&this.graphRenderer&&this.graphSim&&(this.firstUpdate&&(setTimeout((()=>this.graphRenderer?.canvas?.classList.remove("hide")),500),this.firstUpdate=!1),this.graphSim.dt=t,this.graphSim.update(this.mouseWorldPos,this.graphRenderer.grabbedNode,this.graphRenderer.cameraScale),this.graphSim.hoveredNode!=this.graphRenderer.hoveredNode&&(this.graphRenderer.hoveredNode=this.graphSim.hoveredNode,this.graphRenderer.canvas.style.cursor=-1==this.graphSim.hoveredNode?"default":"pointer"))}async draw(t){if(!this.graphRenderer||!this.graphSim||0==this.paths.length)return;const e=(t-this.drawLastTime)/1e3;this.drawLastTime=t,this.graphRenderer.draw(this.graphSim.positions),0!=this.scrollVelocity&&(Math.abs(this.scrollVelocity)<.001&&(this.scrollVelocity=0),this.zoomAround(this.mouseWorldPos,this.scrollVelocity),this.scrollVelocity*=1-15*e),requestAnimationFrame(this.draw.bind(this))}zoomAround(t,e,i=.15,n=15){const s=this.graphRenderer.getCameraCenterWorldspace();if(this.graphRenderer.cameraScale=Math.max(Math.min(this.graphRenderer.cameraScale+e*this.graphRenderer.cameraScale,n),i),this.graphRenderer.cameraScale!=i&&this.graphRenderer.cameraScale!=n&&this.scrollVelocity>0&&!this.mouseWorldPos.isUndefined){const i=new b(t.x-s.x,t.y-s.y),n=new b(s.x+i.x*e,s.y+i.y*e);this.graphRenderer.setCameraCenterWorldspace(n)}else this.graphRenderer.setCameraCenterWorldspace(s)}scaleAround(t,e,i=.15,n=15){const s=this.graphRenderer.getCameraCenterWorldspace(),o=this.graphRenderer.cameraScale;this.graphRenderer.cameraScale=Math.max(Math.min(e*this.graphRenderer.cameraScale,n),i);const r=(o-this.graphRenderer.cameraScale)/o;if(this.graphRenderer.cameraScale!=i&&this.graphRenderer.cameraScale!=n&&0!=e){const e=new b(t.x-s.x,t.y-s.y),i=new b(s.x-e.x*r,s.y-e.y*r);this.graphRenderer.setCameraCenterWorldspace(i)}else this.graphRenderer.setCameraCenterWorldspace(s)}async navigateToNode(t){if(t<0||t>=this.nodeCount)return;this.graphExpanded&&this.toggleExpandedGraph();const e=this.paths[t];await ObsidianSite.loadURL(e)}toggleExpandedGraph(){const t=this.graphContainer.clientWidth,e=this.graphContainer.clientHeight;this.graphContainer.classList.add("scale-down");const i=this.graphContainer.animate({opacity:0},{duration:100,easing:"ease-in",fill:"forwards"}),n=this;function s(t){n.graphExpanded&&(t.composedPath().includes(n.graphContainer)?document.addEventListener("pointerdown",s,{once:!0}):n.toggleExpandedGraph())}i.addEventListener("finish",(function(){n.graphContainer.classList.toggle("expanded"),n.graphRenderer.autoResizeCanvas(),n.graphRenderer.centerCamera();const i=n.graphContainer.clientWidth,s=n.graphContainer.clientHeight;n.graphRenderer.cameraScale*=(i/t+s/e)/2,n.graphContainer.classList.remove("scale-down"),n.graphContainer.classList.add("scale-up");n.graphContainer.animate({opacity:1},{duration:200,easing:"ease-out",fill:"forwards"}).addEventListener("finish",(function(){n.graphContainer.classList.remove("scale-up")}))})),this.graphExpanded=!this.graphExpanded,this.graphExpanded?document.addEventListener("pointerdown",s,{once:!0}):document.removeEventListener("pointerdown",s),this.graphRenderer.autoResizeCanvas()}getNodeByPath(t){return this.paths.indexOf(t)}setActiveNode(t){t<0||t>=this.nodeCount||(this.graphRenderer.activeNode=t)}setActiveNodeByPath(t){this.setActiveNode(this.getNodeByPath(t))}},Ie=class{constructor(){this.themeToggle=document.querySelector(".theme-toggle-input"),this.themeToggle?.addEventListener("change",(t=>{this.switchTheme()}))}switchTheme(){let t="light"==localStorage.getItem("theme")?"dark":"light";this.setTheme(t,!1)}setTheme(t,e=!1){let i="light"==t;this.themeToggle.checked=i;let n="";e&&(n=document.body.style.transition,document.body.style.transition="none"),!this.themeToggle.classList.contains("is-checked")&&i?this.themeToggle.classList.add("is-checked"):this.themeToggle.classList.contains("is-checked")&&!i&&this.themeToggle.classList.remove("is-checked"),i?(document.body.classList.contains("theme-dark")&&document.body.classList.remove("theme-dark"),document.body.classList.contains("theme-light")||document.body.classList.add("theme-light")):(document.body.classList.contains("theme-light")&&document.body.classList.remove("theme-light"),document.body.classList.contains("theme-dark")||document.body.classList.add("theme-dark")),e&&setTimeout((function(){document.body.style.transition=n}),100),localStorage.setItem("theme",i?"light":"dark")}},Pe=class{get url(){return this._url}constructor(t,e){this.targetData=ObsidianSite.getWebpageData(e),this.targetData?(this._url=e,this.backlinkEl=document.createElement("a"),this.backlinkEl.href=e,this.backlinkEl.classList.add("backlink"),t.appendChild(this.backlinkEl),this.backlinkIconEl=document.createElement("div"),this.backlinkIconEl.classList.add("backlink-icon"),this.backlinkIconEl.innerHTML=this.targetData.icon,this.backlinkEl.appendChild(this.backlinkIconEl),this.backlinkTitleEl=document.createElement("div"),this.backlinkTitleEl.classList.add("backlink-title"),this.backlinkTitleEl.innerText=this.targetData.title,this.backlinkEl.appendChild(this.backlinkTitleEl),this.backlinkEl.addEventListener("click",(t=>{t.preventDefault(),ObsidianSite.loadURL(this.url)}))):console.error("Failed to find target for backlink",e)}},Oe=class extends ut{constructor(t){super(ObsidianSite.metadata.featureOptions.backlinks,{backlinkPaths:t})}generateContent(t){const e=this.getDependencies();if(0===e.backlinkPaths.length){const e=document.createElement("div");e.className="backlinks-empty-message";const i=ObsidianSite.metadata?.featureOptions?.backlinks?.noBacklinks||"No backlinks for this article";return e.textContent=i,t.appendChild(e),void(this.backlinks=[])}this.backlinks=e.backlinkPaths.map((e=>new Pe(t,e)))}},Fe=class extends ut{constructor(t){super(ObsidianSite.metadata.featureOptions.tags,{tags:t})}generateContent(t){const e=this.getDependencies();for(const i of e.tags){const e=document.createElement("a");e.classList.add("tag"),e.setAttribute("href",`?query=tags:${i.replace("#","")}`),e.innerText=i,t.appendChild(e)}ot.initializeLinks(t)}},Ne=class extends ut{constructor(t){super(ObsidianSite.metadata.featureOptions.alias,{aliases:t})}generateContent(t){const e=this.getDependencies();for(const i of e.aliases){const e=document.createElement("span");e.classList.add("alias"),e.innerText=i,t.appendChild(e)}return t}},Me=class extends ut{constructor(){super(ObsidianSite.metadata.featureOptions.copyright,{})}getElementDefinitions(){return{[dt.FEATURE_KEY]:{type:"div",className:["feature","hide"],id:this.options.featureId},[dt.CONTENT_KEY]:{type:"div",className:`${this.options.featureId}-content`}}}getElementHierarchy(){return{[dt.FEATURE_KEY]:null,[dt.CONTENT_KEY]:dt.FEATURE_KEY}}generateContent(t){let e=this.options.copyrightText||"© {year} {author}. All rights reserved.";const i=(new Date).getFullYear().toString();e=e.replace(/{year}/g,i);const n=this.options.author||ObsidianSite.metadata.siteName||"Author",s=document.createElement("div");s.id="copyright";const o=e.split(/{author}/);1===o.length?this.appendTextWithLineBreaks(s,e):o.forEach(((t,e)=>{if(t&&this.appendTextWithLineBreaks(s,t),e<o.length-1)if(this.options.authorUrl&&this.options.authorUrl.trim()){const t=document.createElement("a");t.href=this.options.authorUrl,t.textContent=n,t.style.color="inherit",t.style.textDecoration="underline",t.style.textDecorationColor="var(--text-muted)",t.target="_blank",t.rel="noopener noreferrer",s.appendChild(t)}else s.appendChild(document.createTextNode(n))})),t.appendChild(s)}appendTextWithLineBreaks(t,e){const i=e.split("\n");i.forEach(((e,n)=>{e&&t.appendChild(document.createTextNode(e)),n<i.length-1&&t.appendChild(document.createElement("br"))}))}},ze=class extends ut{constructor(){super(ObsidianSite.metadata.featureOptions.footerLinks,{}),this.themeChangeListener=null}getElementDefinitions(){return{[dt.FEATURE_KEY]:{type:"div",className:["feature","hide"],id:this.options.featureId},[dt.CONTENT_KEY]:{type:"div",className:`${this.options.featureId}-content`}}}getElementHierarchy(){return{[dt.FEATURE_KEY]:null,[dt.CONTENT_KEY]:dt.FEATURE_KEY}}generateContent(t){const e=this.options.links||[];if(0===e.length)return;const i=document.createElement("div");i.id="footer-links",i.classList.add("copy-link");const n=document.body.classList.contains("theme-dark")||document.body.classList.contains("obsidian-appearance-dark")||!document.body.classList.contains("theme-light")&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?this.options.linkColorDark||"#3ac4df":this.options.linkColorLight||"#0c6fff";e.forEach(((t,s)=>{if(t.text&&t.url){const o=document.createElement("a");if(o.href=t.url,o.textContent=t.text,o.style.color=n,o.style.textDecoration="none",o.target="_blank",o.rel="noopener noreferrer",o.addEventListener("mouseenter",(()=>{o.style.opacity="0.8"})),o.addEventListener("mouseleave",(()=>{o.style.opacity="1"})),i.appendChild(o),s<e.length-1){const t=document.createTextNode(" | ");i.appendChild(t)}}})),t.appendChild(i)}updateLinkColors(){const t=document.getElementById("footer-links");if(!t)return;const e=document.body.classList.contains("theme-dark")?this.options.linkColorDark||"#3ac4df":this.options.linkColorLight||"#0c6fff";t.querySelectorAll("a").forEach((t=>{t.style.color=e}))}setupThemeSync(){if(this.themeChangeListener)return;this.themeChangeListener=()=>{this.updateLinkColors()};const t=document.querySelector(".theme-toggle-input");t&&t.addEventListener("change",this.themeChangeListener)}onAfterMount(){super.onAfterMount();const t=document.querySelector(".footer .data-bar");if(t){const e=this.getElement(dt.FEATURE_KEY),i=document.querySelector("#copyright")?.closest(".feature");e&&e.parentElement===t&&i&&i.parentElement===t&&t.insertBefore(e,i)}this.setupThemeSync(),this.updateLinkColors()}},Ae=class{constructor(){this.rafPending=!1,this.pendingOutlineScrollFrame=null,this.headings=[],this.TOP_OFFSET_PX=50,this.scrollContainer=null,this.indicatorEl=null,this.currentPathname="",this.onScroll=()=>this.requestSync(),this.onResize=()=>this.requestSync(),this.refreshScrollContainer(),this.injectStyles(),this.createIndicator()}refreshScrollContainer(){const t=window.ObsidianSite,e=document.querySelector(".obsidian-document.markdown-preview-view")||t?.centerContentEl;e&&e!==this.scrollContainer&&(this.scrollContainer&&this.scrollContainer.removeEventListener("scroll",this.onScroll),this.scrollContainer=e,this.scrollContainer.addEventListener("scroll",this.onScroll,{passive:!0}),window.removeEventListener("resize",this.onResize),window.addEventListener("resize",this.onResize),console.log("TOC ScrollSpy: Scroll container updated",this.scrollContainer))}updateHeadings(){const t=window.ObsidianSite.document;this.refreshScrollContainer(),t?(this.currentPathname=t.pathname||"",setTimeout((()=>{document.querySelectorAll("#outline .tree-item-self").forEach((t=>{const e=t.querySelector(":scope > .collapse-icon"),i=t.querySelector(".tree-item-inner");e&&i&&i.prepend(e)}));const e=t.getFlatHeaders();this.headings=e.map((t=>({id:t.id,element:t.headerElement}))).filter((t=>t.id)),this.createIndicator(),this.requestSync()}),500)):this.headings=[]}createIndicator(){const t=document.querySelector("#outline");t&&(t.querySelector(".outline-indicator")?.remove(),this.indicatorEl=document.createElement("div"),this.indicatorEl.className="outline-indicator",t.appendChild(this.indicatorEl))}requestSync(){this.rafPending||(this.rafPending=!0,requestAnimationFrame((()=>{this.rafPending=!1,this.sync()})))}sync(){if(0===this.headings.length||!this.scrollContainer)return;const t=window.ObsidianSite.outlineTree;if(!t||!t.rootEl)return;const e=t.rootEl;let i=null;const n=this.scrollContainer.getBoundingClientRect().top;if(this.scrollContainer.scrollTop<50)i=this.headings[0].id;else for(const t of this.headings){if(!(t.element.getBoundingClientRect().top-n<=this.TOP_OFFSET_PX))break;i=t.id}if(!i)return this.indicatorEl&&(this.indicatorEl.style.display="none"),void(t.activeItem&&(t.activeItem.selfEl.classList.remove("is-active"),t.activeItem=void 0,this.syncExpansion(t,void 0)));const s=["#"+i,this.currentPathname+"#"+i,"#"+encodeURIComponent(i),this.currentPathname+"#"+encodeURIComponent(i),"#"+decodeURIComponent(i),this.currentPathname+"#"+decodeURIComponent(i)];let o=null;for(const e of s)if(o=t.findByPath(e),o)break;if(!o)return;const r=o!==t.activeItem;r&&o.setActive(),this.syncExpansion(t,o);const a=o.itemEl;if(this.indicatorEl&&a){const t=o.selfEl,i=e.getBoundingClientRect(),n=t.getBoundingClientRect();this.indicatorEl.style.display="block",this.indicatorEl.style.top=`${n.top-i.top+e.scrollTop}px`,this.indicatorEl.style.height=`${n.height}px`}if(a){const t=e.getBoundingClientRect(),i=a.getBoundingClientRect(),n=i.top-t.top+e.scrollTop-.3*t.height,s=Math.max(0,n),o=.2*t.height,l=i.top<t.top+o||i.bottom>t.bottom-o;if(r||l){const t=e.scrollTop;Math.abs(t-s)>10&&this.scheduleOutlineScroll(e,s,r)}}}scheduleOutlineScroll(t,e,i){null!==this.pendingOutlineScrollFrame&&cancelAnimationFrame(this.pendingOutlineScrollFrame),this.pendingOutlineScrollFrame=requestAnimationFrame((()=>{const n=t.scrollTop,s=Math.abs(e-n),o=i&&s>500?"auto":"smooth";t.scrollTo({top:e,behavior:o}),this.pendingOutlineScrollFrame=null}))}syncExpansion(t,e){const i=window.ObsidianSite.metadata.featureOptions.outline.autoCollapseDepth;if(i>=100)return;const n=new Set;let s=e;for(;s;)n.add(s),s=s.parent;t.overrideAnimationLength(0),t.forAllChildren((t=>{n.has(t)?t.collapsable&&(t.collapsed=!1):t.collapsable&&t.depth>=i&&(t.collapsed=!0)})),t.restoreAnimationLength()}injectStyles(){if(document.getElementById("toc-scrollspy-styles"))return;const t=document.createElement("style");t.id="toc-scrollspy-styles",t.textContent='\n            #outline {\n                position: relative;\n            }\n\n            #outline .tree-item-self {\n                position: relative;\n                transition: color 0.1s ease, font-weight 0.1s ease;\n                border-radius: 4px;\n                display: flex !important;\n                align-items: center;\n                padding-left: 8px !important;\n            }\n\n            #outline .tree-item-inner {\n                display: flex !important;\n                align-items: flex-start;\n                gap: 4px; \n                white-space: normal;\n                word-break: break-word;\n                padding-right: 4px;\n                flex: 1;\n                line-height: 1.4;\n                padding-top: 2px;\n                padding-bottom: 2px;\n                font-size: 13px; /* Reduced overall size */\n                transition: font-size 0.15s ease-out;\n            }\n\n            #outline .collapse-icon {\n                display: flex !important;\n                align-items: center;\n                justify-content: center;\n                z-index: 2;\n                width: 20px !important;\n                height: 24px;\n                flex-shrink: 0;\n                margin-top: -2px;\n            }\n\n            #outline .tree-item-self.is-active {\n                color: var(--text-normal);\n                background-color: transparent !important; /* No background highlight */\n            }\n\n            #outline .tree-item-self.is-active .tree-item-inner {\n                font-size: 14.5px; /* Increase font size when active */\n                font-weight: 600;\n            }\n\n            .outline-indicator {\n                position: absolute;\n                left: 2px; /* Position to the left of level 1 hierarchy */\n                width: 3px;\n                background-color: var(--interactive-accent);\n                transition: top 0.2s cubic-bezier(0.4, 0, 0.2, 1), height 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n                z-index: 10;\n                pointer-events: none;\n                border-radius: 4px;\n                display: none;\n            }\n\n            /* Hide collapse icon for top-level TOC items (depth 0) */\n            #outline .tree-item[data-depth="0"] > .tree-item-self .collapse-icon,\n            #outline .tree-item[data-depth="1"] > .tree-item-self .collapse-icon {\n                display: none !important;\n            }\n        ',document.head.appendChild(t)}},Re=class{constructor(){this.init()}init(){Re.initialized||(this.replaceFileIcons(),document.addEventListener("click",this.handleFileDownloadClick.bind(this),!0),Re.initialized=!0)}replaceFileIcons(){const t=document.querySelectorAll(".file-embed-icon svg");t.forEach((t=>{const e=t.closest(".file-embed-title"),i=e?.parentElement,n=i?.querySelector(".internal-embed.file-embed");if(t.outerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 1024 1024" fill="currentColor"><path d="M656 240V16H144v992h736V240z" fill="currentColor"></path><path d="M656 16v224h224z" fill="currentColor"></path><path d="M544 608V400h-64v208h-80l112 112 112-112z" fill="currentColor"></path><path d="M895.904 239.824a15.536 15.536 0 0 0-4.464-10.48L666.656 4.56a15.376 15.376 0 0 0-10.336-4.432L656 0H160a32 32 0 0 0-32 32v960a32 32 0 0 0 32 32h704a32 32 0 0 0 32-32V240.432 240l-0.096-0.176zM672 54.096L841.904 224H672V54.096zM864 992H160V32h480v224h224v736zM387.28 617.216c0.528 0.768 0.864 1.648 1.536 2.32l111.664 111.696c0.048 0.048 0.048 0.112 0.096 0.16 3.04 3.04 7.024 4.528 11.024 4.608 0.144 0 0.272 0.08 0.4 0.08s0.272-0.08 0.4-0.08a15.92 15.92 0 0 0 11.024-4.608c0.048-0.048 0.048-0.112 0.096-0.16l111.664-111.696c0.672-0.672 0.992-1.552 1.536-2.32 0.72-0.992 1.552-1.888 2.032-3.024 0.816-1.984 1.232-4.064 1.248-6.176V608c0-0.256-0.128-0.448-0.144-0.704a16.384 16.384 0 0 0-1.104-5.52c-0.064-0.128-0.176-0.208-0.224-0.336a16.048 16.048 0 0 0-3.216-4.88 15.888 15.888 0 0 0-12-4.576H560V400a16 16 0 0 0-16-16h-64a16 16 0 0 0-16 16v192h-63.312a15.888 15.888 0 0 0-12 4.576 15.856 15.856 0 0 0-3.216 4.88c-0.048 0.128-0.16 0.208-0.224 0.336a16.32 16.32 0 0 0-1.104 5.52c-0.016 0.24-0.144 0.432-0.144 0.688v0.016c0.016 2.112 0.432 4.192 1.248 6.176 0.48 1.136 1.312 2.048 2.032 3.024zM480 624a16 16 0 0 0 16-16V416h32v192a16 16 0 0 0 16 16h41.072L512 697.12 438.928 624H480zM288 816a16 16 0 0 0 16 16h416a16 16 0 1 0 0-32H304a16 16 0 0 0-16 16z" fill="currentColor"></path></svg>',n&&e){const t=n.getAttribute("data-file-size");if(t&&!e.querySelector(".file-embed-size")){const i=document.createElement("span");i.className="file-embed-size",i.style.opacity="0.5",i.style.fontSize="0.85em",i.style.marginLeft="6px",i.textContent=`(${this.formatBytes(parseInt(t))})`,e.appendChild(i)}}}))}formatBytes(t,e=2){if(0===t)return"0 B";const i=e<0?0:e,n=Math.floor(Math.log(t)/Math.log(1024));return parseFloat((t/Math.pow(1024,n)).toFixed(i))+" "+["B","KB","MB","GB","TB"][n]}handleFileDownloadClick(t){const e=t.target.closest(".file-embed-title");if(e){t.preventDefault(),t.stopPropagation();const i=Date.now();if(i-Re.lastDownloadTime<Re.downloadThrottleDelay)return;Re.lastDownloadTime=i;const n=e.parentElement,s=n?.querySelector(".internal-embed.file-embed");if(s){const t=s.getAttribute("src");if(t){const e=window.location.origin+"/"+t;this.downloadFile(e,t)}}}}downloadFile(t,e){const i=document.createElement("a");i.href=t,i.download=e,i.style.display="none",document.body.appendChild(i),i.click(),document.body.removeChild(i)}},De=Re;De.initialized=!1,De.lastDownloadTime=0,De.downloadThrottleDelay=1e3;var Be=class{constructor(){this.index=null,this.modal=null,this.overlay=null,this.searchInput=null,this.resultsContainer=null,this.toggleBtn=null,this.selectedIndex=0,this.currentResults=[],this.showDetailedView=!1,this.searchTimeout=null,this.handleKeyDown=this.handleKeyDown.bind(this),this.handleInputChange=this.handleInputChange.bind(this)}async init(){Be.injectStyles();const t=await ObsidianSite.fetch(N.libFolderName+"/"+N.searchIndexFileName);if(!t?.ok)return;const e=await t.json();try{this.index=$t.loadJS(e,{fields:["title","path","tags","headers","aliases","content"]})}catch(t){return void console.error("ModalSearch: Failed to load index",t)}return this.createModal(),this.setupKeyboardShortcuts(),this.bindSearchButtons(),this}bindSearchButtons(){document.querySelectorAll(".search-icon, #search-icon, #search-input-container .search-icon").forEach((t=>{t.addEventListener("click",(t=>{t.preventDefault(),t.stopPropagation(),this.open()}))}))}static injectStyles(){if(document.getElementById("modal-search-styles"))return;const t=document.createElement("style");t.id="modal-search-styles",t.textContent="\n\t\t\t.search-modal-overlay {\n\t\t\t\tposition: fixed; top: 0; left: 0; right: 0; bottom: 0;\n\t\t\t\tbackground-color: rgba(0, 0, 0, 0.5); backdrop-filter: blur(4px);\n\t\t\t\tz-index: 10000; display: none; align-items: flex-start;\n\t\t\t\tjustify-content: center; padding-top: 10vh; animation: modalSearchFadeIn 0.15s ease-out;\n\t\t\t}\n\t\t\t.search-modal-overlay.active { display: flex; }\n\t\t\t@keyframes modalSearchFadeIn { from { opacity: 0; } to { opacity: 1; } }\n\t\t\t.search-modal {\n\t\t\t\twidth: 90%; max-width: 800px; background: var(--background-primary);\n\t\t\t\tborder-radius: 12px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25);\n\t\t\t\tdisplay: flex; flex-direction: column; max-height: 75vh;\n\t\t\t\topacity: 0; transform: scale(0.95) translateY(-20px); transition: all 0.15s ease-out;\n\t\t\t\toverflow: hidden; border: 1px solid var(--background-modifier-border);\n\t\t\t}\n\t\t\t.search-modal.active { opacity: 1; transform: scale(1) translateY(0); }\n\t\t\t.search-modal-header {\n\t\t\t\tdisplay: flex; align-items: center; gap: 12px; padding: 14px 20px;\n\t\t\t\tborder-bottom: 1px solid var(--background-modifier-border);\n\t\t\t}\n\t\t\t.search-modal-input {\n\t\t\t\tflex: 1; border: none; outline: none; background: transparent;\n\t\t\t\tfont-size: 18px; color: var(--text-normal); font-family: inherit;\n\t\t\t}\n\t\t\t.search-modal-icon { color: var(--text-muted); display: flex; align-items: center; }\n\t\t\t.search-modal-actions { display: flex; gap: 4px; }\n\t\t\t.search-modal-btn {\n\t\t\t\tpadding: 6px; border: none; background: transparent; border-radius: 6px;\n\t\t\t\tcursor: pointer; color: var(--text-muted); transition: all 0.15s ease;\n\t\t\t\tdisplay: flex; align-items: center; justify-content: center;\n\t\t\t}\n\t\t\t.search-modal-btn:hover { background: var(--background-modifier-hover); color: var(--text-normal); }\n\t\t\t.search-modal-btn.active { background: var(--interactive-accent); color: white; }\n\t\t\t.search-modal-results { flex: 1; overflow-y: auto; padding: 8px 0; min-height: 150px; }\n\t\t\t.search-modal-result-item {\n\t\t\t\tdisplay: flex; gap: 12px; padding: 10px 20px; cursor: pointer;\n\t\t\t\tmargin: 2px 8px; border-radius: 8px; transition: background 0.1s;\n\t\t\t\tborder: 2px solid transparent; opacity: 0.7;\n\t\t\t}\n\t\t\t.search-modal-result-item:hover { background: var(--background-modifier-hover); opacity: 0.9; }\n\t\t\t.search-modal-result-item.selected {\n\t\t\t\tbackground: var(--background-primary-alt); border-color: var(--interactive-accent);\n\t\t\t\topacity: 1;\n\t\t\t}\n\t\t\t.search-result-content { flex: 1; overflow: hidden; display: flex; flex-direction: column; gap: 2px; }\n\t\t\t.search-result-path {\n\t\t\t\tfont-size: 12px; color: var(--text-muted); display: flex; align-items: center; gap: 4px;\n\t\t\t\twhite-space: nowrap; overflow: hidden; text-overflow: ellipsis;\n\t\t\t}\n\t\t\t.search-result-title { font-weight: 600; font-size: 15px; color: var(--text-normal); }\n\t\t\t.search-modal-result-item.selected .search-result-title { color: var(--interactive-accent); }\n\t\t\t.search-result-excerpt {\n\t\t\t\tfont-size: 13px; color: var(--text-muted, #666); line-height: 1.6;\n\t\t\t\tmargin-top: 4px; word-break: break-word;\n\t\t\t}\n\t\t\t/* 摘要内的富文本样式还原 (加粗与斜体) */\n\t\t\t.search-result-excerpt strong {\n\t\t\t\tfont-weight: 600; color: var(--text-normal, #333);\n\t\t\t}\n\t\t\t.search-result-excerpt em {\n\t\t\t\tfont-style: italic; color: var(--text-normal, #555);\n\t\t\t}\n\t\t\t/* 摘要内的代码展示 (行内与块级) */\n\t\t\t.search-result-excerpt code.inline-code {\n\t\t\t\tbackground: var(--code-background, #f5f5f5);\n\t\t\t\tcolor: var(--code-normal, #e83e8c);\n\t\t\t\tpadding: 2px 6px; border-radius: 3px;\n\t\t\t\tfont-size: 0.9em;\n\t\t\t\tfont-family: var(--font-monospace, 'Consolas', 'Monaco', monospace);\n\t\t\t}\n\t\t\t/* 摘要中的代码块预览 */\n\t\t\t.search-result-excerpt pre.search-excerpt-code {\n\t\t\t\tmargin: 0.5rem 0; padding: 0.75rem;\n\t\t\t\tbackground: var(--code-block-background, #f3f4f6);\n\t\t\t\tborder-radius: 6px; font-size: 0.9em;\n\t\t\t\tline-height: 1.5; white-space: pre-wrap;\n\t\t\t\tcolor: var(--code-block-text, #1f2933);\n\t\t\t}\n\t\t\t/* 搜索命中词的高亮 (通用样式，适用于所有位置) */\n\t\t\tmark.search-excerpt-highlight {\n\t\t\t\tbackground: var(--text-highlight-bg, #ffd60a);\n\t\t\t\tcolor: var(--text-normal, #333);\n\t\t\t\tpadding: 2px 4px; border-radius: 2px;\n\t\t\t}\n\t\t\t/* 摘要内的 mark 标签（如果没有 search-excerpt-highlight 类） */\n\t\t\t.search-result-excerpt mark:not(.search-excerpt-highlight) {\n\t\t\t\tbackground: transparent; color: var(--text-accent); font-weight: bold;\n\t\t\t}\n\t\t\t/* 摘要中的省略符号 (三个点) 样式 */\n\t\t\t.search-result-excerpt .search-excerpt-ellipsis {\n\t\t\t\tcolor: var(--text-faint, #999); font-style: italic; margin: 0 2px;\n\t\t\t}\n\t\t\t/* 摘要中的链接样式 */\n\t\t\t.search-result-excerpt a.search-excerpt-link {\n\t\t\t\tcolor: var(--text-accent, #4a9eff);\n\t\t\t\ttext-decoration: underline;\n\t\t\t}\n\t\t\t/* 摘要中的标题样式 */\n\t\t\t.search-result-excerpt .search-excerpt-heading {\n\t\t\t\tdisplay: block; font-weight: 600;\n\t\t\t\tmargin: 0.25rem 0; color: var(--text-normal, #333);\n\t\t\t}\n\t\t\t/* 摘要中的列表项样式 */\n\t\t\t.search-result-excerpt .search-excerpt-list-item {\n\t\t\t\tdisplay: block; margin: 0.2rem 0;\n\t\t\t}\n\t\t\t.search-result-excerpt .search-excerpt-list-item--ordered {\n\t\t\t\tdisplay: flex; gap: 0.5rem;\n\t\t\t}\n\t\t\t/* 摘要中的图片标记样式 */\n\t\t\t.search-result-excerpt .search-excerpt-image {\n\t\t\t\tcolor: var(--text-muted, #666);\n\t\t\t\tfont-style: italic;\n\t\t\t}\n\t\t\t.search-result-meta { display: flex; flex-wrap: wrap; gap: 8px; margin-top: 4px; }\n\t\t\t.search-tag {\n\t\t\t\tfont-size: 11px; padding: 2px 8px; background: var(--background-secondary);\n\t\t\t\tborder-radius: 10px; color: var(--text-accent);\n\t\t\t}\n\t\t\t.search-alias { font-size: 12px; color: var(--text-accent); display: flex; align-items: center; gap: 4px; }\n\t\t\t.search-alias::before { content: \"alias\"; font-size: 10px; opacity: 0.7; }\n\t\t\t.search-modal-hints {\n\t\t\t\tdisplay: flex; justify-content: center; gap: 15px; padding: 10px;\n\t\t\t\tborder-top: 1px solid var(--background-modifier-border); font-size: 11px; color: var(--text-faint);\n\t\t\t}\n\t\t\t.search-modal-hints kbd {\n\t\t\t\tbackground: var(--background-secondary); padding: 2px 5px; border-radius: 4px;\n\t\t\t\tborder: 1px solid var(--background-modifier-border);\n\t\t\t}\n\t\t\t.breadcrumb-sep { opacity: 0.5; font-size: 10px; }\n\t\t\t\n\t\t\t/* Dark theme specific overrides if needed */\n\t\t\t.theme-dark .search-result-excerpt mark { color: #f7b756; }\n\t\t\t.theme-light .search-result-excerpt mark { color: #db74db; }\n\t\t\t.search-result-icon { color: var(--interactive-accent); display: flex; align-items: center; justify-content: center; flex-shrink: 0; padding-top: 2px; }\n\t\t\t.search-tag.header-match { background: rgba(var(--interactive-accent-rgb), 0.1); border: 1px solid var(--interactive-accent); cursor: pointer; }\n\t\t\t.search-tag.header-match:hover { background: var(--interactive-accent); color: white; }\n\t\t",document.head.appendChild(t)}createModal(){this.overlay=document.createElement("div"),this.overlay.className="search-modal-overlay",this.overlay.onclick=()=>this.close(),this.modal=document.createElement("div"),this.modal.className="search-modal",this.modal.onclick=t=>t.stopPropagation();const t=document.createElement("div");t.className="search-modal-header",t.innerHTML='\n\t\t\t<div class="search-modal-icon">\n\t\t\t\t<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>\n\t\t\t</div>\n\t\t',this.searchInput=document.createElement("input"),this.searchInput.className="search-modal-input",this.searchInput.placeholder="Search...",this.searchInput.oninput=this.handleInputChange,this.searchInput.onkeydown=this.handleKeyDown;const e=document.createElement("div");e.className="search-modal-actions";const i=document.createElement("button");i.className="search-modal-btn",i.title="Toggle Detailed View",i.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="8" y1="6" x2="21" y2="6"/><line x1="8" y1="12" x2="21" y2="12"/><line x1="8" y1="18" x2="21" y2="18"/><line x1="3" y1="6" x2="3.01" y2="6"/><line x1="3" y1="12" x2="3.01" y2="12"/><line x1="3" y1="18" x2="3.01" y2="18"/></svg>',this.toggleBtn=i,i.onclick=()=>{this.toggleDetailedView()};const n=document.createElement("button");n.className="search-modal-btn",n.innerHTML='<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>',n.onclick=()=>this.close(),e.append(i,n),t.append(this.searchInput,e),this.resultsContainer=document.createElement("div"),this.resultsContainer.className="search-modal-results";const s=document.createElement("div");s.className="search-modal-hints",s.innerHTML="<span><kbd>↑↓</kbd> Navigate</span><span><kbd>Enter</kbd> Open</span><span><kbd>Esc</kbd> Close</span>",this.modal.append(t,this.resultsContainer,s),this.overlay.append(this.modal),document.body.append(this.overlay)}setupKeyboardShortcuts(){document.addEventListener("keydown",(t=>{(t.ctrlKey||t.metaKey)&&"k"===t.key&&(t.preventDefault(),this.open()),"Escape"===t.key&&this.isOpen()&&this.close()}))}handleInputChange(){this.searchTimeout&&clearTimeout(this.searchTimeout),this.searchTimeout=setTimeout((()=>{const t=this.searchInput?.value||"";this.performSearch(t)}),100)}performSearch(t){if(!this.index||0===t.length)return this.currentResults=[],void this.renderResults("");const e=this.index.search(t,{prefix:!0,fuzzy:.2,boost:{title:2,aliases:1.8,headers:1.5,tags:1.3,path:1.1}}),i=ObsidianSite.metadata?.shownInTree||[];this.currentResults=e.filter((t=>t.path&&t.title&&(0===i.length||i.includes(t.path)))).slice(0,30),this.selectedIndex=0,this.renderResults(t)}renderResults(t){this.resultsContainer&&(this.resultsContainer.innerHTML="",0===this.currentResults.length&&t.length>0?this.resultsContainer.innerHTML='<div style="padding: 40px; text-align: center; color: var(--text-faint)">No results found.</div>':(this.currentResults.forEach(((e,i)=>{const n=this.createResultItem(e,t,i);this.resultsContainer?.append(n)})),this.updateSelection()))}createResultItem(t,e,i){const n=document.createElement("div");n.className="search-modal-result-item",n.onclick=()=>this.selectResult(t),n.onmouseenter=()=>{this.selectedIndex=i,this.updateSelection()};const s=document.createElement("div");s.className="search-result-icon",s.innerHTML='<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.5 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7.5L14.5 2z"/><polyline points="14 2 14 8 20 8"/></svg>';const o=document.createElement("div");o.className="search-result-content";const r=t.path.replace(/\.html$/,"").split("/").filter((t=>t&&"index"!==t)),a=document.createElement("div");a.className="search-result-path",a.innerHTML=r.map((t=>`<span>${this.escape(t)}</span>`)).join('<span class="breadcrumb-sep">›</span>');const l=document.createElement("div");if(l.className="search-result-title",l.innerHTML=this.highlight(t.title,e),o.append(a,l),this.showDetailedView){if(t.content){const i=document.createElement("div");i.className="search-result-excerpt",i.innerHTML=this.getExcerpt(t.content,e),o.append(i)}const i=document.createElement("div");if(i.className="search-result-meta",t.aliases?.length&&t.aliases.slice(0,2).forEach((t=>{const n=document.createElement("span");n.className="search-alias",n.innerHTML=this.highlight(t,e),i.append(n)})),t.headers?.length){t.headers.filter((t=>t.toLowerCase().includes(e.toLowerCase()))).slice(0,3).forEach((n=>{const s=document.createElement("a");s.className="search-tag header-match",s.innerHTML="§ "+this.highlight(n,e),s.onclick=e=>{e.stopPropagation(),ObsidianSite.loadURL(t.path+"#"+encodeURIComponent(n)),this.close()},i.append(s)}))}t.tags?.length&&t.tags.slice(0,3).forEach((t=>{const n=document.createElement("span");n.className="search-tag",n.innerHTML="#"+this.highlight(t,e),i.append(n)})),i.children.length&&o.append(i)}return n.append(s,o),n}updateSelection(){const t=this.resultsContainer?.querySelectorAll(".search-modal-result-item");t?.forEach(((t,e)=>{e===this.selectedIndex?(t.classList.add("selected"),t.scrollIntoView({block:"nearest",behavior:"smooth"})):t.classList.remove("selected")}))}handleKeyDown(t){if("ArrowDown"===t.key)t.preventDefault(),this.selectedIndex=(this.selectedIndex+1)%Math.max(1,this.currentResults.length),this.updateSelection();else if("ArrowUp"===t.key)t.preventDefault(),this.selectedIndex=(this.selectedIndex-1+this.currentResults.length)%Math.max(1,this.currentResults.length),this.updateSelection();else if("Enter"===t.key){const t=this.currentResults[this.selectedIndex];t&&this.selectResult(t)}else"Tab"===t.key&&(t.preventDefault(),this.toggleDetailedView())}toggleDetailedView(){this.showDetailedView=!this.showDetailedView,this.toggleBtn&&this.toggleBtn.classList.toggle("active",this.showDetailedView),this.performSearch(this.searchInput?.value||"")}selectResult(t){ObsidianSite.loadURL(t.path),this.close()}open(){this.overlay?.classList.add("active"),this.modal?.classList.add("active"),this.searchInput?.focus(),this.searchInput?.select()}close(){this.overlay?.classList.remove("active"),this.modal?.classList.remove("active")}isOpen(){return this.overlay?.classList.contains("active")??!1}highlight(t,e){if(!e)return this.escape(t);const i=e.trim().split(/\s+/).map((t=>this.escapeRegex(t))).filter((t=>t));if(!i.length)return this.escape(t);const n=new RegExp(`(${i.join("|")})`,"gi");return this.escape(t).replace(n,'<mark class="search-excerpt-highlight">$1</mark>')}getExcerpt(t,e){return t?this.getHtmlExcerpt(t,e,200):""}getHtmlExcerpt(t,e,i=200){if(!t)return"";const n=this.cleanTextContent(t),s=this.findBestExcerptPosition(n,e,i);let o=t;const r=[],a=[];if(o=o.replace(/<[^>]+>/g,(t=>(a.push(t),`__HTML_TAG_${a.length-1}__`))),o=o.replace(/```(?:([\w+-]+)\s*)?([\s\S]*?)```/g,((t,e,i)=>{const n=e?` search-excerpt-code--${e.trim().toLowerCase()}`:"",s=`${i}`.replace(/^\s*[\r\n]+/,"").replace(/[\r\n]+\s*$/,"").replace(/\r\n/g,"\n").replace(/\r/g,"\n"),o=`<pre class="search-excerpt-code${n}"><code>${this.escape(s)}</code></pre>`;return r.push(o),`__CODE_BLOCK_${r.length-1}__`})),o=o.replace(/\*\*([^*]+)\*\*/g,"<strong>$1</strong>"),o=o.replace(/__([^_]+)__/g,"<strong>$1</strong>"),o=o.replace(/(?<!\*)\*([^*]+)\*(?!\*)/g,"<em>$1</em>"),o=o.replace(/(?<!_)_([^_]+)_(?!_)/g,"<em>$1</em>"),o=o.replace(/`([^`]+)`/g,'<code class="inline-code">$1</code>'),o=o.replace(/\[([^\]]+)\]\(([^\)]+)\)/g,'<a href="$2" class="search-excerpt-link">$1</a>'),o=o.replace(/!\[([^\]]*)\]\([^\)]+\)/g,'<span class="search-excerpt-image">🖼️ $1</span>'),o=o.replace(/^#{1,6}\s+(.+)$/gm,'<strong class="search-excerpt-heading">$1</strong>'),o=o.replace(/~~([^~]+)~~/g,"<del>$1</del>"),o=o.replace(/==([^=]+)==/g,'<mark class="search-excerpt-highlight">$1</mark>'),o=o.replace(/^\s*[-*+]\s+(.+)$/gm,'<span class="search-excerpt-list-item">• $1</span>'),o=o.replace(/^\s*(\d+(?:\.\d+)*)(?:[\.)])\s+(.+)$/gm,((t,e,i)=>`<span class="search-excerpt-list-item search-excerpt-list-item--ordered"><span class="search-excerpt-list-index">${`${e}`.replace(/\.$/,"")}.</span><span class="search-excerpt-list-content">${i.trim()}</span></span>`)),a.forEach(((t,e)=>{o=o.replace(`__HTML_TAG_${e}__`,t)})),o=o.replace(/\r\n/g,"\n"),o=o.replace(/\n/g,"<br />"),o=o.replace(/<\/span><br \/><span class="search-excerpt-list-item/g,'</span><span class="search-excerpt-list-item'),o=o.replace(/[ \t]+/g," ").trim(),r.forEach(((t,e)=>{o=o.replace(`__CODE_BLOCK_${e}__`,t)})),-1===s.start||0===s.start){const t=this.truncateHtml(o,i);return this.highlightQueryInHtml(t,e)}const l=s.start>0?'<span class="search-excerpt-ellipsis">...</span>':"",c=s.end<n.length?'<span class="search-excerpt-ellipsis">...</span>':"",h=o.length/n.length,d=Math.floor(s.start*h),u=Math.floor(s.end*h);let p=o.substring(d,u);return p=this.cleanBrokenHtmlTags(p),l+this.highlightQueryInHtml(p,e)+c}cleanTextContent(t){if(!t)return"";let e=t;e=e.replace(/<[^>]*>/g," ");const i={"&nbsp;":" ","&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&apos;":"'","&mdash;":"—","&ndash;":"–","&hellip;":"..."};for(const[t,n]of Object.entries(i))e=e.replace(new RegExp(t,"g"),n);return e=e.replace(/```([\s\S]*?)```/g,((t,e)=>` ${`${e}`.replace(/^\s*[\r\n]+/,"").replace(/[\r\n]+\s*$/,"").replace(/\s+/g," ").trim()} `)),e=e.replace(/`([^`]+)`/g,"$1"),e=e.replace(/!\[([^\]]*)\]\([^\)]+\)/g,"$1"),e=e.replace(/\[([^\]]+)\]\([^\)]+\)/g,"$1"),e=e.replace(/^#{1,6}\s+/gm,""),e=e.replace(/^\s*[-*+]\s+/gm,""),e=e.replace(/^\s*\d+\.\s+/gm,""),e=e.replace(/\*\*([^*]+)\*\*/g,"$1"),e=e.replace(/__([^_]+)__/g,"$1"),e=e.replace(/\*([^*]+)\*/g,"$1"),e=e.replace(/_([^_]+)_/g,"$1"),e=e.replace(/~~([^~]+)~~/g,"$1"),e=e.replace(/==([^=]+)==/g,"$1"),e=e.replace(/\s+/g," ").trim(),e}findBestExcerptPosition(t,e,i){if(!e||t.length<=i)return{start:0,end:Math.min(t.length,i)};const n=e.toLowerCase().split(/\s+/).filter((t=>t.length>0)),s=t.toLowerCase();if(0===n.length)return{start:0,end:Math.min(t.length,i)};let o=-1,r=-1;for(const t of n){const e=s.indexOf(t);if(-1!==e){const t=Math.max(0,e-Math.floor(i/2)),a=Math.min(s.length,e+Math.floor(i/2)),l=s.substring(t,a);let c=0;for(const t of n)-1!==l.indexOf(t)&&(c+=1);c>r&&(r=c,o=e)}}if(-1===o)return{start:0,end:Math.min(t.length,i)};const a=Math.floor(i/2);let l=Math.max(0,o-a),c=Math.min(t.length,l+i);if(c===t.length&&(l=Math.max(0,c-i)),l>0){const e=t.indexOf(" ",l);-1!==e&&e<l+30&&(l=e+1)}if(c<t.length){const e=t.lastIndexOf(" ",c);-1!==e&&e>c-30&&(c=e)}return{start:l,end:c}}highlightQueryInHtml(t,e){if(!e)return t;const i=e.trim().split(/\s+/).filter((t=>t.length>0));if(0===i.length)return t;const n={};let s=0;t=(t=(t=(t=t.replace(/<pre[^>]*>[\s\S]*?<\/pre>/gi,(t=>{const e=`__CODE_BLOCK_PLACEHOLDER_${s}__`;return n[e]=t,s++,e}))).replace(/<code[^>]*>([^<]*)<\/code>/gi,(t=>{const e=`__INLINE_CODE_PLACEHOLDER_${s}__`;return n[e]=t,s++,e}))).replace(/<mark[^>]*>([^<]*)<\/mark>/gi,(t=>{const e=`__MARK_PLACEHOLDER_${s}__`;return n[e]=t,s++,e}))).replace(/<[^>]+>/g,(t=>{const e=`__HTML_PLACEHOLDER_${s}__`;return n[e]=t,s++,e}));for(const e of i){const i=this.escapeRegex(e),n=new RegExp(`(${i})`,"gi");t=t.replace(n,'<mark class="search-excerpt-highlight">$1</mark>')}return Object.keys(n).sort(((t,e)=>{const i=parseInt(t.match(/\d+/)?.[0]||"0");return parseInt(e.match(/\d+/)?.[0]||"0")-i})).forEach((e=>{t=t.replace(e,n[e])})),t=t.replace(/<mark[^>]*>(<mark[^>]*>([^<]*)<\/mark>)<\/mark>/gi,"$1")}truncateHtml(t,e){if(t.length<=e)return t;let i=t.substring(0,e);const n=i.lastIndexOf("<");return n>i.lastIndexOf(">")&&(i=i.substring(0,n)),i+'<span class="search-excerpt-ellipsis">...</span>'}cleanBrokenHtmlTags(t){t=(t=t.replace(/^[^<]*>/,"")).replace(/<[^>]*$/,"");const e=[],i=/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi;let n;for(;null!==(n=i.exec(t));){const t=n[1].toLowerCase();if(n[0].startsWith("</")){const i=e.lastIndexOf(t);-1!==i&&e.splice(i,1)}else n[0].endsWith("/>")||["br","img","hr"].includes(t)||e.push(t)}for(let i=e.length-1;i>=0;i--)t+=`</${e[i]}>`;return t}escapeRegex(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}escape(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}};window&&window.location&&(window.ObsidianSite=new class{constructor(){this.LinkHandler=ot,this.LinkPreview=st,this.isLoaded=!1,this.isHttp="file:"!=window.location.protocol,this.fileTree=void 0,this.outlineTree=void 0,this.search=void 0,this.leftSidebar=void 0,this.rightSidebar=void 0,this.graphView=void 0,this.backlinkList=void 0,this.tags=void 0,this.aliases=void 0,this.footerLinks=void 0,this.copyright=void 0,this.tocScrollSpy=void 0,this.onloadCallbacks=[],this.cachedWebpageDataMap=new Map,this.cachedFileDataMap=new Map,this.lastScreenWidth=void 0,this.isResizing=!1,this.checkStillResizingTimeout=void 0,this._deviceSize="large-screen"}onDocumentLoad(t){this.onloadCallbacks.push(t)}triggerOnDocumentLoad(t){this.onloadCallbacks.forEach((e=>e(t)))}async init(){window.addEventListener("load",(()=>ObsidianSite.onInit())),!this.isHttp||(this.metadata=await this.loadWebsiteData(),this.metadata)||console.error("Failed to load website data.")}async onInit(){this.isHttp||(this.metadata=await this.loadWebsiteData(),this.metadata||(console.error("Failed to load website data."),this.metadata=new Z,this.metadata.ignoreMetadata=!0)),await p((()=>null!=this.metadata),16),console.log("Website init"),"file:"!=window.location.protocol&&await loadIncludes(),this.theme=new Ie,this.bodyEl=document.body,this.horizontalLayout=document.querySelector("#main-horizontal"),this.centerContentEl=document.querySelector("#center-content");const t=document.querySelector("#file-explorer"),e=document.querySelector("#outline"),i=document.querySelector(".sidebar#left-sidebar"),n=document.querySelector(".sidebar#right-sidebar");this.bodyEl.className+=" "+this.metadata.bodyClasses,this.createLoadingEl(),t&&(this.fileTree=new be(t)),e&&(this.outlineTree=new be(e,1)),i&&(this.leftSidebar=new me(i)),n&&(this.rightSidebar=new me(n)),this.tocScrollSpy=new Ae,new De,this.search=await(new pe).init(),await(new Be).init();const s=document.querySelector("meta[name='pathname']")?.getAttribute("content")??"unknown";if(this.entryPage=s,this.document=await new Lt(s),await this.document.loadChildDocuments(),await this.document.postLoadInit(),!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.graphView.enabled&&this.loadGraphView().then((()=>this.graphView?.showGraph([s]))),this.initEvents(),st.loadPinnedPreviews(),this.onDocumentLoad((t=>{if(!ObsidianSite.metadata.ignoreMetadata){const e=t.isMainDocument&&!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.backlinks.enabled&&"markdown"==t.documentType,i=t.isMainDocument&&!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.tags.enabled&&"markdown"==t.documentType,n=t.isMainDocument&&!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.alias.enabled&&"markdown"==t.documentType,s=t.isMainDocument&&!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.footerLinks.enabled&&"markdown"==t.documentType,o=t.isMainDocument&&!ObsidianSite.metadata.ignoreMetadata&&ObsidianSite.metadata.featureOptions.copyright.enabled&&"markdown"==t.documentType;if(e){const e=t.info.backlinks?.filter((e=>e!=t.pathname))??[];this.backlinkList?this.backlinkList?.modifyDependencies((t=>{t.backlinkPaths=e})):this.backlinkList=new Oe(e),0==e.length?this.backlinkList?.hide():this.backlinkList?.show()}else this.backlinkList?.hide();if(i){const e=[];ObsidianSite.metadata.featureOptions.tags.showInlineTags&&t.info.inlineTags&&e.push(...t.info.inlineTags),ObsidianSite.metadata.featureOptions.tags.showFrontmatterTags&&t.info.frontmatterTags&&e.push(...t.info.frontmatterTags),this.tags?this.tags?.modifyDependencies((t=>{t.tags=e})):this.tags=new Fe(e),0==e.length?this.tags?.hide():this.tags?.show()}else this.tags?.hide();if(n){const e=t.info.aliases;this.aliases?this.aliases?.modifyDependencies((t=>{t.aliases=e??[]})):this.aliases=new Ne(e??[]),e&&0!=e.length?this.aliases?.show():this.aliases?.hide()}else this.aliases?.hide();s?(this.footerLinks?this.footerLinks.regenerate():this.footerLinks=new ze,this.footerLinks?.show()):this.footerLinks?.hide(),o?(this.copyright?this.copyright.regenerate():this.copyright=new Me,this.copyright?.show()):this.copyright?.hide()}this.tocScrollSpy?.updateHeadings(),this.setupOutlineBacklinksToggle()})),this.isHttp){let t=this.document.pathname;"index.html"==t&&(t="");const e=new URL(window.location.href).search;e&&(t+=e),history.replaceState({pathname:this.document.pathname},this.document.title,t)}this.isLoaded=!0,this.onloadCallbacks.forEach((t=>t(this.document)))}getI18nTitle(t,e){if(this.metadata?.featureOptions?.[t]?.displayTitle)return this.metadata.featureOptions[t].displayTitle;try{const e=window.i18n;if(e?.settings?.[t]?.title)return e.settings[t].title}catch(t){}return e}setupOutlineBacklinksToggle(){const t=document.querySelector("#outline");if(!t)return;const e=t.querySelector(".feature-header");if(!e)return;let i,n,s=e.querySelector(".outline-backlinks-toggle");if(s)i=s.querySelector(".outline-button"),n=s.querySelector(".backlinks-button");else{const o=e.querySelector(".feature-title");o&&o.remove(),s=document.createElement("div"),s.className="outline-backlinks-toggle",s.style.cssText="display: flex; gap: 8px; align-items: center; width: 100%;";const r=this.getI18nTitle("outline","Outline"),a=this.getI18nTitle("backlinks","Backlinks");i=document.createElement("button"),i.className="toggle-button outline-button active",i.textContent=r,i.setAttribute("aria-label",r),i.type="button",n=document.createElement("button"),n.className="toggle-button backlinks-button",n.textContent=a,n.setAttribute("aria-label",a),n.type="button",s.appendChild(i),s.appendChild(n);const l=t.querySelector(".tree-collapse-all");if(l){const t=document.createElement("div");t.style.flex="1",s.appendChild(t),s.appendChild(l)}e.insertBefore(s,e.firstChild);const c=()=>{i.classList.add("active"),n.classList.remove("active");const e=t.querySelector(".feature-header"),s=Array.from(t.children).filter((t=>t!==e&&!t.classList.contains("backlinks-content"))),o=t.querySelector(".backlinks-content");s.forEach((t=>{t.style.display=""})),o&&(o.style.display="none")},h=()=>{n.classList.add("active"),i.classList.remove("active");const e=t.querySelector(".feature-header"),s=Array.from(t.children).filter((t=>t!==e&&!t.classList.contains("backlinks-content"))),o=t.querySelector(".backlinks-content");s.forEach((t=>{t.style.display="none"})),o&&(o.style.display="")};i.addEventListener("click",c),n.addEventListener("click",h)}const o=()=>{const e=document.querySelector("#backlinks");if(!e||!t)return;const i=e.querySelector(".feature-header");i&&(i.style.display="none");const n=e.querySelector(".backlinks-content");if(!n)return;if(t.contains(n))return;t.querySelectorAll(".backlinks-content").forEach((t=>{t!==n&&t.remove()}));const s=t.querySelector(".feature-header");Array.from(t.children).filter((t=>t!==s&&!t.classList.contains("backlinks-content"))).length,t.appendChild(n),e&&e!==t&&(e.style.display="none")},r=()=>{const e=t.querySelector(".feature-header"),i=Array.from(t.children).filter((t=>t!==e&&!t.classList.contains("backlinks-content"))),s=t.querySelector(".backlinks-content"),o=n?.classList.contains("active");i.forEach((t=>{t.style.display=o?"none":""})),s&&(s.style.display=o?"":"none")};document.querySelector("#backlinks")?(o(),r()):new MutationObserver(((t,e)=>{document.querySelector("#backlinks")&&(o(),e.disconnect(),r())})).observe(document.body,{childList:!0,subtree:!0})}initEvents(){window.addEventListener("popstate",(async t=>{if(console.log("popstate",t),!t.state)return;const e=t.state.pathname;await ObsidianSite.loadURL(e,!1)}));const t=this;window.addEventListener("resize",(()=>{t.onResize()})),this.onResize(),document.addEventListener("contentDecrypted",(()=>{this.graphView&&this.document&&this.graphView.showGraph([this.document.pathname])}))}updateMetaTag(t,e){let i=document.querySelector(`meta[name="${t}"], meta[property="${t}"]`);i||(i=document.createElement("meta"),t.startsWith("og:")?i.setAttribute("property",t):i.setAttribute("name",t),document.head.appendChild(i)),i.setAttribute("content",e)}async loadURL(t,e=!0){const i=ot.getHashFromURL(t),n=ot.getQueryFromURL(t);if(t=ot.getPathnameFromURL(t),console.log("Loading URL",t,i,n),n&&n.startsWith("query="))return void this.search?.searchParseFilters(decodeURIComponent(n.substring(6)));if(this.document.pathname==t||this.document.pathname==t.split("#")[0])return i?this.document.scrollToHeader(i):t.includes("#")||new lt("This page is already loaded."),this.document;if(!ObsidianSite.getWebpageData(t))return new lt("This page does not exist yet."),void console.warn("Page does not exist",t);const s=await new Lt(t).load();if(!s)return void new lt("Failed to load page. Unknown error.");if(document.title=s.title,this.updateMetaTag("pathname",s.pathname),this.updateMetaTag("description",s.info?.description||""),this.updateMetaTag("author",s.info?.author||""),this.updateMetaTag("og:title",s.title),this.updateMetaTag("og:description",s.info?.description||""),this.updateMetaTag("og:url",window.location.href),this.updateMetaTag("og:image",s.info?.coverImageURL||""),await(this.graphView?.showGraph([s.pathname])),this.fileTree?.findByPath(s.pathname)?.setActive(),this.fileTree?.revealPath(s.pathname),this.graphView?.setActiveNodeByPath(s.pathname),this.document=s,this.document&&this.isHttp&&e){let t=this.document.pathname;"index.html"==t&&(t=""),history.pushState({pathname:t},this.document.title,t)}let o=s.sourceHtml.querySelector("#outline");return o&&(o=document.adoptNode(o),document.querySelector("#outline")?.replaceWith(o),ObsidianSite.outlineTree=new be(o,1)),setTimeout((async()=>{this.onloadCallbacks.forEach((t=>t(s))),await s.show(),i&&s.scrollToHeader(i)}),100),s}async fetch(t){if(t=ot.getPathnameFromURL(t),this.isHttp||t.startsWith("http")){const e=await fetch(t);return e.ok?e:void console.error("Failed to fetch",t)}{const e=this.getFileData(t);return e?.data?new Response(e.data,{status:200}):void console.error("Failed to fetch",t)}}documentExists(t){return t=ot.getPathnameFromURL(t),this.isHttp?!!this.metadata.webpages[t]:!!this.getFileData(t)?.data}async loadWebsiteData(){if(!this.isHttp){const t=this.getLocalDataFromId("website-metadata");return t?Z.fromJSON(JSON.stringify(t)):void 0}try{const t=await fetch(N.libFolderName+"/metadata.json");if(t.ok){const e=await t.text();return Z.fromJSON(e)}}catch(t){console.error("Failed to load website metadata.",t),new lt("Failed to load website metadata.")}}async loadGraphView(){const t=document.querySelector(".graph-view-wrapper");if(!t)return;const e=this;waitLoadScripts(["graph-render-worker","graph-wasm"],(()=>{async function i(){console.log("Initializing graph view");const i=new _e(t);e.graphView=i,console.log("Graph view initialized")}console.log("scripts loaded"),Module.onRuntimeInitialized=()=>{console.log("Wasm loaded"),i()},run(),setTimeout((()=>{null==e.graphView&&i()}),100)})),await p((()=>null!=this.graphView))}getLocalDataFromId(t){const e=document.getElementById(t);if(e)return JSON.parse(decodeURI(atob(e.getAttribute("value")??"")))}getWebpageData(t){if(!this.isHttp){if(this.cachedWebpageDataMap.has(t))return this.cachedWebpageDataMap.get(t);{const e=this.getLocalDataFromId(ot.getFileDataIdFromURL(t));return this.cachedWebpageDataMap.set(t,e),e}}if(this.metadata){const e=this.metadata.webpages[t];if(e)return e}}getFileData(t){if(!this.isHttp){if(this.cachedFileDataMap.has(t))return this.cachedFileDataMap.get(t);{const e=this.getLocalDataFromId(ot.getFileDataIdFromURL(t));return this.cachedFileDataMap.set(t,e),e}}if(this.metadata){const e=this.metadata.fileInfo[t];if(e)return e}return{}}scrollTo(t){t.scrollIntoView()}async showLoading(t,e=this.centerContentEl){if(e.style.transitionDuration="",e.classList.toggle("hide",t),this.loadingEl.classList.toggle("show",t),t){const t=g.fromElement(e);this.loadingEl.style.left=t.center.x-this.loadingEl.offsetWidth/2+"px",this.loadingEl.style.top=t.center.y-this.loadingEl.offsetHeight/2+"px"}await u(200)}createLoadingEl(){this.loadingEl=document.createElement("div"),this.loadingEl.classList.add("loading-icon"),document.body.appendChild(this.loadingEl),this.loadingEl.innerHTML="<div></div><div></div><div></div><div></div>"}get documentBounds(){return g.fromElement(this.centerContentEl)}onEndResize(){this.graphView?.graphRenderer?.autoResizeCanvas(),document.body.classList.toggle("resizing",!1)}onStartResize(){document.body.classList.toggle("resizing",!0)}get deviceSize(){return this._deviceSize}set deviceSize(t){this._deviceSize=t}onResize(){this.isResizing||(this.onStartResize(),this.isResizing=!0);const t=this;function e(e,i){const n=window.innerWidth;return n>e&&n<i&&null==t.lastScreenWidth||n>e&&n<i&&((t.lastScreenWidth??0)<=e||(t.lastScreenWidth??0)>=i)}function i(e){const i=window.innerWidth;return i>e&&null==t.lastScreenWidth||i>e&&(t.lastScreenWidth??0)<e}function n(e){const i=window.innerWidth;return i<e&&null==t.lastScreenWidth||i<e&&(t.lastScreenWidth??0)>e}const s=this.metadata.featureOptions.document?.documentWidth??"45em",o=this.metadata.featureOptions.sidebar?.leftDefaultWidth??"20em",r=this.metadata.featureOptions.sidebar?.rightDefaultWidth??"20em",a=m(s,this.centerContentEl),l=this.leftSidebar?m(o,this.leftSidebar?.containerEl):0,c=this.rightSidebar?m(r,this.rightSidebar?.containerEl):0;i(a+l+c)||i(1025)?(this.deviceSize="large-screen",document.body.classList.toggle("floating-sidebars",!1),document.body.classList.toggle("is-large-screen",!0),document.body.classList.toggle("is-small-screen",!1),document.body.classList.toggle("is-tablet",!1),document.body.classList.toggle("is-phone",!1),this.leftSidebar&&(this.leftSidebar.collapsed=!1),this.rightSidebar&&(this.rightSidebar.collapsed=!1)):e(a+l,a+l+c)||e(769,1024)?(this.deviceSize="small screen",document.body.classList.toggle("floating-sidebars",!1),document.body.classList.toggle("is-large-screen",!1),document.body.classList.toggle("is-small-screen",!0),document.body.classList.toggle("is-tablet",!1),document.body.classList.toggle("is-phone",!1),this.leftSidebar&&this.rightSidebar&&!this.leftSidebar.collapsed&&(this.rightSidebar.collapsed=!0)):e(l+c,a+l)||e(481,768)?(this.deviceSize="tablet",document.body.classList.toggle("floating-sidebars",!0),document.body.classList.toggle("is-large-screen",!1),document.body.classList.toggle("is-small-screen",!1),document.body.classList.toggle("is-tablet",!0),document.body.classList.toggle("is-phone",!1),this.leftSidebar&&this.rightSidebar&&!this.leftSidebar.collapsed&&(this.rightSidebar.collapsed=!0)):(n(l+c)||n(480))&&(this.deviceSize="phone",document.body.classList.toggle("floating-sidebars",!0),document.body.classList.toggle("is-large-screen",!1),document.body.classList.toggle("is-small-screen",!1),document.body.classList.toggle("is-tablet",!1),document.body.classList.toggle("is-phone",!0),this.leftSidebar&&(this.leftSidebar.collapsed=!0),this.rightSidebar&&(this.rightSidebar.collapsed=!0)),this.lastScreenWidth=window.innerWidth,null!=this.checkStillResizingTimeout&&clearTimeout(this.checkStillResizingTimeout);const h=window.innerWidth;this.checkStillResizingTimeout=setTimeout((function(){window.innerWidth==h&&(t.checkStillResizingTimeout=void 0,t.isResizing=!1,t.onEndResize())}),200)}},ObsidianSite=window.ObsidianSite,window.WebpageDocument=Lt,window.Canvas=C,window.Bounds=g,window.Vector2=b,window.LinkHandler=ot,window.FilePreviewPopover=st,ObsidianSite.init())})()